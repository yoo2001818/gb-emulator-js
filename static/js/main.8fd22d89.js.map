{"version":3,"file":"static/js/main.8fd22d89.js","mappings":"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","sources":["../node_modules/localforage/dist/localforage.js","../webpack/bootstrap","../webpack/runtime/compat get default export","../webpack/runtime/define property getters","../webpack/runtime/global","../webpack/runtime/hasOwnProperty shorthand","../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js","../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","memory/utils.ts","memory/bankedRAM.ts","../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/@babel/runtime/helpers/esm/superPropBase.js","../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/@babel/runtime/helpers/esm/createSuper.js","../node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","memory/ram.ts","memory/lockableRAM.ts","../node_modules/@babel/runtime/helpers/esm/inherits.js","cpu/constants.ts","cpu/ops/utils.ts","system/interrupter.ts","system/systemType.ts","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","ppu/render.ts","ppu/ppu.ts","system/dumpVRAM.ts","system/canvas.ts","cartridge/mbcType.ts","cartridge/cartridgeType.ts","cartridge/info.ts","cartridge/mbc/mbc1.ts","../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","cartridge/rtc.ts","cartridge/rtcSave.ts","cartridge/mbc/mbc3.ts","cartridge/mbc/mbc5.ts","cartridge/cartridge.ts","storage/saveStorage.ts","apu/psg/envelope.ts","apu/psg/length.ts","apu/psg/noise.ts","apu/psg/pcm.ts","apu/psg/sweep.ts","apu/psg/square.ts","apu/apu.ts","memory/wram.ts","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","cpu/lut.ts","cpu/ops/alu.ts","cpu/ops/cond.ts","cpu/ops/jmp.ts","cpu/ops/ld.ts","cpu/ops/misc.ts","cpu/ops/register.ts","cpu/ops/opcode.ts","cpu/cpu.ts","io/ioBus.ts","system/memoryBus.ts","system/baseSystem.ts","system/dma.ts","system/gamepad.ts","system/hdma.ts","system/speedController.ts","system/timer.ts","system/serial.ts","system/baseEmulator.ts","system/emulator.ts","../node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","utils/downloadFile.ts","index.tsx"],"sourcesContent":["/*!\n    localForage -- Offline Storage, Improved\n    Version 1.10.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb || !idb.open) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support\n        // (see: https://github.com/pouchdb/pouchdb/issues/5572).\n        // Safari 10.1 shipped with fetch, we can use that to detect it.\n        // Note: this creates issues with `window.fetch` polyfills and\n        // overrides; see:\n        // https://github.com/localForage/localForage/issues/856\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            var db = openreq.result;\n            db.onversionchange = function (e) {\n                // Triggered when the database is modified (e.g. adding an objectStore) or\n                // deleted (even when initiated by other sessions in different tabs).\n                // Closing the connection here prevents those operations from being blocked.\n                // If the database is accessed again later by this instance, the connection\n                // will be reopened or the database recreated as needed.\n                e.target.close();\n            };\n            resolve(db);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback returns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openKeyCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openKeyCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(req.error);\n                    };\n\n                    req.onblocked = function () {\n                        // Closing all open connections in onversionchange handler should prevent this situation, but if\n                        // we do get here, it just means the request remains pending - eventually it will succeed or error\n                        console.warn('dropInstance blocked for database \"' + options.name + '\" until all open connections are closed');\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nexport default function _regeneratorRuntime() {\n  \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */\n  _regeneratorRuntime = function _regeneratorRuntime() {\n    return exports;\n  };\n  var exports = {},\n    Op = Object.prototype,\n    hasOwn = Op.hasOwnProperty,\n    defineProperty = Object.defineProperty || function (obj, key, desc) {\n      obj[key] = desc.value;\n    },\n    $Symbol = \"function\" == typeof Symbol ? Symbol : {},\n    iteratorSymbol = $Symbol.iterator || \"@@iterator\",\n    asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\",\n    toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n  function define(obj, key, value) {\n    return Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), obj[key];\n  }\n  try {\n    define({}, \"\");\n  } catch (err) {\n    define = function define(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,\n      generator = Object.create(protoGenerator.prototype),\n      context = new Context(tryLocsList || []);\n    return defineProperty(generator, \"_invoke\", {\n      value: makeInvokeMethod(innerFn, self, context)\n    }), generator;\n  }\n  function tryCatch(fn, obj, arg) {\n    try {\n      return {\n        type: \"normal\",\n        arg: fn.call(obj, arg)\n      };\n    } catch (err) {\n      return {\n        type: \"throw\",\n        arg: err\n      };\n    }\n  }\n  exports.wrap = wrap;\n  var ContinueSentinel = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n  var getProto = Object.getPrototypeOf,\n    NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      define(prototype, method, function (arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (\"throw\" !== record.type) {\n        var result = record.arg,\n          value = result.value;\n        return value && \"object\" == _typeof(value) && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) {\n          invoke(\"next\", value, resolve, reject);\n        }, function (err) {\n          invoke(\"throw\", err, resolve, reject);\n        }) : PromiseImpl.resolve(value).then(function (unwrapped) {\n          result.value = unwrapped, resolve(result);\n        }, function (error) {\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n      reject(record.arg);\n    }\n    var previousPromise;\n    defineProperty(this, \"_invoke\", {\n      value: function value(method, arg) {\n        function callInvokeWithMethodAndArg() {\n          return new PromiseImpl(function (resolve, reject) {\n            invoke(method, arg, resolve, reject);\n          });\n        }\n        return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      }\n    });\n  }\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = \"suspendedStart\";\n    return function (method, arg) {\n      if (\"executing\" === state) throw new Error(\"Generator is already running\");\n      if (\"completed\" === state) {\n        if (\"throw\" === method) throw arg;\n        return doneResult();\n      }\n      for (context.method = method, context.arg = arg;;) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n        if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) {\n          if (\"suspendedStart\" === state) throw state = \"completed\", context.arg;\n          context.dispatchException(context.arg);\n        } else \"return\" === context.method && context.abrupt(\"return\", context.arg);\n        state = \"executing\";\n        var record = tryCatch(innerFn, self, context);\n        if (\"normal\" === record.type) {\n          if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue;\n          return {\n            value: record.arg,\n            done: context.done\n          };\n        }\n        \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg);\n      }\n    };\n  }\n  function maybeInvokeDelegate(delegate, context) {\n    var methodName = context.method,\n      method = delegate.iterator[methodName];\n    if (undefined === method) return context.delegate = null, \"throw\" === methodName && delegate.iterator[\"return\"] && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method) || \"return\" !== methodName && (context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a '\" + methodName + \"' method\")), ContinueSentinel;\n    var record = tryCatch(method, delegate.iterator, context.arg);\n    if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel;\n    var info = record.arg;\n    return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel);\n  }\n  function pushTryEntry(locs) {\n    var entry = {\n      tryLoc: locs[0]\n    };\n    1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);\n  }\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\", delete record.arg, entry.completion = record;\n  }\n  function Context(tryLocsList) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);\n  }\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) return iteratorMethod.call(iterable);\n      if (\"function\" == typeof iterable.next) return iterable;\n      if (!isNaN(iterable.length)) {\n        var i = -1,\n          next = function next() {\n            for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;\n            return next.value = undefined, next.done = !0, next;\n          };\n        return next.next = next;\n      }\n    }\n    return {\n      next: doneResult\n    };\n  }\n  function doneResult() {\n    return {\n      value: undefined,\n      done: !0\n    };\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, \"constructor\", {\n    value: GeneratorFunctionPrototype,\n    configurable: !0\n  }), defineProperty(GeneratorFunctionPrototype, \"constructor\", {\n    value: GeneratorFunction,\n    configurable: !0\n  }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) {\n    var ctor = \"function\" == typeof genFun && genFun.constructor;\n    return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name));\n  }, exports.mark = function (genFun) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun;\n  }, exports.awrap = function (arg) {\n    return {\n      __await: arg\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    void 0 === PromiseImpl && (PromiseImpl = Promise);\n    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);\n    return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () {\n    return this;\n  }), define(Gp, \"toString\", function () {\n    return \"[object Generator]\";\n  }), exports.keys = function (val) {\n    var object = Object(val),\n      keys = [];\n    for (var key in object) keys.push(key);\n    return keys.reverse(), function next() {\n      for (; keys.length;) {\n        var key = keys.pop();\n        if (key in object) return next.value = key, next.done = !1, next;\n      }\n      return next.done = !0, next;\n    };\n  }, exports.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function reset(skipTempReset) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);\n    },\n    stop: function stop() {\n      this.done = !0;\n      var rootRecord = this.tryEntries[0].completion;\n      if (\"throw\" === rootRecord.type) throw rootRecord.arg;\n      return this.rval;\n    },\n    dispatchException: function dispatchException(exception) {\n      if (this.done) throw exception;\n      var context = this;\n      function handle(loc, caught) {\n        return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught;\n      }\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i],\n          record = entry.completion;\n        if (\"root\" === entry.tryLoc) return handle(\"end\");\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\"),\n            hasFinally = hasOwn.call(entry, \"finallyLoc\");\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n          } else {\n            if (!hasFinally) throw new Error(\"try statement without catch or finally\");\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n      finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);\n      var record = finallyEntry ? finallyEntry.completion : {};\n      return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);\n    },\n    complete: function complete(record, afterLoc) {\n      if (\"throw\" === record.type) throw record.arg;\n      return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;\n    },\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;\n      }\n    },\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (\"throw\" === record.type) {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      return this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel;\n    }\n  }, exports;\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import { Memory } from \"./types\";\n\nexport function serializeBytes(bytes: Uint8Array): string {\n  const hexData = [];\n  for (let i = 0; i < bytes.length; i += 1) {\n    const byte = bytes[i];\n    if (byte > 0xf) {\n      hexData.push(byte.toString(16));\n    } else {\n      hexData.push('0' + byte.toString(16));\n    }\n  }\n  return hexData.join('');\n}\n\nexport function deserializeBytes(data: string, bytes: Uint8Array): void {\n  for (let i = 0; i < data.length; i += 1) {\n    const pos = i * 2;\n    const byte = parseInt(data.slice(pos, pos + 2), 16);\n    bytes[i] = byte;\n  }\n}\n\nexport function createAccessor<T, K extends keyof T>(object: T, key: K): Memory {\n  return {\n    read: () => object[key] as number,\n    write: (_, value) => {\n      (object[key] as number) = value;\n    },\n  };\n}\n","import { Memory } from './types';\nimport { deserializeBytes, serializeBytes } from './utils';\n\nexport class BankedRAM implements Memory {\n  bytes: Uint8Array;\n  size: number;\n  isLocked: () => boolean;\n  getOffset: (addr: number) => number;\n\n  constructor(\n    size: number = 0x2000,\n    isLocked: () => boolean,\n    getOffset: (addr: number) => number,\n  ) {\n    this.bytes = new Uint8Array(size);\n    this.size = size;\n    this.getOffset = getOffset;\n    this.isLocked = isLocked;\n  }\n\n  serialize(): any {\n    return serializeBytes(this.bytes);\n  }\n\n  deserialize(data: any): void {\n    deserializeBytes(data, this.bytes);\n  }\n\n  read(pos: number): number {\n    if (this.isLocked()) return 0xff;\n    if (pos > this.size) {\n      return 0xff;\n    }\n    return this.bytes[(pos + this.getOffset(pos)) % this.size];\n  }\n\n  write(pos: number, value: number): void {\n    if (this.isLocked()) return;\n    this.bytes[(pos + this.getOffset(pos)) % this.size] = value;\n  }\n\n  reset(): void {\n    this.bytes.fill(0);\n  }\n}\n\n","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","import superPropBase from \"./superPropBase.js\";\nexport default function _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get.bind();\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n      return desc.value;\n    };\n  }\n  return _get.apply(this, arguments);\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nexport default function _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n  return object;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn.js\";\nexport default function _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return possibleConstructorReturn(this, result);\n  };\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","import { Memory } from './types';\nimport { deserializeBytes, serializeBytes } from './utils';\n\nexport class RAM implements Memory {\n  bytes: Uint8Array;\n  size: number;\n  constructor(size: number = 0x2000) {\n    this.bytes = new Uint8Array(size);\n    this.size = size;\n  }\n\n  serialize(): any {\n    return serializeBytes(this.bytes);\n  }\n\n  deserialize(data: any): void {\n    deserializeBytes(data, this.bytes);\n  }\n\n  read(pos: number): number {\n    if (pos > this.size) {\n      return 0xff;\n    }\n    return this.bytes[pos % this.size];\n  }\n\n  write(pos: number, value: number): void {\n    this.bytes[pos % this.size] = value;\n  }\n\n  reset(): void {\n    this.bytes.fill(0);\n  }\n}\n","import { RAM } from './ram';\n\nexport class LockableRAM extends RAM {\n  isLocked: () => boolean;\n\n  constructor(size: number = 0x2000, isLocked: () => boolean) {\n    super(size);\n    this.isLocked = isLocked;\n  }\n\n  read(pos: number): number {\n    if (this.isLocked()) return 0xff;\n    return super.read(pos);\n  }\n\n  write(pos: number, value: number): void {\n    if (this.isLocked()) return;\n    return super.write(pos, value);\n  }\n}\n\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export const REGISTER = {\n  A: 0,\n  B: 1,\n  C: 2,\n  D: 3,\n  E: 4,\n  F: 5,\n  H: 6,\n  L: 7,\n  PC: 8,\n  SP: 9,\n};\n\nexport const FLAG = {\n  C: 4,\n  N: 6,\n  H: 5,\n  Z: 7,\n};\n\nexport type Register = number;\n","export function getHex16(n: number): string {\n  return '$' + (n.toString(16).padStart(4, '0'));\n}\n\nexport function getHex8(n: number): string {\n  return '$' + (n.toString(16).padStart(2, '0'));\n}\n","import { REGISTER } from '../cpu/constants';\nimport { CPU } from '../cpu/cpu';\nimport { getHex16 } from '../cpu/ops/utils';\nimport { BaseSystem } from './baseSystem';\n\nexport const INTERRUPT_TYPE = {\n  VBLANK: 0,\n  LCDC: 1,\n  TIMER_OVERFLOW: 2,\n  SERIAL_COMPLETE: 3,\n  PIN_TRIGGERED: 4,\n};\n\nconst INTERRUPT_NAMES = [\n  'V-blank',\n  'LCDC',\n  'Timer overflow',\n  'Serial complete',\n  'Pin triggered',\n];\n\nconst IE_ADDR = 0xFFFF;\nconst IF_ADDR = 0xFF0F;\n\nexport class Interrupter {\n  cpu: CPU;\n  interruptsEnable: number;\n  interruptsFlag: number;\n\n  constructor(cpu: CPU) {\n    this.cpu = cpu;\n    this.interruptsEnable = 0;\n    this.interruptsFlag = 0;\n  }\n\n  reset(): void {\n    this.interruptsEnable = 0;\n    this.interruptsFlag = 0;\n  }\n\n  serialize(): any {\n    return { ie: this.interruptsEnable, if: this.interruptsFlag };\n  }\n\n  deserialize(value: any): void {\n    this.interruptsEnable = value.ie;\n    this.interruptsFlag = value.if;\n  }\n\n  register(system: BaseSystem): void {\n    const { ioBus } = system;\n    ioBus.register(0x0f, 'IF', {\n      read: () => this.interruptsFlag,\n      write: (_, value) => { this.interruptsFlag = value; },\n    });\n    ioBus.register(0xff, 'IE', {\n      read: () => this.interruptsEnable,\n      write: (_, value) => { this.interruptsEnable = value; },\n    });\n  }\n\n  queueInterrupt(type: number): void {\n    const memory = this.cpu.memory;\n    // Set up IF\n    let ifReg = memory.read(IF_ADDR);\n    ifReg |= 1 << type;\n    memory.write(IF_ADDR, ifReg);\n  }\n\n  acceptsInterrupt(): boolean {\n    const memory = this.cpu.memory;\n    const ieReg = memory.read(IE_ADDR);\n    return (ieReg & 0x1f) !== 0;\n  }\n\n  getDebugState(): string {\n    const memory = this.cpu.memory;\n    const ifReg = memory.read(IF_ADDR);\n    const ieReg = memory.read(IE_ADDR);\n    return [\n      `IME: ${this.cpu.isInterruptsEnabled}`,\n      `IF: ${ifReg.toString(16)} IE: ${ieReg.toString(16)}`,\n    ].join('\\n');\n  }\n\n  step(): void {\n    if (this.cpu.isInterruptsEnabled || !this.cpu.isRunning) {\n      const memory = this.cpu.memory;\n      // Check if an interrupt should occur\n      const ifReg = memory.read(IF_ADDR);\n      const ieReg = memory.read(IE_ADDR);\n      let interruptReg = ieReg & ifReg;\n      if (interruptReg) {\n        // Check which type is generated \n        let interruptType = 0;\n        while ((interruptReg & 1) === 0) {\n          interruptType += 1;\n          interruptReg = interruptReg >>> 1;\n        }\n        // Regardless of IME flag, start the CPU (continuing from HALT)\n        this.cpu.isRunning = true;\n        if (this.cpu.isInterruptsEnabled) {\n          // Clear IF register of the type\n          memory.write(IF_ADDR, ifReg & ~(1 << interruptType));\n          // Generate interrupts\n          const prevPc = this.cpu.registers[REGISTER.PC];\n          this.cpu.enterInterrupt();\n          const addr = 0x40 + (interruptType * 8);\n          this.cpu.jump(addr);\n          if (this.cpu.isDebugging) {\n            this.cpu.log(\n              'event',\n              `Interrupt ${interruptType} (${INTERRUPT_NAMES[interruptType]})`,\n              undefined,\n              `pc=${getHex16(addr)} (was ${getHex16(prevPc)}) sp=${getHex16(this.cpu.registers[REGISTER.SP])}`,\n            );\n          }\n        } else {\n          if (this.cpu.isDebugging) {\n            this.cpu.log('event', `Interrupt resume ${interruptType} (${INTERRUPT_NAMES[interruptType]})`);\n          }\n        }\n      }\n    }\n    if (this.cpu.isRunning) {\n      this.cpu.step();\n    }\n  }\n}\n","import { CartridgeInfo } from '../cartridge/info';\n\nexport enum SystemType {\n  DMG,\n  CGB,\n  SGB,\n}\n\nexport const SYSTEM_BOOT_REGISTERS: Record<SystemType, number[]> = {\n  [SystemType.DMG]: [0x01, 0, 0x13, 0, 0xd8, 0xb0, 0x01, 0x4d, 0, 0xfffe],\n  [SystemType.CGB]: [0x11, 0, 0x13, 0, 0xd8, 0xb0, 0x01, 0x4d, 0, 0xfffe],\n  [SystemType.SGB]: [0x01, 0, 0x13, 0, 0xd8, 0xb0, 0x01, 0x4d, 0, 0xfffe],\n};\n\nexport function getSystemType(cartridgeInfo: CartridgeInfo): SystemType {\n  if (cartridgeInfo.supportsCGB) return SystemType.CGB;\n  return SystemType.DMG;\n}\n","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","import { PPU, LCDC, LCD_HEIGHT, LCD_WIDTH } from \"./ppu\";\n\nfunction getBGTileDataAddress(lcd: PPU, id: number, bank: number = 0): number {\n  const bgTileSigned = (lcd.lcdc & LCDC.BG_WINDOW_TILE_DATA_SELECT) === 0;\n  const base = bank * 0x2000;\n  if (bgTileSigned) {\n    // Video RAM starts with 0x8000. Therefore 0x800 here maps to 0x8800.\n    if (id >= 128) return base + 0x800 + (id - 128) * 16;\n    return base + 0x1000 + id * 16;\n  }\n  return base + id * 16;\n}\n\nfunction getBGTileId(lcd: PPU, x: number, y: number): number {\n  // Again, this is directly read from VRAM.\n  const bgMapBase = (lcd.lcdc & LCDC.BG_TILE_MAP_DISPLAY_SELECT) ? 0x1c00 : 0x1800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction getBGTileAttributes(lcd: PPU, x: number, y: number): number {\n  const bgMapBase = (lcd.lcdc & LCDC.BG_TILE_MAP_DISPLAY_SELECT) ? 0x3c00 : 0x3800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction getWindowTileId(lcd: PPU, x: number, y: number): number {\n  const bgMapBase = (lcd.lcdc & LCDC.WINDOW_TILE_MAP_DISPLAY_SELECT) ? 0x1c00 : 0x1800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction getWindowTileAttributes(lcd: PPU, x: number, y: number): number {\n  const bgMapBase = (lcd.lcdc & LCDC.WINDOW_TILE_MAP_DISPLAY_SELECT) ? 0x3c00 : 0x3800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction getBGPaletteColor(lcd: PPU, paletteId: number, colorId: number): number {\n  const addr = paletteId * 8 + colorId * 2;\n  return lcd.bgPalette[addr] | (lcd.bgPalette[addr + 1] << 8);\n}\n\nfunction getOBJPaletteColor(lcd: PPU, paletteId: number, colorId: number): number {\n  const addr = paletteId * 8 + colorId * 2;\n  return lcd.objPalette[addr] | (lcd.objPalette[addr + 1] << 8);\n}\n\nfunction renderLineBG(lcd: PPU, line: number): void {\n  const isCGB = lcd.isCGB;\n  const lcdcPriority = (lcd.lcdc & LCDC.BG_WINDOW_DISPLAY) === 0;\n  // GB: If BG_WINDOW_DISPLAY is 0, don't render BG and window\n  if (!isCGB && lcdcPriority) {\n    // FIXME: Clear priority data\n    return;\n  }\n  const vram = lcd.vram.bytes;\n  const drawY = line + lcd.scy;\n  const tileY = (drawY / 8) & 0x1f;\n  const py = drawY % 8;\n  const fbAddr = line * LCD_WIDTH;\n\n  let currentX = 0;\n  do {\n    const drawX = currentX + lcd.scx;\n    const tileX = (drawX / 8) & 0x1f;\n    let px = 7 - (drawX % 8);\n\n    // Read tile data of the current position\n    const tileId = getBGTileId(lcd, tileX, tileY);\n    const tileAttributes = getBGTileAttributes(lcd, tileX, tileY);\n    const tilePalette = tileAttributes & 0x7;\n    const tileBank = (tileAttributes >>> 3) & 1;\n    const tileHFlip = (tileAttributes & 0x20) !== 0;\n    const tileVFlip = (tileAttributes & 0x40) !== 0;\n    const tilePriority = (tileAttributes & 0x80) !== 0;\n\n    const vy = tileVFlip ? 7 - py : py;\n\n    const tileAddr = getBGTileDataAddress(lcd, tileId, tileBank);\n    const tileLine1 = vram[tileAddr + vy * 2];\n    const tileLine2 = vram[tileAddr + vy * 2 + 1];\n\n    // Paint the pixel..\n    while (px >= 0) {\n      const vx = tileHFlip ? 7 - px : px;\n      const colorId = ((tileLine1 >> vx) & 1) | (((tileLine2 >> vx) & 1) << 1);\n      if (isCGB) {\n        const color = getBGPaletteColor(lcd, tilePalette, colorId);\n        lcd.framebuffer[fbAddr + currentX] = color;\n        lcd.lineData[currentX] =\n          (tilePriority ? 2 : 0) |\n          (colorId > 0 ? 1 : 0);\n      } else {\n        const color = (lcd.bgp >> (colorId << 1)) & 0x03;\n        lcd.framebuffer[fbAddr + currentX] = color | 0x8000;\n        lcd.lineData[currentX] = colorId > 0 ? 1 : 0;\n      }\n      px -= 1;\n      currentX += 1;\n    }\n  } while (currentX < LCD_WIDTH);\n}\n\nfunction renderLineWindow(lcd: PPU, line: number): void {\n  const isCGB = lcd.isCGB;\n  if (!isCGB && (lcd.lcdc & LCDC.BG_WINDOW_DISPLAY) === 0) {\n    return;\n  }\n  if ((lcd.lcdc & LCDC.WINDOW_DISPLAY) === 0) return;\n\n  const vram = lcd.vram.bytes;\n  const drawY = line - lcd.wy;\n  if (drawY < 0) return;\n  const tileY = (drawY / 8) & 0x1f;\n  const py = drawY % 8;\n  const fbAddr = line * LCD_WIDTH;\n\n  let currentX = Math.max(0, lcd.wx - 7);\n  do {\n    const drawX = currentX - (lcd.wx - 7);\n    const tileX = (drawX / 8) & 0x1f;\n    let px = 7 - (drawX % 8);\n\n    // Read tile data of the current position\n    const tileId = getWindowTileId(lcd, tileX, tileY);\n    const tileAttributes = getWindowTileAttributes(lcd, tileX, tileY);\n    const tilePalette = tileAttributes & 0x7;\n    const tileBank = (tileAttributes >>> 3) & 1;\n    const tileHFlip = (tileAttributes & 0x20) !== 0;\n    const tileVFlip = (tileAttributes & 0x40) !== 0;\n    const tilePriority = (tileAttributes & 0x80) !== 0;\n\n    const vy = tileVFlip ? 7 - py : py;\n\n    const tileAddr = getBGTileDataAddress(lcd, tileId, tileBank);\n    const tileLine1 = vram[tileAddr + vy * 2];\n    const tileLine2 = vram[tileAddr + vy * 2 + 1];\n\n    // Paint the pixel..\n    while (px >= 0) {\n      const vx = tileHFlip ? 7 - px : px;\n      const colorId = ((tileLine1 >> vx) & 1) | (((tileLine2 >> vx) & 1) << 1);\n      if (isCGB) {\n        const color = getBGPaletteColor(lcd, tilePalette, colorId);\n        lcd.framebuffer[fbAddr + currentX] = color;\n        lcd.lineData[currentX] =\n          (tilePriority ? 2 : 0) |\n          (colorId > 0 ? 1 : 0);\n      } else {\n        const color = (lcd.bgp >> (colorId << 1)) & 0x03;\n        lcd.framebuffer[fbAddr + currentX] = color | 0x8000;\n        lcd.lineData[currentX] = colorId > 0 ? 1 : 0;\n      }\n      px -= 1;\n      currentX += 1;\n    }\n  } while (currentX < LCD_WIDTH);\n}\n\nconst ATTRIBUTE = {\n  PALETTE: 16,\n  X_FLIP: 32,\n  Y_FLIP: 64,\n  BG_WINDOW_OVER_OBJ: 128,\n};\n\nexport function renderLineSprite(lcd: PPU, line: number): void {\n  if ((lcd.lcdc & LCDC.OBJ_DISPLAY) === 0) return;\n  const lcdcPriority = (lcd.lcdc & LCDC.BG_WINDOW_DISPLAY) !== 0;\n  const isCGB = lcd.isCGB;\n  // Read OAM\n  const oam = lcd.oam.bytes;\n  const vram = lcd.vram.bytes;\n  const spriteHeight = (lcd.lcdc & LCDC.OBJ_SIZE) ? 16 : 8;\n  const fbAddr = line * LCD_WIDTH;\n  // Scan for candidates\n  const drawIds: number[] = [];\n  for (let i = 0; i < 160; i += 4) {\n    const spriteY = oam[i] - 16;\n    let py = line - spriteY;\n    if (py < 0 || py >= spriteHeight) continue;\n    const spriteX = oam[i + 1] - 8;\n    if (spriteX <= -8 || spriteX > LCD_WIDTH) continue;\n    drawIds.push(i);\n  }\n  \n  let drawCount = 0;\n  for (let i = drawIds.length - 1; i >= 0; i -= 1) {\n    if (drawCount >= 10) continue;\n    const addr = drawIds[i];\n    const spriteY = oam[addr] - 16;\n    let py = line - spriteY;\n    if (py < 0 || py >= spriteHeight) continue;\n    const spriteX = oam[addr + 1] - 8;\n    let tileId = oam[addr + 2];\n    const attributes = oam[addr + 3];\n\n    const obp = (attributes & ATTRIBUTE.PALETTE) ? lcd.obp1 : lcd.obp0;\n    const flipX = (attributes & ATTRIBUTE.X_FLIP) !== 0;\n    const flipY = (attributes & ATTRIBUTE.Y_FLIP) !== 0;\n    const objPriority = (attributes & ATTRIBUTE.BG_WINDOW_OVER_OBJ) !== 0;\n    const palette = attributes & 0x7;\n    const tileBank = (attributes >>> 3) & 1;\n\n    if (flipY) py = spriteHeight - 1 - py;\n    if (spriteHeight === 16) {\n      tileId = tileId & 0xfe;\n    }\n\n    const tileLine1 = vram[tileBank * 0x2000 + tileId * 16 + py * 2];\n    const tileLine2 = vram[tileBank * 0x2000 + tileId * 16 + py * 2 + 1];\n    for (let x = 0; x < 8; x += 1) {\n      const px = flipX ? x : (7 - x);\n      const currentX = spriteX + x;\n      if (currentX < 0 || currentX >= LCD_WIDTH) continue;\n      const colorId = ((tileLine1 >> px) & 1) | (((tileLine2 >> px) & 1) << 1);\n      if (colorId === 0) continue;\n      const prevData = lcd.lineData[currentX];\n      const bgColor = (prevData & 1) !== 0;\n      const bgPriority = (prevData & 2) !== 0;\n      if (isCGB) {\n        if (\n          bgColor &&\n          lcdcPriority &&\n          (objPriority || bgPriority)\n        ) {\n          continue;\n        }\n        const color = getOBJPaletteColor(lcd, palette, colorId);\n        lcd.framebuffer[fbAddr + currentX] = color;\n      } else {\n        if (bgColor && objPriority) continue;\n        const color = (obp >> (colorId << 1)) & 0x03;\n        lcd.framebuffer[fbAddr + currentX] = color | 0x8000;\n      }\n    }\n  }\n}\n\nexport function renderLine(\n  lcd: PPU,\n  line: number,\n): void {\n  if (line >= LCD_HEIGHT) return;\n\n  renderLineBG(lcd, line);\n  renderLineWindow(lcd, line);\n  renderLineSprite(lcd, line);\n}\n","import { BankedRAM } from '../memory/bankedRAM';\nimport { LockableRAM } from '../memory/lockableRAM';\nimport { createAccessor, deserializeBytes, serializeBytes } from '../memory/utils';\nimport { BaseEmulator } from '../system/baseEmulator';\nimport { BaseSystem } from '../system/baseSystem';\nimport { Interrupter, INTERRUPT_TYPE } from '../system/interrupter';\nimport { SystemType } from '../system/systemType';\nimport { renderLine } from './render';\n\nexport const LCD_IO = {\n  LCDC: 0xff40,\n  STAT: 0xff41,\n  SCY: 0xff42,\n  SCX: 0xff43,\n  LY: 0xff44,\n  LYC: 0xff45,\n  DMA: 0xff46,\n  BGP: 0xff47,\n  OBP0: 0xff48,\n  OBP1: 0xff49,\n  WY: 0xff4a,\n  WX: 0xff4b,\n  VBK: 0xff4f,\n  HDMA1: 0xff51,\n  HDMA2: 0xff52,\n  HDMA3: 0xff53,\n  HDMA4: 0xff54,\n  HDMA5: 0xff55,\n  BCPS: 0xff68,\n  BCPD: 0xff69,\n  OCPS: 0xff6a,\n  OCPD: 0xff6b,\n  OPRI: 0xff6c,\n};\n\nexport const LCDC = {\n  BG_WINDOW_DISPLAY: 1,\n  OBJ_DISPLAY: 2,\n  OBJ_SIZE: 4,\n  BG_TILE_MAP_DISPLAY_SELECT: 8,\n  BG_WINDOW_TILE_DATA_SELECT: 16,\n  WINDOW_DISPLAY: 32,\n  WINDOW_TILE_MAP_DISPLAY_SELECT: 64,\n  ENABLED: 128,\n};\n\nconst VBLANK_LY = 144;\nconst MAX_LY = 153;\n\nconst LINE_CLOCK_MODE_0 = 208; // H-Blank\nconst LINE_CLOCK_MODE_2 = 80; // OAM scanning\nconst LINE_CLOCK_MODE_3 = 168; // Rendering\nconst LINE_CLOCK_MODE_23 = LINE_CLOCK_MODE_2 + LINE_CLOCK_MODE_3;\nconst LINE_CLOCK_MODE_230 = LINE_CLOCK_MODE_23 + LINE_CLOCK_MODE_0;\nconst LINE_CLOCK_VBLANK = 456; // V-Blank (each scanline)\n\nexport const LCD_WIDTH = 160;\nexport const LCD_HEIGHT = 144;\n\nconst SERIALIZE_FIELDS: (keyof PPU)[] = [\n  'lcdc',\n  'stat',\n  'scy',\n  'scx',\n  'ly',\n  'lyc',\n  'bgp',\n  'obp0',\n  'obp1',\n  'wy',\n  'wx',\n  'lineClock',\n  'clocks',\n  'mode',\n  'vramBank',\n  'bcps',\n  'ocps',\n];\n\nexport class PPU {\n  emulator: BaseEmulator | null = null;\n  interrupter!: Interrupter;\n  lcdc: number = 0;\n  stat: number = 0;\n  scy: number = 0;\n  scx: number = 0;\n  ly: number = 0;\n  lyc: number = 0;\n  bgp: number = 0;\n  obp0: number = 0;\n  obp1: number = 0;\n  wy: number = 0;\n  wx: number = 0;\n  // Clock used by each LY.\n  lineClock: number = 0;\n  clocks: number = 0;\n  mode: number = 0;\n  framebuffer!: Uint16Array;\n  lineData!: Uint8Array;\n  vram!: BankedRAM;\n  oam!: LockableRAM;\n\n  // CGB specific features\n  isCGB: boolean = false;\n  vramBank: number = 0;\n  bcps: number = 0;\n  ocps: number = 0;\n  bgPalette!: Uint8Array;\n  objPalette!: Uint8Array;\n  // This is hardcoded by CGB boot ROM\n  // opri: number = 0;\n\n  constructor(interrupter: Interrupter) {\n    this.setInterrupter(interrupter);\n    this.reset();\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    output.vram = this.vram.serialize();\n    output.oam = this.oam.serialize();\n    output.bgPalette = serializeBytes(this.bgPalette);\n    output.objPalette = serializeBytes(this.objPalette);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n    this.vram.deserialize(data.vram);\n    this.oam.deserialize(data.oam);\n    deserializeBytes(data.bgPalette, this.bgPalette);\n    deserializeBytes(data.objPalette, this.objPalette);\n  }\n\n  getDebugState(): string {\n    return [\n      `LCDC: ${this.lcdc.toString(16).padStart(2, '0')} STAT: ${this.stat.toString(16).padStart(2, '0')}`,\n      `LY: ${this.ly.toString(16).padStart(2, '0')} LYC: ${this.lyc.toString(16).padStart(2, '0')}`,\n      `LCLK: ${this.lineClock} CLK: ${this.clocks} VBK: ${this.vramBank}`,\n    ].join('\\n');\n  }\n\n  setInterrupter(interrupter: Interrupter): void {\n    this.interrupter = interrupter;\n  }\n\n  register(system: BaseSystem, emulator: BaseEmulator): void {\n    const { ioBus, memoryBus } = system;\n    this.emulator = emulator;\n    this.isCGB = system.type === SystemType.CGB;\n    // VRAM and OAM\n    memoryBus.register(0x80, 0x9f, this.vram);\n    memoryBus.register(0xfe, 0xfe, this.oam);\n    // GB registers\n    ioBus.register(0x40, 'LCDC', {\n      read: () => this.lcdc,\n      write: (_, value) => {\n        if ((this.lcdc & 0x80) !== (value & 0x80)) {\n          // LCD stopping / restarting\n          this.ly = 0;\n          this.mode = 0;\n          this.lineClock = 0;\n          this.clocks = 0;\n        }\n        this.lcdc = value;\n      },\n    });\n    ioBus.register(0x41, 'STAT', {\n      read: () => {\n        let bits = (this.stat & 0xf8);\n        bits |= this.mode;\n        if (this.ly === this.lyc) bits |= 4;\n        return bits;\n      },\n      write: (_, value) => {\n        this.stat = value;\n      },\n    });\n    ioBus.register(0x42, 'SCY', createAccessor(this, 'scy'));\n    ioBus.register(0x43, 'SCX', createAccessor(this, 'scx'));\n    ioBus.register(0x44, 'LY', createAccessor(this, 'ly'));\n    ioBus.register(0x45, 'LYC', createAccessor(this, 'lyc'));\n    ioBus.register(0x47, 'BGP', createAccessor(this, 'bgp'));\n    ioBus.register(0x48, 'OBP0', createAccessor(this, 'obp0'));\n    ioBus.register(0x49, 'OBP1', createAccessor(this, 'obp1'));\n    ioBus.register(0x4a, 'WY', createAccessor(this, 'wy'));\n    ioBus.register(0x4b, 'WX', createAccessor(this, 'wx'));\n    if (system.type === SystemType.CGB) {\n      // GBC registers\n      ioBus.register(0x4f, 'VBK', {\n        read: () => 0xfe | this.vramBank,\n        write: (_, value) => { this.vramBank = value & 1; },\n      });\n      ioBus.register(0x68, 'BCPS', createAccessor(this, 'bcps'));\n      ioBus.register(0x69, 'BCPD', {\n        read: () => {\n          const pos = this.bcps & 0x3f;\n          return this.bgPalette[pos];\n        },\n        write: (_, value) => {\n          const pos = this.bcps & 0x3f;\n          const autoIncrement = (this.bcps & 0x80) !== 0;\n          if (autoIncrement) {\n            this.bcps = ((this.bcps + 1) & 0x3f) | (this.bcps & 0x80);\n          }\n          this.bgPalette[pos] = value;\n        },\n      });\n      ioBus.register(0x6a, 'OCPS', createAccessor(this, 'ocps'));\n      ioBus.register(0x6b, 'OCPD', {\n        read: () => {\n          const pos = this.ocps & 0x3f;\n          return this.objPalette[pos];\n        },\n        write: (_, value) => {\n          const pos = this.ocps & 0x3f;\n          const autoIncrement = (this.ocps & 0x80) !== 0;\n          if (autoIncrement) {\n            this.ocps = ((this.ocps + 1) & 0x3f) | (this.ocps & 0x80);\n          }\n          this.objPalette[pos] = value;\n        },\n      });\n    }\n  }\n\n  reset() {\n    this.lcdc = 0x91;\n    this.stat = 0;\n    this.scy = 0;\n    this.scx = 0;\n    this.ly = 0;\n    this.lyc = 0;\n    this.bgp = 0xfc;\n    this.obp0 = 0xff;\n    this.obp1 = 0xff;\n    this.wy = 0;\n    this.wx = 0;\n    this.lineClock = 0;\n    this.clocks = 0;\n    this.mode = 0;\n    this.framebuffer = new Uint16Array(LCD_WIDTH * LCD_HEIGHT);\n    this.lineData = new Uint8Array(LCD_WIDTH);\n    this.vram = new BankedRAM(0x4000, () => false, () => this.vramBank * 0x2000);\n    this.oam = new LockableRAM(0x100, () => false);\n    this.vramBank = 0;\n    this.bcps = 0;\n    this.ocps = 0;\n    this.bgPalette = new Uint8Array(64);\n    this.objPalette = new Uint8Array(64);\n  }\n\n  handleLineChange(): void {\n    this.lineClock = 0;\n    if (this.ly > MAX_LY) {\n      // Reset ly to the top of the screen\n      this.ly = 0;\n    }\n    if (this.ly === this.lyc && (this.stat & 0x40)) {\n      // LYC=LY interrupt requested\n      this.interrupter.queueInterrupt(INTERRUPT_TYPE.LCDC);\n    }\n    if (this.ly < VBLANK_LY) {\n      this.mode = 2;\n      if (this.stat & 0x20) {\n        // OAM interrupt requested\n        this.interrupter.queueInterrupt(INTERRUPT_TYPE.LCDC);\n      }\n    } else if (this.ly === VBLANK_LY) {\n      this.clocks = 0;\n      this.mode = 1;\n      if (this.stat & 0x10) {\n        // V-blank interrupt requested\n        this.interrupter.queueInterrupt(INTERRUPT_TYPE.LCDC);\n      }\n      // Generate V-blank interrupt separately\n      this.interrupter.queueInterrupt(INTERRUPT_TYPE.VBLANK);\n    }\n  }\n\n  handleMode3Enter(): void {\n    this.mode = 3;\n  }\n\n  handleMode0Enter(): void {\n    this.mode = 0;\n    renderLine(this, this.ly);\n    if (this.stat & 0x08) {\n      // H-blank interrupt requested\n      this.interrupter.queueInterrupt(INTERRUPT_TYPE.LCDC);\n    }\n    this.emulator!.hdma.enterHBlank();\n  }\n\n  /**\n   * Called in each requestAnimationFrame to reset the data to V-Blank state.\n   */\n  resetClock(): void {\n    this.ly = VBLANK_LY;\n    this.lineClock = 0;\n    this.clocks = 0;\n    this.handleLineChange();\n  }\n\n  getNextWakeupClockAdvance(): number {\n    if (this.ly >= VBLANK_LY) {\n      return (LINE_CLOCK_VBLANK - this.lineClock) / 4;\n    }\n    if (this.lineClock < LINE_CLOCK_MODE_2) {\n      return (LINE_CLOCK_MODE_2 - this.lineClock) / 4;\n    }\n    if (this.lineClock < LINE_CLOCK_MODE_23) {\n      return (LINE_CLOCK_MODE_23 - this.lineClock) / 4;\n    }\n    return (LINE_CLOCK_MODE_230 - this.lineClock) / 4;\n  }\n\n  getRemainingClockUntilVblank(): number {\n    if ((this.lcdc & 0x80) === 0) {\n      // LCD turned off; assume 17556 clocks\n      return 17556;\n    }\n    return 17556 - this.clocks + 1;\n  }\n\n  advanceClock(): void {\n    if ((this.lcdc & 0x80) === 0) {\n      // LCD turned off; do nothing\n      return;\n    }\n    this.lineClock += 4;\n    if (this.ly >= VBLANK_LY) {\n      // VBlank\n      if (this.lineClock >= LINE_CLOCK_VBLANK) {\n        this.ly += 1;\n        this.handleLineChange();\n      }\n    } else if (this.lineClock === LINE_CLOCK_MODE_2) {\n      // OAM\n      this.handleMode3Enter();\n    } else if (this.lineClock === LINE_CLOCK_MODE_23) {\n      // Render\n      this.handleMode0Enter();\n    } else if (this.lineClock === LINE_CLOCK_MODE_230) {\n      // HBlank\n      this.ly += 1;\n      this.handleLineChange();\n    }\n    this.clocks += 1;\n  }\n}\n","import { PPU, LCDC } from \"../ppu/ppu\";\n\nconst PALETTE = [\n  0xffffffff,\n  0xaaaaaaff,\n  0x555555ff,\n  0x000000ff,\n];\n\n// TODO: Refactor this; this is copied from LCD render code\nfunction getBGTileDataAddress(lcd: PPU, id: number): number {\n  const bgTileSigned = (lcd.lcdc & LCDC.BG_WINDOW_TILE_DATA_SELECT) === 0;\n  if (bgTileSigned) {\n    // Video RAM starts with 0x8000. Therefore 0x800 here maps to 0x8800.\n    if (id >= 128) return 0x800 + (id - 128) * 16;\n    return 0x1000 + id * 16;\n  }\n  return id * 16;\n}\n\nfunction getBGTileId(lcd: PPU, x: number, y: number): number {\n  // Again, this is directly read from VRAM.\n  const bgMapBase = (lcd.lcdc & LCDC.BG_TILE_MAP_DISPLAY_SELECT) ? 0x1c00 : 0x1800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction getWindowTileId(lcd: PPU, x: number, y: number): number {\n  // Again, this is directly read from VRAM.\n  const bgMapBase = (lcd.lcdc & LCDC.WINDOW_TILE_MAP_DISPLAY_SELECT) ? 0x1c00 : 0x1800;\n  return lcd.vram.bytes[bgMapBase + (32 * y) + x];\n}\n\nfunction drawTilemap(lcd: PPU, bitmap: Uint8ClampedArray): void {\n  // BG\n  for (let y = 0; y < 256; y += 1) {\n    const vram = lcd.vram.bytes;\n    const drawY = y;\n    const tileY = (drawY / 8) & 0x1f;\n    const py = drawY % 8;\n\n    let currentX = 0;\n    do {\n      const drawX = currentX;\n      const tileX = (drawX / 8) & 0x1f;\n      let px = 7 - (drawX % 8);\n\n      // Read tile data of the current position\n      const tileId = getBGTileId(lcd, tileX, tileY);\n      const tileAddr = getBGTileDataAddress(lcd, tileId);\n      const tileLine1 = vram[tileAddr + py * 2];\n      const tileLine2 = vram[tileAddr + py * 2 + 1];\n\n      // Paint the pixel..\n      while (px >= 0) {\n        const colorId = ((tileLine1 >> px) & 1) | (((tileLine2 >> px) & 1) << 1);\n        const colorId2 = (lcd.bgp >> (colorId << 1)) & 0x03;\n        const color = PALETTE[colorId2];\n        const ax = currentX;\n        const ay = y;\n        bitmap[(ay * 512 + ax) * 4] = (color >>> 24) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 1] = (color >>> 16) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 2] = (color >>> 8) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 3] = color & 0xff;\n        px -= 1;\n        currentX += 1;\n      }\n    } while (currentX < 256);\n  }\n\n  // Window\n  for (let y = 0; y < 256; y += 1) {\n    const vram = lcd.vram.bytes;\n    const drawY = y;\n    const tileY = (drawY / 8) & 0x1f;\n    const py = drawY % 8;\n\n    let currentX = 0;\n    do {\n      const drawX = currentX;\n      const tileX = (drawX / 8) & 0x1f;\n      let px = 7 - (drawX % 8);\n\n      // Read tile data of the current position\n      const tileId = getWindowTileId(lcd, tileX, tileY);\n      const tileAddr = getBGTileDataAddress(lcd, tileId);\n      const tileLine1 = vram[tileAddr + py * 2];\n      const tileLine2 = vram[tileAddr + py * 2 + 1];\n\n      // Paint the pixel..\n      while (px >= 0) {\n        const colorId = ((tileLine1 >> px) & 1) | (((tileLine2 >> px) & 1) << 1);\n        const colorId2 = (lcd.bgp >> (colorId << 1)) & 0x03;\n        const color = PALETTE[colorId2];\n        const ax = currentX + 256;\n        const ay = y;\n        bitmap[(ay * 512 + ax) * 4] = (color >>> 24) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 1] = (color >>> 16) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 2] = (color >>> 8) & 0xff;\n        bitmap[(ay * 512 + ax) * 4 + 3] = color & 0xff;\n        px -= 1;\n        currentX += 1;\n      }\n    } while (currentX < 256);\n  }\n\n\n}\n\nexport function dumpVRAM(lcd: PPU): void {\n  let dumpEl = document.getElementById('dump-canvas');\n  if (dumpEl == null) {\n    dumpEl = document.createElement('canvas');\n    dumpEl.id = 'dump-canvas';\n    document.body.appendChild(dumpEl);\n  }\n  const canvas = dumpEl as HTMLCanvasElement;\n  canvas.width = 128;\n  canvas.height = 192;\n  const bitmap = new Uint8ClampedArray(128 * 192 * 4);\n  const vram = lcd.vram.bytes;\n  for (let i = 0; i < 384; i += 1) {\n    let px = (i % 16) * 8;\n    let py = Math.floor(i / 16) * 8;\n    for (let y = 0; y < 8; y += 1) {\n      const tileLine1 = vram[i * 16 + y * 2];\n      const tileLine2 = vram[i * 16 + y * 2 + 1];\n      for (let x = 0; x < 8; x += 1) {\n        const dx = 7 - x;\n        const colorId = ((tileLine1 >> dx) & 1) | (((tileLine2 >> dx) & 1) << 1);\n        const color = PALETTE[colorId];\n        const ax = px + x;\n        const ay = py + y;\n        bitmap[(ay * 128 + ax) * 4] = (color >>> 24) & 0xff;\n        bitmap[(ay * 128 + ax) * 4 + 1] = (color >>> 16) & 0xff;\n        bitmap[(ay * 128 + ax) * 4 + 2] = (color >>> 8) & 0xff;\n        bitmap[(ay * 128 + ax) * 4 + 3] = color & 0xff;\n      }\n    }\n  }\n  const ctx = canvas.getContext('2d');\n  const imgData = new ImageData(bitmap, 128, 192);\n  ctx?.putImageData(imgData, 0, 0);\n\n  let dumpEl3 = document.getElementById('dump-canvas-2');\n  if (dumpEl3 == null) {\n    dumpEl3 = document.createElement('canvas');\n    dumpEl3.id = 'dump-canvas-2';\n    document.body.appendChild(dumpEl3);\n  }\n  const canvas2 = dumpEl3 as HTMLCanvasElement;\n  canvas2.width = 512;\n  canvas2.height = 256;\n  const bitmap2 = new Uint8ClampedArray(512 * 256 * 4);\n  drawTilemap(lcd, bitmap2);\n  const ctx2 = canvas2.getContext('2d');\n  const imgData2 = new ImageData(bitmap2, 512, 256);\n  ctx2?.putImageData(imgData2, 0, 0);\n\n  let dumpEl2 = document.getElementById('dump-text');\n  if (dumpEl2 == null) {\n    dumpEl2 = document.createElement('div');\n    dumpEl2.id = 'dump-text';\n    dumpEl2.style.fontFamily = 'monospace';\n    document.body.appendChild(dumpEl2);\n  }\n  // Read OAM\n  const oam = lcd.oam.bytes;\n  const oams = [];\n  for (let i = 0; i < 160; i += 4) {\n    const spriteY = oam[i] - 16;\n    const spriteX = oam[i + 1] - 8;\n    const tileId = oam[i + 2];\n    const attributes = oam[i + 3];\n    oams.push(`${spriteX.toString(16).padStart(2, '0')} ${spriteY.toString(16).padStart(2, '0')} ${tileId.toString(16).padStart(2, '0')} ${attributes.toString(16).padStart(2, '0')}`);\n  }\n  dumpEl2.innerText = oams.join('\\n');\n}\n","import { PPU, LCD_HEIGHT, LCD_WIDTH } from \"../ppu/ppu\";\n\nconst PALETTE = [\n  0xffffffff,\n  0xaaaaaaff,\n  0x555555ff,\n  0x000000ff,\n];\n\nfunction convertColor(value: number): number {\n  if (value & 0x8000) {\n    // GB palette\n    return PALETTE[value & 0x3];\n  }\n  // CGB palette\n  const red = ((value & 0x1f) * 0xff / 0x1f) | 0;\n  const green = (((value >> 5) & 0x1f) * 0xff / 0x1f) | 0;\n  const blue = (((value >> 10) & 0x1f) * 0xff / 0x1f) | 0;\n  return (red << 24) | (green << 16) | (blue << 8) | 0xff;\n}\n\nexport function drawCanvas(lcd: PPU, canvas: CanvasRenderingContext2D): void {\n  const imgData = canvas.createImageData(LCD_WIDTH, LCD_HEIGHT);\n  const data = imgData.data;\n  for (let y = 0; y < LCD_HEIGHT; y += 1) {\n    for (let x = 0; x < LCD_WIDTH; x += 1) {\n      const colorValue = lcd.framebuffer[y * LCD_WIDTH + x];\n      const color = convertColor(colorValue);\n      data[(y * LCD_WIDTH + x) * 4] = (color >>> 24) & 0xff;\n      data[(y * LCD_WIDTH + x) * 4 + 1] = (color >>> 16) & 0xff;\n      data[(y * LCD_WIDTH + x) * 4 + 2] = (color >>> 8) & 0xff;\n      data[(y * LCD_WIDTH + x) * 4 + 3] = color & 0xff;\n    }\n  }\n  canvas.putImageData(imgData, 0, 0);\n}\n","export enum MBCType {\n  ROM,\n  MBC1,\n  MBC2,\n  MMM01,\n  MBC3,\n  MBC5,\n  MBC6,\n  MBC7,\n  POCKET_CAMERA,\n  BANDAI_TAMA5,\n  HUC3,\n  HUC1,\n}\n","import { MBCType } from './mbcType';\n\nexport interface CartridgeType {\n  mbcType: MBCType;\n  hasRAM: boolean;\n  hasBattery: boolean;\n  hasTimer: boolean;\n  hasRumble: boolean;\n  hasSensor: boolean;\n}\n\nexport function createCartridgeType(\n  mbcType: MBCType,\n  hasRAM: boolean = false,\n  hasBattery: boolean = false,\n  hasTimer: boolean = false,\n  hasRumble: boolean = false,\n  hasSensor: boolean = false,\n): CartridgeType {\n  return {\n    mbcType,\n    hasRAM,\n    hasBattery,\n    hasTimer,\n    hasRumble,\n    hasSensor,\n  };\n}\n\n/* eslint-disable no-useless-computed-key */\nexport const CARTRIDGE_TYPES: Record<number, CartridgeType | null> = {\n  [0x00]: createCartridgeType(MBCType.ROM),\n  [0x01]: createCartridgeType(MBCType.MBC1),\n  [0x02]: createCartridgeType(MBCType.MBC1, true),\n  [0x03]: createCartridgeType(MBCType.MBC1, true, true),\n  [0x05]: createCartridgeType(MBCType.MBC2, true),\n  [0x06]: createCartridgeType(MBCType.MBC2, true, true),\n  [0x08]: createCartridgeType(MBCType.ROM, true),\n  [0x09]: createCartridgeType(MBCType.ROM, true, true),\n  [0x0b]: createCartridgeType(MBCType.MMM01),\n  [0x0c]: createCartridgeType(MBCType.MMM01, true),\n  [0x0d]: createCartridgeType(MBCType.MMM01, true, true),\n  [0x0f]: createCartridgeType(MBCType.MBC3, false, true, true),\n  [0x10]: createCartridgeType(MBCType.MBC3, true, true, true),\n  [0x11]: createCartridgeType(MBCType.MBC3),\n  [0x12]: createCartridgeType(MBCType.MBC3, true),\n  [0x13]: createCartridgeType(MBCType.MBC3, true, true),\n  [0x19]: createCartridgeType(MBCType.MBC5),\n  [0x1a]: createCartridgeType(MBCType.MBC5, true),\n  [0x1b]: createCartridgeType(MBCType.MBC5, true, true),\n  [0x1c]: createCartridgeType(MBCType.MBC5, false, false, false, true),\n  [0x1d]: createCartridgeType(MBCType.MBC5, true, false, false, true),\n  [0x1e]: createCartridgeType(MBCType.MBC5, true, true, false, true),\n  [0x20]: createCartridgeType(MBCType.MBC6),\n  [0x22]: createCartridgeType(MBCType.MBC7, true, true, false, true, true),\n  [0xfc]: createCartridgeType(MBCType.POCKET_CAMERA),\n  [0xfd]: createCartridgeType(MBCType.BANDAI_TAMA5),\n  [0xfe]: createCartridgeType(MBCType.HUC3),\n  [0xff]: createCartridgeType(MBCType.HUC1, true, true),\n};\n/* eslint-enable no-useless-computed-key */\n","import { CartridgeType, CARTRIDGE_TYPES } from \"./cartridgeType\";\nimport { MBCType } from \"./mbcType\";\n\nexport interface CartridgeInfo {\n  title: string;\n  supportsCGB: boolean;\n  requiresCGB: boolean;\n  supportsSGB: boolean;\n  cartridgeType: CartridgeType;\n  romBanks: number;\n  romSize: number;\n  ramBanks: number;\n  ramSize: number;\n  sha1Sum: string;\n}\n\nconst RAM_BANKS = [0, 0, 1, 4, 16, 8];\n\nexport async function readCartridgeInfo(bytes: Uint8Array): Promise<CartridgeInfo> {\n  // 0134 - 0143 Title\n  // 0143 - CGB flag\n  // 0146 - SGB flag\n  // 0147 - Cartridge type\n  // 0148 - ROM size\n  // 0149 - RAM size\n  const titleBytes: string[] = [];\n  for (let i = 0; i < 16; i += 1) {\n    const byte = bytes[0x134 + i];\n    if (byte === 0 || byte >= 0x80) break;\n    titleBytes.push(String.fromCharCode(byte));\n  }\n  const title = titleBytes.join('');\n\n  const cgbFlag = bytes[0x143];\n  const supportsCGB = (cgbFlag & 0x80) !== 0;\n  const requiresCGB = (cgbFlag & 0x40) !== 0;\n  const supportsSGB = bytes[0x146] === 0x3;\n\n  const cartridgeType = CARTRIDGE_TYPES[bytes[0x147]];\n  if (cartridgeType == null) {\n    throw new Error(`Unknown cartridge type ${bytes[0x147].toString(16)}`);\n  }\n\n  const romBanks = 2 << bytes[0x148];\n  const romSize = 16 * 1024 * romBanks;\n\n  let ramBanks = RAM_BANKS[bytes[0x149]];\n  let ramSize = 8 * 1024 * ramBanks;\n  // MBC2 has 4Kbytes of RAM internally\n  if (cartridgeType.mbcType === MBCType.MBC2) {\n    ramBanks = 1;\n    ramSize = 4 * 1024;\n  }\n\n  // Run sha1 digestion using crypto API\n  const hash = await crypto.subtle.digest('SHA-1', bytes);\n  const hashBuf = new Uint8Array(hash);\n  const sha1Sum = Array.from(hashBuf).map((v) => v.toString(16).padStart(2, '0')).join('');\n\n  return {\n    title,\n    supportsCGB,\n    requiresCGB,\n    supportsSGB,\n    cartridgeType,\n    romBanks,\n    romSize,\n    ramBanks,\n    ramSize,\n    sha1Sum,\n  };\n}\n","import { deserializeBytes, serializeBytes } from '../../memory/utils';\nimport { MemoryBankController } from './mbc';\n\nexport class MBC1 implements MemoryBankController {\n  rom: Uint8Array;\n  ram: Uint8Array | null;\n  bank: number = 1;\n  ramEnabled: boolean = true;\n  ramUpdated: boolean = false;\n  bankingMode: boolean = false;\n\n  constructor(rom: Uint8Array, ram: Uint8Array | null) {\n    this.rom = rom;\n    this.ram = ram;\n  }\n\n  loadRAM(ram: Uint8Array): void {\n    this.ram = ram;\n  }\n\n  serializeRAM(): Uint8Array | null {\n    return this.ram;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.ram = this.ram != null ? serializeBytes(this.ram) : null;\n    output.bank = this.bank;\n    output.ramEnabled = this.ramEnabled;\n    output.ramUpdated = this.ramUpdated;\n    output.bankingMode = this.bankingMode;\n    return output;\n  }\n\n  deserialize(data: any): void {\n    if (this.ram != null) deserializeBytes(data.ram, this.ram);\n    this.bank = data.bank;\n    this.ramEnabled = data.ramEnabled;\n    this.ramUpdated = data.ramUpdated;\n    this.bankingMode = data.bankingMode;\n  }\n\n  getDebugState(): string {\n    return [\n      `Bank: ${this.bank.toString(16).padStart(2, '0')} Mode: ${this.bankingMode}`,\n    ].join('\\n');\n  }\n\n  read(pos: number): number {\n    // ROM Bank 00\n    if (pos < 0x4000) {\n      const highBank = this.bankingMode ? (this.bank & 0x60) : 0;\n      return this.rom[(highBank * 0x4000 + pos) % this.rom.length];\n    }\n    // ROM Bank 01..7F\n    if (pos < 0x8000) {\n      return this.rom[(this.bank * 0x4000 + (pos - 0x4000)) % this.rom.length];\n    }\n    // N/A\n    if (pos < 0xA000) return 0;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (this.ram == null) return 0xff;\n      const highBank = this.bankingMode ? ((this.bank >> 4) & 0x3) : 0;\n      return this.ram[(highBank * 0x2000 + (pos - 0xA000)) % this.ram.length];\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    // RAM Enable\n    if (pos < 0x2000) {\n      this.ramEnabled = (value & 0x0A) !== 0;\n      return;\n    }\n    // ROM Bank Number\n    if (pos < 0x4000) {\n      this.bank = (this.bank & ~0x1f) | (value & 0x1f);\n      if (this.bank === 0) {\n        this.bank = 1;\n      }\n      return;\n    }\n    // RAM Bank Number, or Upper Bits of ROM Bank Number\n    if (pos < 0x6000) {\n      this.bank = (this.bank & ~0x60) | ((value << 4) & 0x60);\n      return;\n    }\n    // Banking Mode Select\n    if (pos < 0x8000) {\n      this.bankingMode = value !== 0;\n      return;\n    }\n    // Noop\n    if (pos < 0xA000) return;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (this.ram == null) return;\n      const highBank = this.bankingMode ? ((this.bank >> 4) & 0x3) : 0;\n      this.ram[(highBank * 0x2000 + (pos - 0xA000)) % this.ram.length] = value;\n      this.ramUpdated = true;\n    }\n  }\n\n  reset(): void {\n    // NOTE: Don't reset SRAM\n    this.bank = 1;\n    this.bankingMode = false;\n  }\n}\n","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}","import { CPU } from \"../cpu/cpu\";\nimport { Memory } from \"../memory/types\";\nimport { loadRTC, saveRTC } from \"./rtcSave\";\n\nexport interface RTCData {\n  seconds: number;\n  minutes: number;\n  hours: number;\n  days: number;\n  halted: boolean;\n}\n\nexport class RTC implements Memory {\n  cpu: CPU;\n  selectedRegister: number;\n  // Note that this does not use unix timestamp; instead, we link them with\n  // CPU cycles...\n  data: RTCData;\n  latchedData: RTCData | null;\n  prevClocks: number;\n\n  constructor(cpu: CPU) {\n    this.cpu = cpu;\n    this.selectedRegister = 0;\n    this.data = { seconds: 0, minutes: 0, hours: 0, days: 0, halted: false };\n    this.latchedData = null;\n    this.prevClocks = 0;\n  }\n\n  load(input: Uint8Array, offset: number): void {\n    this.prevClocks = 0;\n    this.data = loadRTC(input, offset);\n    this.latchedData = null;\n  }\n\n  save(output: Uint8Array, offset: number): void {\n    saveRTC(this.data, output, offset);\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.selectedRegister = this.selectedRegister;\n    output.data = { ...this.data };\n    output.latchedData = this.latchedData;\n    output.prevClocks = this.prevClocks;\n    return output;\n  }\n\n  deserialize(data: any): void {\n    this.selectedRegister = data.selectedRegister;\n    this.data = { ...data.data };\n    this.latchedData = data.latchedData ?? null;\n    this.prevClocks = data.prevClocks;\n  }\n\n  reset(): void {\n    this.prevClocks = 0;\n  }\n\n  _updateRTC(): void {\n    const clocks = this.cpu.clocks;\n    if (this.data.halted) {\n      this.prevClocks = clocks;\n      return;\n    }\n    const diff = clocks - this.prevClocks;\n    // Only increment the clock when the clocks are more than 1MHz\n    const addSeconds = Math.floor(diff / 1048576);\n    if (addSeconds > 0) {\n      const newSeconds = Math.min(this.data.seconds, 59) + addSeconds;\n      const newMinutes = Math.min(this.data.minutes, 59) + Math.floor(newSeconds / 60);\n      const newHours = Math.min(this.data.hours, 23) + Math.floor(newMinutes / 60);\n      const newDays = this.data.days + Math.floor(newHours / 24);\n      this.data.seconds = newSeconds % 60;\n      this.data.minutes = newMinutes % 60;\n      this.data.hours = newHours % 24;\n      this.data.days = newDays;\n      this.prevClocks += addSeconds * 1048576;\n    }\n  }\n\n  read(pos: number): number {\n    if (pos >= 0xa000 && pos < 0xc000) {\n      // RTC read request\n      this._updateRTC();\n      const data = this.latchedData ?? this.data;\n      switch (this.selectedRegister) {\n        case 0x8:\n          return data.seconds;\n        case 0x9:\n          return data.minutes;\n        case 0xa:\n          return data.hours;\n        case 0xb:\n          return data.days & 0xff;\n        case 0xc: {\n          let output = (data.days >>> 8) & 1;\n          if (data.halted) output |= 0x40;\n          if (data.days >= 0x200) output |= 0x80;\n          return output;\n        }\n        default:\n          return 0xff;\n      }\n    }\n    return 0xff;\n  }\n\n  write(pos: number, value: number): void {\n    if (pos >= 0x4000 && pos < 0x6000) {\n      // RTC register select\n      this.selectedRegister = value;\n    } else if (pos >= 0xa000 && pos < 0xc000) {\n      // RTC write request\n      this._updateRTC();\n      switch (this.selectedRegister) {\n        case 0x8:\n          this.data.seconds = value;\n          break;\n        case 0x9:\n          this.data.minutes = value;\n          break;\n        case 0xa:\n          this.data.hours = value;\n          break;\n        case 0xb:\n          this.data.days = (this.data.days & ~0xff) | (value & 0xff);\n          break;\n        case 0xc: {\n          this.data.days = (this.data.days & ~0x100) | ((value & 1) << 8);\n          this.data.halted = (value & 0x40) !== 0;\n          if ((value & 0x80) !== 0) {\n            this.data.days = this.data.days & 0x1ff;\n          }\n          break;\n        }\n      }\n    } else if (pos >= 0x6000 && pos < 0x8000) {\n      // Latch clock data\n      if (value === 1) {\n        this._updateRTC();\n        if (this.latchedData != null) {\n          this.latchedData = null;\n        } else {\n          this.latchedData = { ...this.data };\n        }\n      }\n    }\n  }\n}\n","import { RTCData } from './rtc';\n\nexport function saveRTC(rtc: RTCData, output: Uint8Array, offset: number): void {\n  output[offset] = rtc.seconds;\n  output[offset + 4] = rtc.minutes;\n  output[offset + 8] = rtc.hours;\n  output[offset + 12] = rtc.days & 0xff;\n  output[offset + 16] = (rtc.days >> 8) & 0xff;\n  output[offset + 20] = rtc.seconds;\n  output[offset + 24] = rtc.minutes;\n  output[offset + 28] = rtc.hours;\n  output[offset + 32] = rtc.days & 0xff;\n  output[offset + 36] = (rtc.days >> 8) & 0xff;\n  const view = new DataView(output.buffer, output.byteOffset + offset);\n  const date = Math.floor(Date.now() / 1000);\n  view.setUint32(40, date % 0x100000000, true);\n  view.setUint32(44, Math.floor(date / 0x100000000), true);\n}\n\nexport function loadRTC(input: Uint8Array, offset: number): RTCData {\n  if (offset + 48 > input.length) {\n    return { seconds: 0, minutes: 0, hours: 0, days: 0, halted: false };\n  }\n  const oldSeconds = input[offset];\n  const oldMinutes = input[offset + 4];\n  const oldHours = input[offset + 8];\n  const oldDays = input[offset + 12] | (input[offset + 16] << 8);\n  const view = new DataView(input.buffer, input.byteOffset + offset);\n  const dateBefore = view.getUint32(40, true) + (view.getUint32(44, true) * 0x100000000);\n  const dateDiff = Math.floor(Date.now() / 1000) - dateBefore;\n  // Increment the time\n  const seconds = oldSeconds + dateDiff;\n  const minutes = oldMinutes + Math.floor(seconds / 60);\n  const hours = oldHours + Math.floor(minutes / 60);\n  const days = oldDays + Math.floor(hours / 24);\n  return {\n    seconds: seconds % 60,\n    minutes: minutes % 60,\n    hours: hours % 24,\n    days: days,\n    halted: false,\n  };\n}\n","import { CPU } from '../../cpu/cpu';\nimport { deserializeBytes, serializeBytes } from '../../memory/utils';\nimport { RTC } from '../rtc';\nimport { MemoryBankController } from './mbc';\n\nexport class MBC3 implements MemoryBankController {\n  rom: Uint8Array;\n  ram: Uint8Array | null;\n  hasRTC: boolean;\n  rtc: RTC;\n  romBank: number = 1;\n  ramBank: number = 0;\n  ramEnabled: boolean = true;\n  ramUpdated: boolean = false;\n\n  constructor(rom: Uint8Array, ram: Uint8Array | null, cpu: CPU, hasRTC: boolean) {\n    this.rom = rom;\n    this.ram = ram;\n    this.rtc = new RTC(cpu);\n    this.hasRTC = hasRTC;\n  }\n\n  loadRAM(ram: Uint8Array): void {\n    if (this.hasRTC) {\n      this.ram = ram.slice(0, this.ram!.length);\n      this.rtc.load(ram, this.ram!.length);\n    } else {\n      this.ram = ram;\n    }\n  }\n\n  serializeRAM(): Uint8Array | null {\n    if (this.hasRTC) {\n      const saveData = new Uint8Array(this.ram!.length + 48);\n      saveData.set(this.ram!, 0);\n      this.rtc.save(saveData, this.ram!.length);\n      return saveData;\n    } else {\n      return this.ram;\n    }\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.ram = this.ram != null ? serializeBytes(this.ram) : null;\n    output.rtc = this.rtc.serialize();\n    output.romBank = this.romBank;\n    output.ramBank = this.ramBank;\n    output.ramEnabled = this.ramEnabled;\n    output.ramUpdated = this.ramUpdated;\n    return output;\n  }\n\n  deserialize(data: any): void {\n    if (this.ram != null) deserializeBytes(data.ram, this.ram);\n    this.rtc.deserialize(data.rtc);\n    this.romBank = data.romBank;\n    this.ramBank = data.ramBank;\n    this.ramEnabled = data.ramEnabled;\n    this.ramUpdated = data.ramUpdated;\n  }\n\n  getDebugState(): string {\n    return [\n      `ROM Bank: ${this.romBank} RAM Bank: ${this.ramBank}`,\n    ].join('\\n');\n  }\n\n  read(pos: number): number {\n    // ROM Bank 00\n    if (pos < 0x4000) return this.rom[pos];\n    // ROM Bank 01..7F\n    if (pos < 0x8000) {\n      return this.rom[(this.romBank * 0x4000 + (pos - 0x4000)) % this.rom.length];\n    }\n    // N/A\n    if (pos < 0xA000) return 0;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (!this.ramEnabled) return 0xff;\n      if (this.ramBank < 3) {\n        if (this.ram == null) return 0xff;\n        return this.ram[(this.ramBank * 0x2000 + (pos - 0xA000)) % this.ram.length];\n      } else {\n        return this.rtc.read(pos);\n      }\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    // RAM and Timer Enable\n    if (pos < 0x2000) {\n      this.ramEnabled = (value & 0x0A) !== 0;\n      return;\n    }\n    // ROM Bank Number\n    if (pos < 0x4000) {\n      this.romBank = value & 0x7f;\n      if (this.romBank === 0) {\n        this.romBank = 1;\n      }\n      return;\n    }\n    // RAM Bank Number\n    if (pos < 0x6000) {\n      this.ramBank = value & 0x0f;\n      this.rtc.write(pos, value);\n      return;\n    }\n    // Latch Clock Data\n    if (pos < 0x8000) {\n      this.rtc.write(pos, value);\n      return;\n    }\n    // Noop\n    if (pos < 0xA000) return;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (!this.ramEnabled) return;\n      if (this.ramBank < 3) {\n        if (this.ram == null) return;\n        this.ram[(this.ramBank * 0x2000 + (pos - 0xA000)) % this.ram.length] = value;\n        this.ramUpdated = true;\n      } else {\n        // RTC Access\n        this.rtc.write(pos, value);\n      }\n    }\n  }\n\n  reset(): void {\n    // NOTE: Don't reset SRAM\n    this.romBank = 1;\n    this.ramBank = 0;\n  }\n}\n","import { deserializeBytes, serializeBytes } from '../../memory/utils';\nimport { MemoryBankController } from './mbc';\n\nexport class MBC5 implements MemoryBankController {\n  rom: Uint8Array;\n  ram: Uint8Array | null;\n  romBank: number = 1;\n  ramBank: number = 0;\n  ramEnabled: boolean = true;\n  initialTime: number = Date.now();\n  latchedTime: Date | null = null;\n  ramUpdated: boolean = false;\n\n  constructor(rom: Uint8Array, ram: Uint8Array | null) {\n    this.rom = rom;\n    this.ram = ram;\n  }\n\n  loadRAM(ram: Uint8Array): void {\n    this.ram = ram;\n  }\n\n  serializeRAM(): Uint8Array | null {\n    return this.ram;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.ram = this.ram != null ? serializeBytes(this.ram) : null;\n    output.romBank = this.romBank;\n    output.ramBank = this.ramBank;\n    output.ramEnabled = this.ramEnabled;\n    output.ramUpdated = this.ramUpdated;\n    return output;\n  }\n\n  deserialize(data: any): void {\n    if (this.ram != null) deserializeBytes(data.ram, this.ram);\n    this.romBank = data.romBank;\n    this.ramBank = data.ramBank;\n    this.ramEnabled = data.ramEnabled;\n    this.ramUpdated = data.ramUpdated;\n  }\n\n  getDebugState(): string {\n    return [\n      `ROM Bank: ${this.romBank} RAM Bank: ${this.ramBank}`,\n    ].join('\\n');\n  }\n\n  read(pos: number): number {\n    // ROM Bank 00\n    if (pos < 0x4000) return this.rom[pos];\n    // ROM Bank 01..7F\n    if (pos < 0x8000) {\n      return this.rom[(this.romBank * 0x4000 + (pos - 0x4000)) % this.rom.length];\n    }\n    // N/A\n    if (pos < 0xA000) return 0;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (this.ram == null) return 0xff;\n      return this.ram[(this.ramBank * 0x2000 + (pos - 0xA000)) % this.ram.length];\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    // RAM and Timer Enable\n    if (pos < 0x2000) {\n      this.ramEnabled = (value & 0x0A) !== 0;\n      return;\n    }\n    // ROM Bank Number (Low)\n    if (pos < 0x3000) {\n      this.romBank = (this.romBank & 0x100) | (value & 0xff);\n      return;\n    }\n    // ROM Bank Number (High)\n    if (pos < 0x4000) {\n      this.romBank = ((value << 8) & 0x100) | (this.romBank & 0xff);\n      return;\n    }\n    // RAM Bank Number\n    if (pos < 0x6000) {\n      this.ramBank = value & 0x0f;\n      return;\n    }\n    // Noop\n    if (pos < 0xA000) return;\n    // RAM Bank 00..03\n    if (pos < 0xC000) {\n      if (this.ram == null) return;\n      this.ram[(this.ramBank * 0x2000 + (pos - 0xA000)) % this.ram.length] = value;\n      this.ramUpdated = true;\n    }\n  }\n\n  reset(): void {\n    // NOTE: Don't reset SRAM\n    this.romBank = 1;\n    this.ramBank = 0;\n  }\n}\n\n","import { CPU } from \"../cpu/cpu\";\nimport { BaseSystem } from \"../system/baseSystem\";\nimport { CartridgeInfo, readCartridgeInfo } from \"./info\";\nimport { MemoryBankController } from \"./mbc/mbc\";\nimport { MBC1 } from \"./mbc/mbc1\";\nimport { MBC3 } from \"./mbc/mbc3\";\nimport { MBC5 } from \"./mbc/mbc5\";\nimport { MBCType } from \"./mbcType\";\n\nexport class Cartridge {\n  info: CartridgeInfo;\n  mbc: MemoryBankController;\n\n  constructor(info: CartridgeInfo, mbc: MemoryBankController) {\n    this.info = info;\n    this.mbc = mbc;\n  }\n\n  register(system: BaseSystem): void {\n    system.memoryBus.register(0x00, 0x7f, this.mbc);\n    system.memoryBus.register(0xa0, 0xbf, this.mbc, 0);\n  }\n\n  reset(): void {\n    this.mbc.reset();\n  }\n}\n\nfunction createSRAM(size: number): Uint8Array | null {\n  if (size === 0) return null;\n  return new Uint8Array(size);\n}\n\nexport async function loadCartridge(cpu: CPU, rom: Uint8Array): Promise<Cartridge> {\n  const info = await readCartridgeInfo(rom);\n  const ram = createSRAM(info.ramSize);\n  // Note that we don't perform any I/O here\n  switch (info.cartridgeType.mbcType) {\n    case MBCType.ROM:\n      return new Cartridge(info, new MBC3(rom, ram, cpu, info.cartridgeType.hasTimer));\n    case MBCType.MBC1:\n      return new Cartridge(info, new MBC1(rom, ram));\n    case MBCType.MBC3:\n      return new Cartridge(info, new MBC3(rom, ram, cpu, info.cartridgeType.hasTimer));\n    case MBCType.MBC5:\n      return new Cartridge(info, new MBC5(rom, ram));\n    default:\n      console.log(info);\n      throw new Error('This cartridge is not supported yet');\n  }\n}\n","import localforage from 'localforage';\nimport { CartridgeInfo } from '../cartridge/info';\n\ninterface SaveDataFormat {\n  title: string;\n  data: Uint8Array;\n}\n\nexport async function readSaveStorage(cartInfo: CartridgeInfo): Promise<Uint8Array | null> {\n  const key = `save-${cartInfo.sha1Sum}`;\n  const save = await localforage.getItem(key) as SaveDataFormat | null;\n  if (save == null) return null;\n  return save.data;\n}\n\nexport async function writeSaveStorage(cartInfo: CartridgeInfo, data: Uint8Array): Promise<void> {\n  const key = `save-${cartInfo.sha1Sum}`;\n  const save: SaveDataFormat = {\n    title: cartInfo.title,\n    data,\n  };\n  await localforage.setItem(key, save);\n}\n","import { PSGModule } from \"./psg\";\n\nconst SERIALIZE_FIELDS: (keyof EnvelopePSGModule)[] = [\n  'initialVolume',\n  'currentVolume',\n  'increasing',\n  'pace',\n  'clock',\n];\n\nexport class EnvelopePSGModule implements PSGModule {\n  initialVolume: number = 0;\n  currentVolume: number = 0;\n  increasing: boolean = false;\n  pace: number = 0;\n  clock: number = 0;\n\n  reset(): void {\n    this.initialVolume = 0;\n    this.currentVolume = 0;\n    this.increasing = false;\n    this.pace = 0;\n    this.clock = 0;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  trigger(): void {\n    this.currentVolume = this.initialVolume;\n    this.clock = 0;\n  }\n\n  getDebugState(): string {\n    return `V: ${this.currentVolume.toString(16)} EP: ${this.increasing ? '+' : '-'}${this.pace.toString(16)}`;\n  }\n\n  get(): number {\n    return this.currentVolume / 0xf;\n  }\n\n  getNextClocks(clocks: number): number {\n    if (this.pace === 0) return clocks;\n    const width = 65536 * this.pace;\n    const remaining = width - this.clock;\n    return Math.min(clocks, remaining);\n  }\n\n  step(clocks: number): void {\n    const width = 65536 * this.pace;\n    this.clock += clocks;\n    if (this.pace > 0 && this.clock >= width) {\n      this.clock = 0;\n      if (this.increasing) {\n        this.currentVolume = Math.min(this.currentVolume + 1, 0xf);\n      } else {\n        this.currentVolume = Math.max(this.currentVolume - 1, 0);\n      }\n    }\n  }\n\n  read(pos: number): number {\n    if (pos === 2) {\n      // NR12 - Volume & envelope\n      let output = 0x100;\n      output |= this.pace & 0x7;\n      if (this.increasing) output |= 0x8;\n      output |= (this.initialVolume & 0xf) << 4;\n      return output;\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    if (pos === 2) {\n      // NR12 - Volume & envelope\n      this.pace = value & 0x7;\n      this.increasing = (value & 0x8) !== 0;\n      this.initialVolume = (value >> 4) & 0xf;\n    }\n  }\n\n}\n\n","import { PSGModule } from \"./psg\";\n\nconst SERIALIZE_FIELDS: (keyof LengthPSGModule)[] = [\n  'enabled',\n  'initialLength',\n  'currentLength',\n  'clock',\n];\n\nexport interface LengthPSGConfig {\n  enabled: boolean;\n}\n\nexport class LengthPSGModule implements PSGModule {\n  enabled: boolean = false;\n  initialLength: number = 0;\n  currentLength: number = 0;\n  clock: number = 0;\n  config: LengthPSGConfig;\n\n  constructor(config: LengthPSGConfig) {\n    this.config = config;\n  }\n\n  reset(): void {\n    this.enabled = false;\n    this.initialLength = 0;\n    this.currentLength = 0;\n    this.clock = 0;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  trigger(): void {\n    this.currentLength = this.initialLength;\n    this.clock = 0;\n  }\n\n  getDebugState(): string {\n    return `L: ${this.enabled ? this.currentLength.toString(16).padStart(2, '0') : '-1'}`;\n  }\n\n  getNextClocks(clocks: number): number {\n    if (!this.enabled) return clocks;\n    const width = 16384;\n    const remaining = width - this.clock;\n    return Math.min(clocks, remaining);\n  }\n\n  step(clocks: number): void {\n    const width = 16384;\n    this.clock += clocks;\n    if (this.enabled && this.clock >= width) {\n      this.clock = 0;\n      this.currentLength = Math.min(this.currentLength + 1, 64);\n      if (this.currentLength === 64) {\n        this.config.enabled = false;\n      }\n    }\n  }\n\n  read(pos: number): number {\n    if (pos === 4) {\n      // NR14 - Wavelength high & control\n      let output = 0x100;\n      if (this.enabled) output |= 0x8;\n      return output;\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    if (pos === 1) {\n      this.initialLength = value & 0x1f;\n    } else if (pos === 4) {\n      // NR14 - Wavelength high & control\n      this.enabled = (value & 0x40) !== 0;\n    }\n  }\n\n}\n\n\n","import { EnvelopePSGModule } from \"./envelope\";\nimport { LengthPSGModule } from \"./length\";\nimport { PSG } from \"./psg\";\n\nconst SERIALIZE_FIELDS: (keyof NoisePSG)[] = [\n  'enabled',\n  'phaseClock',\n  'clockShift',\n  'clockDivider',\n  'lfsr',\n  'lfsr7Bit',\n];\n\nexport class NoisePSG implements PSG {\n  output: number = 0;\n  enabled: boolean = false;\n\n  phaseClock: number = 0;\n  clockShift: number = 0;\n  clockDivider: number = 0;\n  lfsr: number = 0;\n  lfsr7Bit: boolean = false;\n\n  envelope: EnvelopePSGModule;\n  length: LengthPSGModule;\n\n  constructor() {\n    this.envelope = new EnvelopePSGModule();\n    this.length = new LengthPSGModule(this);\n    this.reset();\n  }\n\n  reset(): void {\n    this.output = 0;\n    this.enabled = false;\n\n    this.phaseClock = 0;\n    this.clockShift = 0;\n    this.clockDivider = 0;\n    this.lfsr = 0;\n    this.lfsr7Bit = false;\n\n    this.envelope.reset();\n    this.length.reset();\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    output.envelope = this.envelope.serialize();\n    output.length = this.length.serialize();\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n    this.envelope.deserialize(data.envelope);\n    this.length.deserialize(data.length);\n  }\n\n  trigger(): void {\n    this.output = 0;\n    this.enabled = true;\n    this.phaseClock = 0;\n    this.lfsr = 0;\n    this.envelope.trigger();\n    this.length.trigger();\n  }\n\n  getDebugState(): string {\n    let r = this.clockDivider;\n    if (r === 0) r = 0.5;\n    const phaseWidth = 16 * r * (1 << this.clockShift);\n    const hz = Math.floor((4 * 1024 * 1024) / phaseWidth);\n    return [\n      `E: ${this.enabled ? '1' : '0'} S: ${this.clockShift} D: ${this.clockDivider} (${hz}Hz)`,\n      this.envelope.getDebugState(),\n      this.length.getDebugState(),\n    ].join(' ');\n  }\n\n  step(clocks: number): void {\n    let remainingClocks = clocks;\n    while (remainingClocks > 0) {\n      if (!this.enabled) break;\n      // Calculate clocks for each trigger\n      // The clock is 262144 / (r * (2^s)) Hz, where r is 0.5 when r = 0\n      // Meaning that this is triggered every 16 * r * 2^s clocks.\n      let r = this.clockDivider;\n      if (r === 0) r = 0.5;\n      const phaseWidth = 16 * r * (1 << this.clockShift);\n      const phaseRemaining = phaseWidth - this.phaseClock;\n\n      // Calculate the smallest trigger\n      let consumedClocks = Math.min(phaseRemaining, remainingClocks);\n      consumedClocks = this.envelope.getNextClocks(consumedClocks);\n      consumedClocks = this.length.getNextClocks(consumedClocks);\n\n      this.phaseClock += consumedClocks;\n      if (this.phaseClock >= phaseWidth) {\n        this.phaseClock = 0;\n\n        // Update LFSR\n        const setBit = this.lfsr7Bit ? 0x8080 : 0x8000;\n        let lfsr = this.lfsr\n        lfsr = lfsr | (((lfsr & 1) !== ((lfsr >> 1) & 1)) ? 0 : setBit);\n        lfsr = lfsr >>> 1;\n        this.lfsr = lfsr;\n      }\n      this.envelope.step(consumedClocks);\n      this.length.step(consumedClocks);\n\n      remainingClocks -= consumedClocks;\n    }\n    // Calculate current output\n    if (this.enabled) {\n      const signal = this.lfsr & 1;\n      this.output = (signal ? -1 : 1) * this.envelope.get();\n    } else {\n      this.output = 0;\n    }\n  }\n\n  _read(pos: number): number {\n    switch (pos) {\n      case 3:\n        // NR13 - Frequency & randomness\n        let output = 0x100;\n        output |= (this.clockShift & 0xf) << 4;\n        if (this.lfsr7Bit) output |= 0x8;\n        output |= this.clockDivider & 0x7;\n        return output;\n      default:\n        return 0;\n    }\n  }\n\n  read(pos: number): number {\n    let output = this._read(pos);\n    output |= this.envelope.read(pos);\n    output |= this.length.read(pos);\n    if (output & 0x100) return output;\n    return 0xff;\n  }\n\n  _write(pos: number, value: number): void {\n    switch (pos) {\n      case 3:\n        // NR13 - Frequency & randomness\n        this.clockShift = (value >> 4) & 0xf;\n        this.lfsr7Bit = (value & 0x8) !== 0;\n        this.clockDivider = value & 0x7;\n        break;\n      case 4: \n        // NR44 - Control\n        if (value & 0x80) this.trigger();\n        break;\n    }\n  }\n\n  write(pos: number, value: number): void {\n    this._write(pos, value);\n    this.envelope.write(pos, value);\n    this.length.write(pos, value);\n  }\n\n}\n","import { RAM } from \"../../memory/ram\";\nimport { LengthPSGModule } from \"./length\";\nimport { PSG } from \"./psg\";\n\nconst OUTPUT_LEVELS = [0, 1, 0.5, 0.25];\n\nconst SERIALIZE_FIELDS: (keyof PCMPSG)[] = [\n  'dacEnabled',\n  'enabled',\n  'phase',\n  'phaseClock',\n  'wavelength',\n  'outputLevel',\n];\n\nexport class PCMPSG implements PSG {\n  output: number = 0;\n  dacEnabled: boolean = false;\n  enabled: boolean = false;\n\n  phase: number = 0;\n  phaseClock: number = 0;\n  wavelength: number = 0;\n  outputLevel: number = 0;\n\n  waveTable: RAM;\n\n  length: LengthPSGModule;\n\n  constructor(waveTable: RAM) {\n    this.length = new LengthPSGModule(this);\n    this.waveTable = waveTable; \n    this.reset();\n  }\n\n  reset(): void {\n    this.output = 0;\n    this.dacEnabled = false;\n    this.enabled = false;\n\n    this.phase = 0;\n    this.phaseClock = 0;\n    this.wavelength = 0;\n    this.outputLevel = 0;\n\n    this.length.reset();\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    output.length = this.length.serialize();\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n    this.length.deserialize(data.length);\n  }\n\n  trigger(): void {\n    this.output = 0;\n    this.enabled = true;\n    this.dacEnabled = true;\n    this.phase = 0;\n    this.phaseClock = 0;\n    this.length.trigger();\n  }\n\n  getDebugState(): string {\n    return [\n      `E: ${this.enabled ? '1' : '0'} WL: ${this.wavelength.toString(16).padStart(3, '0')} (${this.getHz()}Hz) V: ${this.outputLevel}`,\n      this.length.getDebugState(),\n    ].join(' ');\n  }\n  \n  getHz(): number {\n    return Math.floor((4 * 1024 * 1024) / (32 * 2 * (2048 - this.wavelength)));\n  }\n\n  step(clocks: number): void {\n    let remainingClocks = clocks;\n    while (remainingClocks > 0) {\n      if (!this.enabled || !this.dacEnabled) break;\n      // Calculate clocks for each trigger\n      const phaseWidth = 2 * (2048 - this.wavelength);\n      const phaseRemaining = phaseWidth - this.phaseClock;\n\n      // Calculate the smallest trigger\n      let consumedClocks = Math.min(phaseRemaining, remainingClocks);\n      consumedClocks = this.length.getNextClocks(consumedClocks);\n\n      this.phaseClock += consumedClocks;\n      if (this.phaseClock >= phaseWidth) {\n        this.phaseClock = 0;\n        this.phase = (this.phase + 1) % 32;\n      }\n      this.length.step(consumedClocks);\n\n      remainingClocks -= consumedClocks;\n    }\n    // Calculate current output\n    if (this.enabled && this.dacEnabled) {\n      const readAddr = this.phase >> 1;\n      const readNibble = this.phase & 1;\n      const byte = this.waveTable.read(readAddr);\n      const signal = ((byte >> (readNibble ? 0 : 4)) & 0xf) / 0xf;\n      this.output = (signal * 2 - 1) * OUTPUT_LEVELS[this.outputLevel];\n    } else {\n      this.output = 0;\n    }\n  }\n\n  _read(pos: number): number {\n    switch (pos) {\n      case 0: {\n        // NR30 - DAC Enable\n        let output = 0x100;\n        if (this.dacEnabled) output |= 0x80;\n        return output;\n      }\n      case 2:\n        // NR32 - Output level\n        return 0x100 | ((this.outputLevel & 0x3) << 5);\n      case 3:\n        // NR33 - Wavelength low\n        return 0x100 | (this.wavelength & 0xff);\n      case 4: {\n        // NR34 - Wavelength high & control\n        return 0x100 | ((this.wavelength >> 8) & 0x7);\n      }\n      default:\n        return 0;\n    }\n  }\n\n  read(pos: number): number {\n    let output = this._read(pos);\n    output |= this.length.read(pos);\n    if (output & 0x100) return output;\n    return 0xff;\n  }\n\n  _write(pos: number, value: number): void {\n    switch (pos) {\n      case 0:\n        // NR30 - DAC Enable\n        this.dacEnabled = (value & 0x80) !== 0;\n        break;\n      case 2:\n        // NR32 - Output level\n        this.outputLevel = (value >> 5) & 0x3;\n        break;\n      case 3:\n        // NR13 - Wavelength low\n        this.wavelength = (this.wavelength & 0x700) | (value & 0xff);\n        break;\n      case 4: \n        // NR14 - Wavelength high & control\n        this.wavelength = (this.wavelength & 0xff) | ((value & 0x7) << 8);\n        if (value & 0x80) this.trigger();\n        break;\n    }\n  }\n\n  write(pos: number, value: number): void {\n    this._write(pos, value);\n    this.length.write(pos, value);\n  }\n\n}\n\n","import { PSGModule } from \"./psg\";\n\nconst SERIALIZE_FIELDS: (keyof SweepPSGModule)[] = [\n  'initialPace',\n  'pace',\n  'increasing',\n  'slope',\n  'clock',\n];\n\nexport interface SquarePSGConfig {\n  enabled: boolean;\n  wavelength: number;\n}\n\nexport class SweepPSGModule implements PSGModule {\n  initialPace: number = 0;\n  pace: number = 0;\n  increasing: boolean = false;\n  slope: number = 0;\n  clock: number = 0;\n  config: SquarePSGConfig;\n\n  constructor(config: SquarePSGConfig) {\n    this.config = config;\n  }\n\n  reset(): void {\n    this.initialPace = 0;\n    this.pace = 0;\n    this.increasing = false;\n    this.slope = 0;\n    this.clock = 0;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  trigger(): void {\n    this.clock = 0;\n    this.pace = this.initialPace;\n  }\n\n  getDebugState(): string {\n    return `SP: ${this.increasing ? '+' : '-'}${this.pace.toString(16)} ${this.slope.toString(16)}`;\n  }\n\n  getNextClocks(clocks: number): number {\n    if (this.pace === 0) return clocks;\n    const width = 32768 * this.pace;\n    const remaining = width - this.clock;\n    return Math.min(clocks, remaining);\n  }\n\n  step(clocks: number): void {\n    const width = 32768 * this.pace;\n    this.clock += clocks;\n    if (this.pace > 0 && this.clock >= width) {\n      this.clock = 0;\n      const wavelength = this.config.wavelength;\n      const nextWavelength = wavelength + (wavelength >>> this.slope) * (this.increasing ? 1 : -1);\n      if (nextWavelength >= 0x7ff) {\n        this.config.enabled = false;\n        this.config.wavelength = 0x7ff;\n      } else {\n        this.config.wavelength = nextWavelength;\n      }\n    }\n  }\n\n  read(pos: number): number {\n    if (pos === 0) {\n      // NR10 - Sweep\n      let output = 0x100;\n      output |= this.slope & 0x7;\n      if (!this.increasing) output |= 0x8;\n      output |= (this.initialPace & 0x7) << 4;\n      return output;\n    }\n    return 0;\n  }\n\n  write(pos: number, value: number): void {\n    if (pos === 0) {\n      // NR10 - Sweep\n      this.slope = value & 0x7;\n      this.increasing = (value & 0x8) === 0;\n      this.initialPace = (value >> 4) & 0x7;\n      if (this.initialPace === 0) {\n        this.pace = 0;\n      } else if (this.pace === 0) {\n        this.pace = this.initialPace;\n      }\n    }\n  }\n\n}\n","import { EnvelopePSGModule } from \"./envelope\";\nimport { LengthPSGModule } from \"./length\";\nimport { PSG } from \"./psg\";\nimport { SweepPSGModule } from \"./sweep\";\n\nconst DUTY_CYCLE_TABLE = [\n  0xFE, 0x7E, 0x78, 0x81,\n];\n\nconst SERIALIZE_FIELDS: (keyof SquarePSG)[] = [\n  'enabled',\n  'phase',\n  'phaseClock',\n  'wavelength',\n  'dutyCycle',\n];\n\nexport class SquarePSG implements PSG {\n  output: number = 0;\n  enabled: boolean = false;\n\n  phase: number = 0;\n  phaseClock: number = 0;\n  wavelength: number = 0;\n  dutyCycle: number = 0;\n\n  sweep: SweepPSGModule;\n  envelope: EnvelopePSGModule;\n  length: LengthPSGModule;\n\n  hasSweep: boolean;\n\n  constructor(hasSweep?: boolean) {\n    this.hasSweep = hasSweep ?? true;\n    this.sweep = new SweepPSGModule(this);\n    this.envelope = new EnvelopePSGModule();\n    this.length = new LengthPSGModule(this);\n    this.reset();\n  }\n\n  reset(): void {\n    this.output = 0;\n    this.enabled = false;\n\n    this.phase = 0;\n    this.phaseClock = 0;\n    this.wavelength = 0;\n    this.dutyCycle = 0;\n\n    this.sweep.reset();\n    this.envelope.reset();\n    this.length.reset();\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    output.sweep = this.sweep.serialize();\n    output.envelope = this.envelope.serialize();\n    output.length = this.length.serialize();\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n    this.sweep.deserialize(data.sweep);\n    this.envelope.deserialize(data.envelope);\n    this.length.deserialize(data.length);\n  }\n\n  trigger(): void {\n    this.output = 0;\n    this.enabled = true;\n    this.phase = 0;\n    this.phaseClock = 0;\n    this.sweep.trigger();\n    this.envelope.trigger();\n    this.length.trigger();\n  }\n\n  getDebugState(): string {\n    return [\n      `E: ${this.enabled ? '1' : '0'} WL: ${this.wavelength.toString(16).padStart(3, '0')} (${this.getHz()}Hz) DC: ${this.dutyCycle}`,\n      this.hasSweep ? this.sweep.getDebugState() : '',\n      this.envelope.getDebugState(),\n      this.length.getDebugState(),\n    ].filter((v) => v !== '').join(' ');\n  }\n  \n  getHz(): number {\n    return Math.floor((4 * 1024 * 1024) / (8 * 4 * (2048 - this.wavelength)));\n  }\n\n  step(clocks: number): void {\n    let remainingClocks = clocks;\n    while (remainingClocks > 0) {\n      if (!this.enabled) break;\n      // Calculate clocks for each trigger\n      const phaseWidth = 4 * (2048 - this.wavelength);\n      const phaseRemaining = phaseWidth - this.phaseClock;\n\n      // Calculate the smallest trigger\n      let consumedClocks = Math.min(phaseRemaining, remainingClocks);\n      if (this.hasSweep) consumedClocks = this.sweep.getNextClocks(consumedClocks);\n      consumedClocks = this.envelope.getNextClocks(consumedClocks);\n      consumedClocks = this.length.getNextClocks(consumedClocks);\n\n      this.phaseClock += consumedClocks;\n      if (this.phaseClock >= phaseWidth) {\n        this.phaseClock = 0;\n        this.phase = (this.phase + 1) % 8;\n      }\n      if (this.hasSweep) this.sweep.step(consumedClocks);\n      this.envelope.step(consumedClocks);\n      this.length.step(consumedClocks);\n\n      remainingClocks -= consumedClocks;\n    }\n    // Calculate current output\n    if (this.enabled) {\n      const signal = (DUTY_CYCLE_TABLE[this.dutyCycle] >> (7 - this.phase)) & 1;\n      this.output = (signal ? -1 : 1) * this.envelope.get();\n    } else {\n      this.output = 0;\n    }\n  }\n\n  _read(pos: number): number {\n    switch (pos) {\n      case 1: \n        // NR11 - Length timer & duty cycle\n        return 0x100 | ((this.dutyCycle & 0x3) << 6);\n      case 3:\n        // NR13 - Wavelength low\n        return 0x100 | (this.wavelength & 0xff);\n      case 4: {\n        // NR14 - Wavelength high & control\n        return 0x100 | ((this.wavelength >> 8) & 0x7);\n      }\n      default:\n        return 0;\n    }\n  }\n\n  read(pos: number): number {\n    let output = this._read(pos);\n    if (this.hasSweep) output |= this.sweep.read(pos);\n    output |= this.envelope.read(pos);\n    output |= this.length.read(pos);\n    if (output & 0x100) return output;\n    return 0xff;\n  }\n\n  _write(pos: number, value: number): void {\n    switch (pos) {\n      case 1: \n        // NR11 - Length timer & duty cycle\n        this.dutyCycle = (value >> 6) & 0x3;\n        break;\n      case 3:\n        // NR13 - Wavelength low\n        this.wavelength = (this.wavelength & 0x700) | (value & 0xff);\n        break;\n      case 4: \n        // NR14 - Wavelength high & control\n        this.wavelength = (this.wavelength & 0xff) | ((value & 0x7) << 8);\n        if (value & 0x80) this.trigger();\n        break;\n    }\n  }\n\n  write(pos: number, value: number): void {\n    this._write(pos, value);\n    if (this.hasSweep) this.sweep.write(pos, value);\n    this.envelope.write(pos, value);\n    this.length.write(pos, value);\n  }\n\n}\n","import { RAM } from \"../memory/ram\";\nimport { Memory } from \"../memory/types\";\nimport { BaseSystem } from \"../system/baseSystem\";\nimport { NoisePSG } from \"./psg/noise\";\nimport { PCMPSG } from \"./psg/pcm\";\nimport { PSG } from \"./psg/psg\";\nimport { SquarePSG } from \"./psg/square\";\n\n// Gameboy APU runs at the master clock of CPU (4.194304MHz) - Meaning that\n// it can output sound at that pace. Obviously, this is improbable to directly\n// tap into modern computer's audio, and it's impossible to hear that.\n// Instead, we'll down-sample 4.194304MHz into 32,768Hz. This means that APU\n// will generate signal for each 128 clocks.\nconst SAMPLE_RATE = 32768;\nconst CLOCKS_PER_SAMPLE = 4194304 / SAMPLE_RATE;\nconst FRAMERATE = 60;\nconst SAMPLE_SIZE = Math.ceil(SAMPLE_RATE / FRAMERATE);\nconst SAMPLE_WRITE_SIZE = Math.ceil(SAMPLE_RATE / FRAMERATE);\n\nconst SERIALIZE_FIELDS: (keyof APU)[] = [\n  'clocks',\n  'nr50',\n  'nr51',\n  'nr52',\n];\n\nexport class APU implements Memory {\n  audioContext: AudioContext | null;\n  audioWorkletNode: AudioWorkletNode | null;\n  buffer: Float32Array;\n  clocks: number;\n  bufferPos: number;\n  psgs: PSG[];\n  waveTable: RAM;\n  nr50: number;\n  nr51: number;\n  nr52: number;\n\n  constructor() {\n    this.audioContext = null;\n    this.audioWorkletNode = null;\n    this.buffer = new Float32Array(SAMPLE_SIZE * 2);\n    this.clocks = 0;\n    this.bufferPos = 0;\n    this.waveTable = new RAM(0x10);\n    this.psgs = [\n      new SquarePSG(),\n      new SquarePSG(false),\n      new PCMPSG(this.waveTable),\n      new NoisePSG(),\n    ];\n    this.nr50 = 0;\n    this.nr51 = 0;\n    this.nr52 = 0;\n  }\n\n  async setup(): Promise<void> {\n    if (this.audioContext != null) return;\n    this.audioContext = new AudioContext({ sampleRate: SAMPLE_RATE });\n    await this.audioContext.audioWorklet.addModule('./audioWorklet.js');\n    this.audioWorkletNode = new AudioWorkletNode(\n      this.audioContext!,\n      'gb-passthrough',\n      { numberOfOutputs: 1, outputChannelCount: [2] },\n    );\n    const biquadFilter = new BiquadFilterNode(this.audioContext!, {\n      type: 'highpass',\n      Q: 10,\n      frequency: 100,\n    });\n    this.audioWorkletNode!.connect(biquadFilter);\n    biquadFilter.connect(this.audioContext!.destination);\n  }\n\n  reset(): void {\n    this.buffer = new Float32Array(SAMPLE_SIZE * 2);\n    this.clocks = 0;\n    this.bufferPos = 0;\n    this.waveTable.reset();\n    this.psgs.forEach((psg) => psg.reset());\n    this.nr50 = 0;\n    this.nr51 = 0;\n    this.nr52 = 0;\n  }\n\n  register(system: BaseSystem): void {\n    const { ioBus } = system;\n    ioBus.registerMemory(0x10, 0x30, 'APU', this);\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.waveTable = this.waveTable.serialize();\n    output.psgs = this.psgs.map((psg) => psg.serialize());\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    this.clocks = data.clocks;\n    this.waveTable.deserialize(data.waveTable);\n    this.psgs.forEach((psg, i) => psg.deserialize(data.psgs[i]));\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  read(pos: number): number {\n    const id = Math.floor(pos / 5);\n    if (id < 4) {\n      return this.psgs[id].read(pos % 5);\n    }\n    if (pos >= 0x20) {\n      return this.waveTable.read(pos - 0x20);\n    }\n    switch (pos) {\n      case 0x14:\n        return this.nr50;\n      case 0x15:\n        return this.nr51;\n      case 0x16: {\n        let output = this.nr52;\n        for (let i = 0; i < this.psgs.length; i += 1) {\n          if (this.psgs[i].enabled) output |= (1 << i);\n        }\n        return output;\n      }\n      default:\n        return 0xff;\n    }\n  }\n\n  write(pos: number, value: number): void {\n    const id = Math.floor(pos / 5);\n    if (id < 4) {\n      return this.psgs[id].write(pos % 5, value);\n    }\n    if (pos >= 0x20) {\n      return this.waveTable.write(pos - 0x20, value);\n    }\n    switch (pos) {\n      case 0x14:\n        this.nr50 = value;\n        break;\n      case 0x15:\n        this.nr51 = value;\n        break;\n      case 0x16:\n        this.nr52 = value & 0x80;\n        break;\n    }\n  }\n\n  step(clocks: number): void {\n    // NR52 Bit 7: All sound on/off\n    if ((this.nr52 & 0x80) === 0) return;\n    for (let i = 0; i < this.psgs.length; i += 1) {\n      this.psgs[i].step(clocks);\n    }\n  }\n\n  getOutput(channel: number): number {\n    // NR52 Bit 7: All sound on/off\n    if ((this.nr52 & 0x80) === 0) return 0;\n    // NR51: Sound panning\n    const nr51 = this.nr51;\n    // NR50: Master volume, VIN panning\n    const nr50 = this.nr50;\n\n    let output = 0;\n    for (let i = 0; i < 4; i += 1) {\n      if (nr51 & (1 << (channel * 4 + i))) output += this.psgs[i].output;\n    }\n\n    if (channel === 0) {\n      output *= ((nr50 >>> 4) & 0x7) / 0x7;\n    } else {\n      output *= (nr50 & 0x7) / 0x7;\n    }\n\n    return output / 4;\n  }\n\n  // NOTE: The clock may not directly correspond to the CPU.\n  advanceClock(): void {\n    this.clocks += 4;\n    const futurePos = Math.floor(this.clocks / CLOCKS_PER_SAMPLE);\n    while (this.bufferPos < futurePos) {\n      this.step(Math.floor(CLOCKS_PER_SAMPLE));\n      for (let channel = 0; channel < 2; channel += 1) {\n        const offset = SAMPLE_SIZE * channel;\n        this.buffer[offset + this.bufferPos] = this.getOutput(channel);\n      }\n      this.bufferPos += 1;\n    }\n  }\n\n  finalize(): void {\n    while (this.bufferPos < SAMPLE_WRITE_SIZE) {\n      this.step(Math.floor(CLOCKS_PER_SAMPLE));\n      for (let channel = 0; channel < 2; channel += 1) {\n        const offset = SAMPLE_SIZE * channel;\n        this.buffer[offset + this.bufferPos] = this.getOutput(channel);\n      }\n      this.bufferPos += 1;\n    }\n    if (this.audioWorkletNode != null) {\n      this.audioWorkletNode.port.postMessage({\n        buffer: this.buffer,\n        size: SAMPLE_SIZE,\n        writeSize: SAMPLE_WRITE_SIZE,\n      });\n    }\n    this.buffer = new Float32Array(SAMPLE_SIZE * 2);\n    this.bufferPos = 0;\n    this.clocks = 0;\n  }\n\n  getDebugState(): string {\n    let output = [];\n    this.psgs.forEach((psg, i) => {\n      output.push(`NR${i + 1}: ` + psg.getDebugState() + '\\n');\n    });\n    output.push(`NR5: V: ${this.nr50.toString(16).padStart(2, '0')} P: ${this.nr51.toString(16).padStart(2, '0')} E: ${(this.nr52 & 0x80) !== 0}\\n`);\n    output.push('Wave: ');\n    for (let i = 0; i < 0x10; i += 1) {\n      output.push(this.waveTable.bytes[i].toString(16).padStart(2, '0'));\n    }\n    return output.join('');\n  }\n}\n","import { BaseSystem } from '../system/baseSystem';\nimport { SystemType } from '../system/systemType';\nimport { BankedRAM } from './bankedRAM';\n\nexport class WRAM {\n  bank: number;\n  ram: BankedRAM;\n\n  constructor() {\n    this.bank = 1;\n    this.ram = new BankedRAM(0x8000, () => false, (addr) => {\n      if (addr < 0x1000) return 0;\n      return this.bank * 0x1000 - 0x1000;\n    });\n  }\n\n  serialize(): any {\n    return { ram: this.ram.serialize(), bank: this.bank };\n  }\n\n  deserialize(data: any): void {\n    this.bank = data.bank;\n    this.ram.deserialize(data.ram);\n  }\n\n  reset(): void {\n    this.bank = 1;\n    this.ram.reset();\n  }\n\n  register(system: BaseSystem): void {\n    const { ioBus, memoryBus } = system;\n    memoryBus.register(0xc0, 0xdf, this.ram);\n    memoryBus.register(0xe0, 0xfd, this.ram);\n    if (system.type === SystemType.CGB) {\n      ioBus.register(0x70, 'SVBK', {\n        read: () => this.bank,\n        write: (_, value) => {\n          this.bank = value & 0x7;\n          if (this.bank === 0) {\n            this.bank = 1;\n          }\n        },\n      });\n    }\n  }\n\n}\n","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export function generateLUTSingle<T>(\n  pattern: string,\n  generator: (vars: Record<string, number>) => T,\n  output: T[] = []\n): T[] {\n  // Pattern is something like \"01aaabbb\"\n  // 0 / 1 is constraints, and \"a\", \"b\" is variables\n  // We'll simply use recursion to implement this\n  const letters = pattern.split('');\n  function visit(\n    index: number,\n    prev: number,\n    prevVar: number,\n    vars: Record<string, number>\n  ): void {\n    const letter = letters[index];\n    let currentVars = vars;\n    let currentPrevVar = prevVar;\n    if (\n      index === letters.length ||\n      (index > 0 && letters[index - 1] !== letter)\n    ) {\n      const prevLetter = letters[index - 1];\n      if (prevLetter !== '1' && prevLetter !== '0') {\n        currentVars = { ...vars, [prevLetter]: prevVar };\n        currentPrevVar = 0;\n      }\n    }\n    if (index === letters.length) {\n      output[prev] = generator(currentVars);\n      return;\n    }\n    let current = prev << 1;\n    if (letter === '1') {\n      current |= 1;\n      return visit(index + 1, current, currentPrevVar, currentVars);\n    } else if (letter === '0') {\n      return visit(index + 1, current, currentPrevVar, currentVars);\n    } else {\n      currentPrevVar = currentPrevVar << 1;\n      visit(index + 1, current, currentPrevVar, currentVars);\n      return visit(index + 1, current | 1, currentPrevVar | 1, currentVars);\n    }\n  }\n  visit(0, 0, 0, {});\n  return output;\n}\n\nexport function generateLUTRules<T>(\n  size: number,\n  patterns: [string, (vars: Record<string, number>) => T][]\n): T[] {\n  const output: T[] = new Array(size);\n  patterns.forEach(([pattern, generator]) => {\n    generateLUTSingle(pattern, generator, output);\n  });\n  return output;\n}\n","import { CPU } from '../cpu';\nimport { OpExec } from './types';\nimport { FLAG, REGISTER } from '../constants';\nimport { Register8Description } from './register';\nimport { getHex8 } from './utils';\n\nexport type ALUUnaryOp = ((cpu: CPU, a: number) => number) & { opName: string, param?: string };\nexport type ALUBinaryOp = ((cpu: CPU, a: number, b: number) => number) & { opName: string };\n\nfunction createUnaryOp(name: string, callback: (cpu: CPU, a: number) => number): ALUUnaryOp {\n  const func = callback as ALUUnaryOp;\n  func.opName = name;\n  return func;\n}\n\nfunction createUnaryOpWithParam(name: string, param: string, callback: (cpu: CPU, a: number) => number): ALUUnaryOp {\n  const func = callback as ALUUnaryOp;\n  func.opName = name;\n  func.param = param;\n  return func;\n}\n\nfunction createBinaryOp(name: string, callback: (cpu: CPU, a: number, b: number) => number): ALUBinaryOp {\n  const func = callback as ALUBinaryOp;\n  func.opName = name;\n  return func;\n}\n\nexport const alu_add = createBinaryOp('add', (cpu, a, b) => {\n  const result = a + b;\n  cpu.aluSetFlags(\n    (result & 0xff) === 0,\n    false,\n    (((a & 0xf) + (b & 0xf)) & 0x10) !== 0,\n    (result & 0x100) !== 0\n  );\n  return result & 0xff;\n});\nexport const alu_adc = createBinaryOp('adc', (cpu, a, b) => {\n  const carry = cpu.getFlag(FLAG.C) ? 1 : 0;\n  const result = a + b + carry;\n  cpu.aluSetFlags(\n    (result & 0xff) === 0,\n    false,\n    (((a & 0xf) + (b & 0xf) + carry) & 0x10) !== 0,\n    (result & 0x100) !== 0\n  );\n  return result & 0xff;\n});\nexport const alu_sub = createBinaryOp('sub', (cpu, a, b) => {\n  const result = a - b;\n  cpu.aluSetFlags(\n    (result & 0xff) === 0,\n    true,\n    (((a & 0xf) - (b & 0xf)) | 0) < 0,\n    result < 0,\n  );\n  return result & 0xff;\n});\nexport const alu_sbc = createBinaryOp('sbc', (cpu, a, b) => {\n  const carry = cpu.getFlag(FLAG.C) ? 1 : 0;\n  const result = a - b - carry;\n  cpu.aluSetFlags(\n    (result & 0xff) === 0,\n    true,\n    (((a & 0xf) - (b & 0xf) - carry) & 0x10) !== 0,\n    result < 0,\n  );\n  return result & 0xff;\n});\nexport const alu_and = createBinaryOp('and', (cpu, a, b) => {\n  const result = a & b;\n  cpu.aluSetFlags((result & 0xff) === 0, false, true, false);\n  return result & 0xff;\n});\nexport const alu_or = createBinaryOp('or', (cpu, a, b) => {\n  const result = a | b;\n  cpu.aluSetFlags((result & 0xff) === 0, false, false, false);\n  return result & 0xff;\n});\nexport const alu_xor = createBinaryOp('xor', (cpu, a, b) => {\n  const result = a ^ b;\n  cpu.aluSetFlags((result & 0xff) === 0, false, false, false);\n  return result & 0xff;\n});\nexport const alu_cp = createBinaryOp('cp', (cpu, a, b) => {\n  const result = a - b;\n  cpu.aluSetFlags(\n    (result & 0xff) === 0,\n    true,\n    (((a & 0xf) - (b & 0xf)) | 0) < 0,\n    result < 0,\n  );\n  return a;\n});\n\nexport const binary_ops = [\n  alu_add,\n  alu_adc,\n  alu_sub,\n  alu_sbc,\n  alu_and,\n  alu_xor,\n  alu_or,\n  alu_cp,\n];\n\nexport const alu_inc = createUnaryOp('inc', (cpu, n) => {\n  const result = n + 1;\n  cpu.aluSetFlags(\n    n === 0xff,\n    false,\n    (n & 0xf) === 0xf,\n    cpu.getFlag(FLAG.C),\n  );\n  return result & 0xff;\n});\n\nexport const alu_dec = createUnaryOp('dec', (cpu, n) => {\n  const result = n - 1;\n  cpu.aluSetFlags(\n    n === 1,\n    true,\n    (n & 0xf) === 0,\n    cpu.getFlag(FLAG.C),\n  );\n  return result & 0xff;\n});\nexport const alu_swap = createUnaryOp('swap', (cpu, n) => {\n  const result = ((n & 0xf) << 4) | ((n >>> 4) & 0xf);\n  cpu.aluSetFlags((result & 0xff) === 0, false, false, false);\n  return result & 0xff;\n});\nexport const alu_rlc = (useZero: boolean) => createUnaryOp(useZero ? 'rlc' : 'rlca', (cpu, n) => {\n  const oldBit = n & 0x80;\n  const result = ((n << 1) & 0xff) | (oldBit >>> 7);\n  cpu.aluSetFlags(useZero && result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_rl = (useZero: boolean) => createUnaryOp(useZero ? 'rl' : 'rla', (cpu, n) => {\n  const carry = cpu.getFlag(FLAG.C) ? 1 : 0;\n  const oldBit = n & 0x80;\n  const result = ((n << 1) & 0xff) | carry;\n  cpu.aluSetFlags(useZero && result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_rrc = (useZero: boolean) => createUnaryOp(useZero ? 'rrc' : 'rrca', (cpu, n) => {\n  const oldBit = n & 0x01;\n  const result = ((n >>> 1) & 0xff) | (oldBit << 7);\n  cpu.aluSetFlags(useZero && result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_rr = (useZero: boolean) => createUnaryOp(useZero ? 'rr' : 'rra', (cpu, n) => {\n  const carry = cpu.getFlag(FLAG.C) ? 1 : 0;\n  const oldBit = n & 0x01;\n  const result = ((n >>> 1) & 0xff) | (carry << 7);\n  cpu.aluSetFlags(useZero && result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_sla = createUnaryOp('sla', (cpu, n) => {\n  const oldBit = n & 0x80;\n  const result = (n << 1) & 0xff;\n  cpu.aluSetFlags(result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_sra = createUnaryOp('sra', (cpu, n) => {\n  const oldBit = n & 0x01;\n  const result = ((n >>> 1) & 0xff) | (n & 0x80);\n  cpu.aluSetFlags(result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_srl = createUnaryOp('srl', (cpu, n) => {\n  const oldBit = n & 0x01;\n  const result = (n >>> 1) & 0xff;\n  cpu.aluSetFlags(result === 0, false, false, oldBit !== 0);\n  return result;\n});\nexport const alu_bit = (bit: number) => createUnaryOpWithParam('bit', bit.toString(), (cpu, n) => {\n  const bitMask = 1 << bit;\n  const result = bitMask & n & 0xff;\n  cpu.aluSetFlags(result === 0, false, true, cpu.getFlag(FLAG.C));\n  return n;\n});\nexport const alu_set = (bit: number) => createUnaryOpWithParam('set', bit.toString(), (cpu, n) => {\n  const bitMask = 1 << bit;\n  const result = (bitMask | n) & 0xff;\n  return result;\n});\nexport const alu_res = (bit: number) => createUnaryOpWithParam('res', bit.toString(), (cpu, n) => {\n  const bitMask = ~(1 << bit);\n  const result = n & (bitMask & 0xff);\n  return result;\n});\n\nexport const unary_ops = [\n  alu_rlc(true),\n  alu_rrc(true),\n  alu_rl(true),\n  alu_rr(true),\n  alu_sla,\n  alu_sra,\n  alu_swap,\n  alu_srl,\n];\n\nexport const alu_binary =\n  (op: ALUBinaryOp, r2: Register8Description): OpExec =>\n  (cpu, pc) => {\n    const n1 = cpu.registers[REGISTER.A];\n    const n2 = r2.read(cpu);\n    const result = op(cpu, n1, n2);\n    cpu.registers[REGISTER.A] = result;\n    cpu.skip(1);\n    cpu.tick(1 + r2.clocks);\n    if (cpu.isDebugging) {\n      cpu.log('op', `${op.opName} ${r2.name}`, pc, `a=${getHex8(result)} (${getHex8(n1)}, ${getHex8(n2)}) ${cpu.getDebugFlags()}`);\n    }\n  };\n\nexport const alu_binary_imm =\n  (op: ALUBinaryOp): OpExec =>\n  (cpu, pc) => {\n    const n1 = cpu.registers[REGISTER.A];\n    const n2 = cpu.memory.read(pc + 1);\n    const result = op(cpu, n1, n2);\n    cpu.registers[REGISTER.A] = result;\n    cpu.skip(2);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `${op.opName} ${getHex8(n2)}`, pc, `a=${getHex8(result)} (${getHex8(n1)}) ${cpu.getDebugFlags()}`);\n    }\n  };\n\nexport const alu_unary =\n  (op: ALUUnaryOp, r: Register8Description, clocks: number): OpExec =>\n  (cpu, pc) => {\n    let n;\n    if (clocks === 1) {\n      n = r.read(cpu);\n      if (r.clocks > 0) cpu.tick(r.clocks);\n      r.write(cpu, op(cpu, n));\n      cpu.skip(1);\n      cpu.tick(r.clocks + clocks);\n    } else {\n      if (r.clocks > 0) cpu.tick(r.clocks);\n      n = r.read(cpu);\n      if (r.clocks > 0) cpu.tick(r.clocks);\n      r.write(cpu, op(cpu, n));\n      // NOTE: This is called from \"CB\" prefix, we're taking account of it\n      cpu.skip(2);\n      cpu.tick(clocks);\n    }\n    if (cpu.isDebugging) {\n      cpu.log('op', `${op.opName} ${op.param ? `${op.param}, ` : ''}${r.name}`, pc, `${r.name}=${getHex8(n)} ${cpu.getDebugFlags()}`);\n    }\n  };\n\nexport const alu_unary_read =\n  (op: ALUUnaryOp, r: Register8Description, clocks: number): OpExec =>\n  (cpu, pc) => {\n    if (r.clocks > 0) cpu.tick(r.clocks);\n    const n = r.read(cpu);\n    op(cpu, n);\n    // NOTE: This is called from \"CB\" prefix, we're taking account of it\n    cpu.skip(2);\n    cpu.tick(clocks);\n    if (cpu.isDebugging) {\n      cpu.log('op', `${op.opName} ${op.param ? `${op.param}, ` : ''}${r.name}`, pc, `${r.name}=${getHex8(n)} ${cpu.getDebugFlags()}`);\n    }\n  };\n\n","import { CPU } from '../cpu';\nimport { FLAG } from '../constants';\n\nexport interface ConditionDescription {\n  (cpu: CPU): boolean;\n  name: string;\n}\n\nexport const conds: ConditionDescription[] = [\n  function nz(cpu) { return !cpu.getFlag(FLAG.Z); }, // nz\n  function z(cpu) { return cpu.getFlag(FLAG.Z); }, // z\n  function nc(cpu) { return !cpu.getFlag(FLAG.C); }, // nc\n  function c(cpu) { return cpu.getFlag(FLAG.C); }, //c\n];\n","import { CPU } from '../cpu';\nimport { OpExec } from './types';\nimport { REGISTER } from '../constants';\nimport { getHex16, getHex8 } from './utils';\n\nexport const jp_a16: OpExec = (cpu, pc) => {\n  const nn1 = cpu.memory.read(pc + 1);\n  cpu.tick(1);\n  const nn2 = cpu.memory.read(pc + 2);\n  cpu.tick(3);\n  const nn = nn1 | (nn2 << 8);\n  cpu.skip(3);\n  cpu.registers[REGISTER.PC] = nn;\n  if (cpu.isDebugging) {\n    cpu.log('op', `jp ${getHex16(nn)}`, pc, `pc=${getHex16(nn)}`);\n  }\n};\n\nexport const jp_cond_a16 =\n  (cond: (cpu: CPU) => boolean): OpExec =>\n  (cpu, pc) => {\n    if (cond(cpu)) {\n      const nn1 = cpu.memory.read(pc + 1);\n      cpu.tick(1);\n      const nn2 = cpu.memory.read(pc + 2);\n      cpu.tick(3);\n      const nn = nn1 | (nn2 << 8);\n      cpu.skip(3);\n      cpu.registers[REGISTER.PC] = nn;\n      if (cpu.isDebugging) {\n        cpu.log('op', `jp ${cond.name}, ${getHex16(nn)}`, pc, `pc=${getHex16(nn)}`);\n      }\n    } else {\n      cpu.skip(3);\n      cpu.tick(3);\n      if (cpu.isDebugging) {\n        const nn1 = cpu.memory.read(pc + 1);\n        const nn2 = cpu.memory.read(pc + 2);\n        const nn = nn1 | (nn2 << 8);\n        cpu.log('op', `jp ${cond.name}, ${getHex16(nn)}`, pc, `skip`);\n      }\n    }\n  };\n\nexport const jp_hl: OpExec = (cpu, pc) => {\n  const nn = cpu.readHL();\n  cpu.skip(1);\n  cpu.registers[REGISTER.PC] = nn;\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `jp hl`, pc, `pc=${getHex16(nn)}`);\n  }\n};\n\nexport const jr_r8: OpExec = (cpu, pc) => {\n  let n = cpu.memory.read(pc + 1);\n  if (n & 0x80) {\n    n = -((~n + 1) & 0xff);\n  }\n  const result = (cpu.registers[REGISTER.PC] + 2 + n) & 0xffff;\n  cpu.skip(2);\n  cpu.registers[REGISTER.PC] = result;\n  cpu.tick(3);\n  if (cpu.isDebugging) {\n    if (n > 0) {\n      cpu.log('op', `jr ${getHex8(n)}`, pc, `pc=${getHex16(result)}`);\n    } else {\n      cpu.log('op', `jr -${getHex8(-n)}`, pc, `pc=${getHex16(result)}`);\n    }\n  }\n};\n\nexport const jr_cond_r8 =\n  (cond: (cpu: CPU) => boolean): OpExec =>\n  (cpu, pc) => {\n    let n = cpu.memory.read(pc + 1);\n    if (n & 0x80) {\n      n = -((~n + 1) & 0xff);\n    }\n    let extraMsg = 'skip';\n    if (cond(cpu)) {\n      const result = (cpu.registers[REGISTER.PC] + 2 + n) & 0xffff;\n      cpu.skip(2);\n      cpu.registers[REGISTER.PC] = result;\n      cpu.tick(3);\n      if (cpu.isDebugging) {\n        extraMsg = `pc=${getHex16(result)}`;\n      }\n    } else {\n      cpu.skip(2);\n      cpu.tick(2);\n    }\n    if (cpu.isDebugging) {\n      if (n > 0) {\n        cpu.log('op', `jr ${cond.name}, ${getHex8(n)}`, pc, extraMsg);\n      } else {\n        cpu.log('op', `jr ${cond.name}, -${getHex8(-n)}`, pc, extraMsg);\n      }\n    }\n  };\n\nexport const call_a16: OpExec = (cpu, pc) => {\n  // read memory\n  const nn1 = cpu.memory.read(pc + 1);\n  cpu.tick(1);\n  const nn2 = cpu.memory.read(pc + 2);\n  cpu.tick(2);\n  const nn = nn1 | (nn2 << 8);\n  // push\n  const value = pc + 3;\n  const sp = cpu.registers[REGISTER.SP];\n  cpu.memory.write(sp - 1, (value >>> 8) & 0xff);\n  cpu.tick(1);\n  cpu.memory.write(sp - 2, value & 0xff);\n  cpu.tick(2);\n  const spNext = (sp - 2) & 0xffff;\n  cpu.registers[REGISTER.SP] = spNext;\n  // finish jmp\n  cpu.skip(3);\n  cpu.registers[REGISTER.PC] = nn;\n  if (cpu.isDebugging) {\n    cpu.log('op', `call ${getHex16(nn)}`, pc, `pc=${getHex16(nn)} sp=${getHex16(spNext)}`);\n  }\n};\n\nexport const call_cond_a16 =\n  (cond: (cpu: CPU) => boolean): OpExec =>\n  (cpu, pc) => {\n    if (cond(cpu)) {\n      // Read memory\n      const nn1 = cpu.memory.read(pc + 1);\n      cpu.tick(1);\n      const nn2 = cpu.memory.read(pc + 2);\n      cpu.tick(2);\n      const nn = nn1 | (nn2 << 8);\n      // push\n      const value = pc + 3;\n      const sp = cpu.registers[REGISTER.SP];\n      cpu.memory.write(sp - 1, (value >>> 8) & 0xff);\n      cpu.tick(1);\n      cpu.memory.write(sp - 2, value & 0xff);\n      cpu.tick(2);\n      const spNext = (sp - 2) & 0xffff;\n      cpu.registers[REGISTER.SP] = spNext;\n      // jmp\n      cpu.skip(3);\n      cpu.registers[REGISTER.PC] = nn;\n      if (cpu.isDebugging) {\n        cpu.log('op', `call ${cond.name}, ${getHex16(nn)}`, pc, `pc=${getHex16(nn)} sp=${getHex16(spNext)}`);\n      }\n    } else {\n      cpu.skip(3);\n      cpu.tick(3);\n      if (cpu.isDebugging) {\n        const nn1 = cpu.memory.read(pc + 1);\n        const nn2 = cpu.memory.read(pc + 2);\n        const nn = nn1 | (nn2 << 8);\n        cpu.log('op', `call ${cond.name}, ${getHex16(nn)}`, pc, 'skip');\n      }\n    }\n  };\n\nexport const rst_nn =\n  (n: number): OpExec =>\n  (cpu, pc) => {\n    cpu.tick(1);\n    // push\n    const value = pc + 1;\n    const sp = cpu.registers[REGISTER.SP];\n    cpu.memory.write(sp - 1, (value >>> 8) & 0xff);\n    cpu.tick(1);\n    cpu.memory.write(sp - 2, value & 0xff);\n    cpu.tick(2);\n    const spNext = (sp - 2) & 0xffff;\n    cpu.registers[REGISTER.SP] = spNext;\n    // jmp\n    cpu.skip(1);\n    cpu.registers[REGISTER.PC] = n;\n    if (cpu.isDebugging) {\n      cpu.log('op', `rst ${getHex8(n)}`, pc, `pc=${getHex16(n)} sp=${getHex16(spNext)}`);\n    }\n  };\n\nexport const ret: OpExec = (cpu, pc) => {\n  // pop\n  const sp = cpu.registers[REGISTER.SP];\n  const value1 = cpu.memory.read(sp);\n  cpu.tick(1);\n  const value2 = cpu.memory.read(sp + 1);\n  cpu.tick(3);\n  const value = value1 | (value2 << 8);\n  const spNext = (sp + 2) & 0xffff;\n  cpu.registers[REGISTER.SP] = spNext;\n  // jmp\n  cpu.skip(1);\n  cpu.registers[REGISTER.PC] = value;\n  if (cpu.isDebugging) {\n    cpu.log('op', 'ret', pc, `pc=${getHex16(value)} sp=${getHex16(spNext)}`);\n  }\n};\n\nexport const ret_cond =\n  (cond: (cpu: CPU) => boolean): OpExec =>\n  (cpu, pc) => {\n    if (cond(cpu)) {\n      // pop\n      const sp = cpu.registers[REGISTER.SP];\n      cpu.tick(1);\n      const value1 = cpu.memory.read(sp);\n      cpu.tick(1);\n      const value2 = cpu.memory.read(sp + 1);\n      cpu.tick(3);\n      const value = value1 | (value2 << 8);\n      const spNext = (sp + 2) & 0xffff;\n      cpu.registers[REGISTER.SP] = spNext;\n      // jmp\n      cpu.skip(1);\n      cpu.registers[REGISTER.PC] = value;\n      if (cpu.isDebugging) {\n        cpu.log('op', `ret ${cond.name}`, pc, `pc=${getHex16(value)} sp=${getHex16(spNext)}`);\n      }\n    } else {\n      cpu.skip(1);\n      cpu.tick(2);\n      if (cpu.isDebugging) {\n        cpu.log('op', `ret ${cond.name}`, pc, 'skip');\n      }\n    }\n  };\n\nexport const reti: OpExec = (cpu, pc) => {\n  // pop\n  const sp = cpu.registers[REGISTER.SP];\n  const value1 = cpu.memory.read(sp);\n  cpu.tick(1);\n  const value2 = cpu.memory.read(sp + 1);\n  cpu.tick(3);\n  const value = value1 | (value2 << 8);\n  const spNext = (sp + 2) & 0xffff;\n  cpu.registers[REGISTER.SP] = spNext;\n  // jmp\n  cpu.skip(1);\n  cpu.registers[REGISTER.PC] = value;\n  // enable interrupts\n  cpu.isInterruptsEnabled = true;\n  cpu.isInterruptsEnabledNext = true;\n  if (cpu.isDebugging) {\n    cpu.log('op', 'reti', pc, `pc=${getHex16(value)} sp=${getHex16(spNext)}`);\n  }\n};\n","import { OpExec } from './types';\nimport { REGISTER } from '../constants';\nimport { Register16Description, Register8Description } from './register';\nimport { getHex16, getHex8 } from './utils';\n\nexport const ld =\n  (r1: Register8Description, r2: Register8Description): OpExec =>\n  (cpu, pc) => {\n    const value = r2.read(cpu);\n    r1.write(cpu, value);\n    cpu.skip(1);\n    cpu.tick(r1.clocks + r2.clocks + 1);\n    if (cpu.isDebugging) {\n      cpu.log('op', `ld ${r1.name}, ${r2.name}`, pc, `${r1.name}=${getHex8(value)}`);\n    }\n  };\n\nexport const ld_r_d8 =\n  (r: Register8Description): OpExec =>\n  (cpu, pc) => {\n    if (r.clocks > 0) cpu.tick(r.clocks);\n    const value = cpu.memory.read(pc + 1);\n    r.write(cpu, value);\n    cpu.skip(2);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `ld ${r.name}, ${getHex8(value)}`, pc, `${r.name}=${getHex8(value)}`);\n    }\n  };\n\nexport const ld_a_a16: OpExec = (cpu, pc) => {\n  const addr = cpu.memory.read(pc + 1) | (cpu.memory.read(pc + 2) << 8);\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.readBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  cpu.tick(2);\n  const nn = cpu.memory.read(addr);\n  cpu.registers[REGISTER.A] = nn;\n  cpu.skip(3);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld a, (${getHex16(addr)})`, pc, `a=${getHex8(nn)}`);\n  }\n};\n\nexport const ld_a16_a: OpExec = (cpu, pc) => {\n  const addr = cpu.memory.read(pc + 1) | (cpu.memory.read(pc + 2) << 8);\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.writeBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  cpu.tick(2);\n  const value = cpu.registers[REGISTER.A];\n  cpu.memory.write(addr, value);\n  cpu.skip(3);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld (${getHex16(addr)}), a`, pc, `(${getHex16(addr)})=${getHex8(value)}`);\n  }\n};\n\nexport const ld_a_c: OpExec = (cpu, pc) => {\n  const addr = (0xff00 + cpu.registers[REGISTER.C]) & 0xffff;\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.readBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  const nn = cpu.memory.read(addr);\n  cpu.registers[REGISTER.A] = nn;\n  cpu.skip(1);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld a, ($ff00 + c)`, pc, `a=${getHex8(nn)} (${getHex16(addr)})`);\n  }\n};\n\nexport const ld_c_a: OpExec = (cpu, pc) => {\n  const addr = (0xff00 + cpu.registers[REGISTER.C]) & 0xffff;\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.writeBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  const value = cpu.registers[REGISTER.A];\n  cpu.memory.write(addr, value);\n  cpu.skip(1);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld ($ff00 + c), a`, pc, `(${getHex16(addr)})=${getHex8(value)}`);\n  }\n};\n\nexport const ld_a_r16 =\n  (r2: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const addr = r2.read(cpu);\n    if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.readBreakpoints.includes(addr)) {\n      cpu.isTrapped = true;\n      return;\n    }\n    const nn = cpu.memory.read(addr);\n    cpu.registers[REGISTER.A] = nn;\n    cpu.skip(1);\n    r2.postCallback(cpu);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `ld a, (${r2.name})`, pc, `a=${getHex8(nn)} (${getHex16(addr)})`);\n    }\n  };\n\nexport const ld_r16_a =\n  (r1: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const addr = r1.read(cpu);\n    if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.writeBreakpoints.includes(addr)) {\n      cpu.isTrapped = true;\n      return;\n    }\n    const nn = cpu.registers[REGISTER.A];\n    cpu.memory.write(addr, nn);\n    cpu.skip(1);\n    r1.postCallback(cpu);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `ld (${r1.name}), a`, pc, `(${getHex16(addr)})=${getHex8(nn)}`);\n    }\n  };\n\nexport const ldh_a8_a: OpExec = (cpu, pc) => {\n  const addr = (0xff00 + cpu.memory.read(pc + 1)) & 0xffff;\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.writeBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  cpu.tick(1);\n  const value = cpu.registers[REGISTER.A];\n  cpu.memory.write(addr, value);\n  cpu.skip(2);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ldh (${getHex8(addr)}), a`, pc, `(${getHex16(addr)})=${getHex8(value)}`);\n  }\n};\n\nexport const ldh_a_a8: OpExec = (cpu, pc) => {\n  const addr = (0xff00 + cpu.memory.read(pc + 1)) & 0xffff;\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.readBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  cpu.tick(1);\n  const nn = cpu.memory.read(addr);\n  cpu.tick(2);\n  cpu.registers[REGISTER.A] = nn;\n  cpu.skip(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ldh a, (${getHex8(addr)})`, pc, `a=${getHex8(nn)}`);\n  }\n};\n\nexport const ld16_r_d16 =\n  (r: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const nn = cpu.memory.read(pc + 1) | (cpu.memory.read(pc + 2) << 8);\n    r.write(cpu, nn);\n    cpu.skip(3);\n    r.postCallback(cpu);\n    cpu.tick(3);\n    if (cpu.isDebugging) {\n      cpu.log('op', `ld ${r.name}, ${getHex16(nn)}`, pc, `${r.name}=${getHex16(nn)}`);\n    }\n  };\n\nexport const ld16_a16_sp: OpExec = (cpu, pc) => {\n  const addr = cpu.memory.read(pc + 1) | (cpu.memory.read(pc + 2) << 8);\n  if (!cpu.isTrapResolved && cpu.isBreakpointsEnabled && cpu.writeBreakpoints.includes(addr)) {\n    cpu.isTrapped = true;\n    return;\n  }\n  const value = cpu.registers[REGISTER.SP];\n  cpu.memory.write(addr, value & 0xff);\n  cpu.memory.write(addr + 1, (value >>> 8) & 0xff);\n  cpu.skip(3);\n  cpu.tick(5);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld (${getHex16(addr)}), sp`, pc, `(${getHex16(addr)})=${getHex16(value)}`);\n  }\n};\n\nexport const ld16_sp_hl: OpExec = (cpu, pc) => {\n  cpu.registers[REGISTER.SP] = cpu.readHL();\n  cpu.skip(1);\n  cpu.tick(2);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ld sp, hl`, pc, `sp=${getHex16(cpu.readHL())}`);\n  }\n};\n\nexport const ld16_hl_spr8: OpExec = (cpu, pc) => {\n  const n1 = cpu.registers[REGISTER.SP];\n  let n2 = cpu.memory.read(pc + 1);\n  if (n2 & 0x80) {\n    n2 = -((~n2 + 1) & 0xff);\n  }\n  const result = n1 + n2;\n  cpu.writeHL(result);\n  cpu.aluSetFlags(\n    false,\n    false,\n    ((n1 ^ n2 ^ (result & 0xffff)) & 0x10) === 0x10,\n    ((n1 ^ n2 ^ (result & 0xFFFF)) & 0x100) === 0x100,\n  );\n  cpu.skip(2);\n  cpu.tick(3);\n  if (cpu.isDebugging) {\n    if (n2 > 0) {\n      cpu.log('op', `ld hl, (sp + ${getHex8(n2)})`, pc, `hl=${getHex16(result)} sp=${getHex16(n1)}`);\n    } else {\n      cpu.log('op', `ld hl, (sp - ${getHex8(-n2)})`, pc, `hl=${getHex16(result)} sp=${getHex16(n1)}`);\n    }\n  }\n};\n","import { OpExec } from './types';\nimport { FLAG, REGISTER } from '../constants';\nimport { Register16Description } from './register';\nimport { getHex16, getHex8 } from './utils';\n\nexport const nop: OpExec = (cpu, pc) => {\n  cpu.tick(1);\n  cpu.skip(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', 'nop', pc);\n  }\n};\n\nexport const push =\n  (r: Register16Description): OpExec =>\n  (cpu, pc) => {\n    cpu.tick(1);\n    const value = r.read(cpu);\n    const sp = cpu.registers[REGISTER.SP] - 2;\n    cpu.memory.write(sp + 1, (value >>> 8) & 0xff);\n    cpu.tick(1);\n    cpu.memory.write(sp, value & 0xff);\n    cpu.tick(2);\n    cpu.registers[REGISTER.SP] = sp;\n    cpu.skip(1);\n    r.postCallback(cpu);\n    if (cpu.isDebugging) {\n      cpu.log(\n        'op',\n        `push ${r.name}`,\n        pc,\n        `${r.name}=${getHex16(value)} sp=${getHex16(sp)}`\n      );\n    }\n  };\n\nexport const pop =\n  (r: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const sp = cpu.registers[REGISTER.SP];\n    const value1 = cpu.memory.read(sp);\n    cpu.tick(1);\n    const value2 = cpu.memory.read(sp + 1);\n    cpu.tick(2);\n    const value = value1 | (value2 << 8);\n    r.write(cpu, value);\n    cpu.registers[REGISTER.SP] += 2;\n    cpu.skip(1);\n    r.postCallback(cpu);\n    if (cpu.isDebugging) {\n      cpu.log(\n        'op',\n        `pop ${r.name}`,\n        pc,\n        `${r.name}=${getHex16(value)} sp=${getHex16(sp)}`\n      );\n    }\n  };\n\nexport const add16 =\n  (r1: Register16Description, r2: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const n1 = r1.read(cpu);\n    const n2 = r2.read(cpu);\n    const result = n1 + n2;\n    cpu.aluSetFlags(\n      cpu.getFlag(FLAG.Z),\n      false,\n      (((n1 & 0xfff) + (n2 & 0xfff)) & 0x1000) !== 0,\n      (result & 0x10000) !== 0\n    );\n    r1.write(cpu, result & 0xffff);\n    cpu.skip(1);\n    r1.postCallback(cpu);\n    r2.postCallback(cpu);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log(\n        'op',\n        `add ${r1.name}, ${r2.name}`,\n        pc,\n        `${r1.name}=${getHex16(result & 0xffff)} (${getHex16(n1)}, ${getHex16(\n          n2\n        )}) ${cpu.getDebugFlags()}`\n      );\n    }\n  };\n\nexport const add16_sp_n: OpExec = (cpu, pc) => {\n  const n1 = cpu.registers[REGISTER.SP];\n  let n2 = cpu.memory.read(pc + 1);\n  if (n2 & 0x80) {\n    n2 = -((~n2 + 1) & 0xff);\n  }\n  const result = n1 + n2;\n  cpu.aluSetFlags(\n    false,\n    false,\n    ((n1 ^ n2 ^ (result & 0xffff)) & 0x10) === 0x10,\n    ((n1 ^ n2 ^ (result & 0xffff)) & 0x100) === 0x100\n  );\n  cpu.registers[REGISTER.SP] = result & 0xffff;\n  cpu.skip(2);\n  cpu.tick(4);\n  if (cpu.isDebugging) {\n    cpu.log(\n      'op',\n      `add sp, ${n2}`,\n      pc,\n      `sp=${getHex16(result & 0xffff)} ${cpu.getDebugFlags()}`\n    );\n  }\n};\n\nexport const inc16 =\n  (r: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const n1 = r.read(cpu);\n    const result = n1 + 1;\n    r.write(cpu, result & 0xffff);\n    cpu.skip(1);\n    r.postCallback(cpu);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `inc ${r.name}`, pc, `${r.name}=${getHex16(result)}`);\n    }\n  };\n\nexport const dec16 =\n  (r: Register16Description): OpExec =>\n  (cpu, pc) => {\n    const n1 = r.read(cpu);\n    const result = n1 - 1;\n    r.write(cpu, result & 0xffff);\n    cpu.skip(1);\n    r.postCallback(cpu);\n    cpu.tick(2);\n    if (cpu.isDebugging) {\n      cpu.log('op', `dec ${r.name}`, pc, `${r.name}=${getHex16(result)}`);\n    }\n  };\n\nexport const daa: OpExec = (cpu, pc) => {\n  let value = cpu.registers[REGISTER.A];\n  let carry = false;\n  let correction = 0;\n  if (cpu.getFlag(FLAG.H) || (!cpu.getFlag(FLAG.N) && (value & 0xf) > 9)) {\n    correction |= 0x6;\n  }\n  if (cpu.getFlag(FLAG.C) || (!cpu.getFlag(FLAG.N) && value > 0x99)) {\n    correction |= 0x60;\n    carry = true;\n  }\n  value += cpu.getFlag(FLAG.N) ? -correction : correction;\n  cpu.aluSetFlags((value & 0xff) === 0, cpu.getFlag(FLAG.N), false, carry);\n  cpu.registers[REGISTER.A] = value & 0xff;\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log(\n      'op',\n      `daa`,\n      pc,\n      `a=${getHex8(value & 0xff)} ${cpu.getDebugFlags()}`\n    );\n  }\n};\n\nexport const cpl: OpExec = (cpu, pc) => {\n  const result = cpu.registers[REGISTER.A] ^ 0xff;\n  cpu.aluSetFlags(cpu.getFlag(FLAG.Z), true, true, cpu.getFlag(FLAG.C));\n  cpu.registers[REGISTER.A] = result;\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log(\n      'op',\n      `cpl`,\n      pc,\n      `a=${getHex8(result & 0xff)} ${cpu.getDebugFlags()}`\n    );\n  }\n};\n\nexport const ccf: OpExec = (cpu, pc) => {\n  cpu.aluSetFlags(cpu.getFlag(FLAG.Z), false, false, !cpu.getFlag(FLAG.C));\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ccf`, pc, `${cpu.getDebugFlags()}`);\n  }\n};\n\nexport const scf: OpExec = (cpu, pc) => {\n  cpu.aluSetFlags(cpu.getFlag(FLAG.Z), false, false, true);\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `scf`, pc, `${cpu.getDebugFlags()}`);\n  }\n};\n\nexport const halt: OpExec = (cpu, pc) => {\n  cpu.isRunning = false;\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `halt`, pc, `IME=${cpu.isInterruptsEnabled}`);\n  }\n};\n\nexport const stop: OpExec = (cpu, pc) => {\n  cpu.isStopped = true;\n  cpu.isRunning = false;\n  cpu.skip(2);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `stop`, pc);\n  }\n};\n\nexport const di: OpExec = (cpu, pc) => {\n  cpu.isInterruptsEnabled = false;\n  cpu.isInterruptsEnabledNext = false;\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `di`, pc);\n  }\n};\n\nexport const ei: OpExec = (cpu, pc) => {\n  cpu.isInterruptsEnabledNext = true;\n  cpu.skip(1);\n  cpu.tick(1);\n  if (cpu.isDebugging) {\n    cpu.log('op', `ei`, pc);\n  }\n};\n","import { CPU } from '../cpu';\nimport { REGISTER, Register } from '../constants';\n\nexport interface Register8Description {\n  name: string;\n  read(cpu: CPU): number;\n  write(cpu: CPU, value: number): void;\n  clocks: number;\n}\n\nexport const r8_simple = (register_id: Register, name: string): Register8Description => ({\n  name,\n  read: (cpu) => cpu.registers[register_id],\n  write: (cpu, value) => {\n    cpu.registers[register_id] = value;\n  },\n  clocks: 0,\n});\n\nexport const r8_hl: Register8Description = {\n  name: '(hl)',\n  read: (cpu) => cpu.memory.read(cpu.readHL()),\n  write: (cpu, value) => cpu.memory.write(cpu.readHL(), value),\n  clocks: 1,\n};\n\nexport const r8_a = r8_simple(REGISTER.A, 'a');\n\nexport const r8s: Register8Description[] = [\n  r8_simple(REGISTER.B, 'b'),\n  r8_simple(REGISTER.C, 'c'),\n  r8_simple(REGISTER.D, 'd'),\n  r8_simple(REGISTER.E, 'e'),\n  r8_simple(REGISTER.H, 'h'),\n  r8_simple(REGISTER.L, 'l'),\n  r8_hl,\n  r8_a,\n];\n\nexport interface Register16Description {\n  name: string;\n  read(cpu: CPU): number;\n  write(cpu: CPU, value: number): void;\n  postCallback(cpu: CPU): void;\n}\n\nexport const r16_af: Register16Description = {\n  name: 'af',\n  read: (cpu) => (cpu.registers[REGISTER.A] << 8) | cpu.registers[REGISTER.F],\n  write: (cpu, value) => {\n    cpu.registers[REGISTER.A] = (value >>> 8) & 0xff;\n    cpu.registers[REGISTER.F] = value & 0xf0;\n  },\n  postCallback: () => {},\n};\n\nexport const r16_bc: Register16Description = {\n  name: 'bc',\n  read: (cpu) => (cpu.registers[REGISTER.B] << 8) | cpu.registers[REGISTER.C],\n  write: (cpu, value) => {\n    cpu.registers[REGISTER.B] = (value >>> 8) & 0xff;\n    cpu.registers[REGISTER.C] = value & 0xff;\n  },\n  postCallback: () => {},\n};\n\nexport const r16_de: Register16Description = {\n  name: 'de',\n  read: (cpu) => (cpu.registers[REGISTER.D] << 8) | cpu.registers[REGISTER.E],\n  write: (cpu, value) => {\n    cpu.registers[REGISTER.D] = (value >>> 8) & 0xff;\n    cpu.registers[REGISTER.E] = value & 0xff;\n  },\n  postCallback: () => {},\n};\n\nexport const r16_sp: Register16Description = {\n  name: 'sp',\n  read: (cpu) => cpu.registers[REGISTER.SP],\n  write: (cpu, value) => {\n    cpu.registers[REGISTER.SP] = value;\n  },\n  postCallback: () => {},\n};\n\nexport const r16_hl: Register16Description = {\n  name: 'hl',\n  read: (cpu) => cpu.readHL(),\n  write: (cpu, value) => cpu.writeHL(value),\n  postCallback: () => {},\n};\n\nexport const r16_hl_inc: Register16Description = {\n  ...r16_hl,\n  name: 'hl+',\n  postCallback: (cpu) => {\n    cpu.writeHL((cpu.readHL() + 1) & 0xffff);\n  },\n};\n\nexport const r16_hl_dec: Register16Description = {\n  ...r16_hl,\n  name: 'hl-',\n  postCallback: (cpu) => {\n    cpu.writeHL((cpu.readHL() - 1) & 0xffff);\n  },\n};\n\nexport const r16s_1: Register16Description[] = [r16_bc, r16_de, r16_hl, r16_sp];\n\nexport const r16s_2: Register16Description[] = [\n  r16_bc,\n  r16_de,\n  r16_hl_inc,\n  r16_hl_dec,\n];\n\nexport const r16s_3: Register16Description[] = [r16_bc, r16_de, r16_hl, r16_af];\n","import { generateLUTRules } from '../lut';\nimport { OpExec } from './types';\nimport {\n  alu_binary,\n  alu_binary_imm,\n  alu_bit,\n  alu_dec,\n  alu_inc,\n  alu_res,\n  alu_rl,\n  alu_rlc,\n  alu_rr,\n  alu_rrc,\n  alu_set,\n  alu_unary,\n  alu_unary_read,\n  binary_ops,\n  unary_ops,\n} from './alu';\nimport { conds } from './cond';\nimport {\n  call_a16,\n  call_cond_a16,\n  jp_a16,\n  jp_cond_a16,\n  jp_hl,\n  jr_cond_r8,\n  jr_r8,\n  ret,\n  reti,\n  ret_cond,\n  rst_nn,\n} from './jmp';\nimport {\n  ld,\n  ld16_a16_sp,\n  ld16_hl_spr8,\n  ld16_r_d16,\n  ld16_sp_hl,\n  ldh_a8_a,\n  ldh_a_a8,\n  ld_a16_a,\n  ld_a_a16,\n  ld_a_c,\n  ld_a_r16,\n  ld_c_a,\n  ld_r16_a,\n  ld_r_d8,\n} from './ld';\nimport {\n  add16,\n  add16_sp_n,\n  ccf,\n  cpl,\n  daa,\n  dec16,\n  di,\n  ei,\n  halt,\n  inc16,\n  nop,\n  pop,\n  push,\n  scf,\n  stop,\n} from './misc';\nimport { r16s_1, r16s_2, r16s_3, r16_hl, r8s, r8_a } from './register';\n\nconst prefix_opcodes = generateLUTRules(256, [\n  ['00ooorrr', ({ o, r }) => alu_unary(unary_ops[o], r8s[r], 2)], // (unary_op) r\n  ['01nnnrrr', ({ n, r }) => alu_unary_read(alu_bit(n), r8s[r], 2)], // bit n, r\n  ['10nnnrrr', ({ n, r }) => alu_unary(alu_res(n), r8s[r], 2)], // res n, r\n  ['11nnnrrr', ({ n, r }) => alu_unary(alu_set(n), r8s[r], 2)], // set n, r\n]);\n\nconst read_prefix: OpExec = (cpu, pc) => {\n  const next = cpu.memory.read(pc + 1);\n  prefix_opcodes[next](cpu, pc + 1);\n};\n\nexport const main_opcodes = generateLUTRules(256, [\n  ['00000000', () => nop],\n  ['00001000', () => ld16_a16_sp], // ld16 (a16), SP\n  ['00010000', () => stop],\n  ['00011000', () => jr_r8], // jr r8\n  ['001cc000', ({ c }) => jr_cond_r8(conds[c])], // jr c, r8\n  // BC, DE, HL, SP\n  ['00RR0001', ({ R }) => ld16_r_d16(r16s_1[R])], // ld16 r, d16\n  ['00RR1001', ({ R }) => add16(r16_hl, r16s_1[R])], // add16 hl, r\n  ['00RR0011', ({ R }) => inc16(r16s_1[R])], // inc16 R\n  ['00RR1011', ({ R }) => dec16(r16s_1[R])], // dec16 R\n  // BC, DE, HL+, HL-\n  ['00RR0010', ({ R }) => ld_r16_a(r16s_2[R])], // ld16 (r), a\n  ['00RR1010', ({ R }) => ld_a_r16(r16s_2[R])], // ld16 a, (r)\n  ['00rrr100', ({ r }) => alu_unary(alu_inc, r8s[r], 1)], // inc r\n  ['00rrr101', ({ r }) => alu_unary(alu_dec, r8s[r], 1)], // dec r\n  ['00rrr110', ({ r }) => ld_r_d8(r8s[r])], // ld r, d8\n  ['00000111', () => alu_unary(alu_rlc(false), r8_a, 1)], // rlca\n  ['00001111', () => alu_unary(alu_rrc(false), r8_a, 1)], // rrca\n  ['00010111', () => alu_unary(alu_rl(false), r8_a, 1)], // rla\n  ['00011111', () => alu_unary(alu_rr(false), r8_a, 1)], // rra\n  ['00100111', () => daa],\n  ['00101111', () => cpl],\n  ['00110111', () => scf],\n  ['00111111', () => ccf],\n  ['01aaabbb', ({ a, b }) => ld(r8s[a], r8s[b])], // ld a, b\n  ['01110110', () => halt],\n  ['10ooorrr', ({ o, r }) => alu_binary(binary_ops[o], r8s[r])], // (binary_op) a, r\n  ['110cc000', ({ c }) => ret_cond(conds[c])], // ret c\n  ['110cc010', ({ c }) => jp_cond_a16(conds[c])], // jp c, a16\n  ['110cc100', ({ c }) => call_cond_a16(conds[c])], // call c, a16\n  ['11000011', () => jp_a16],\n  ['11001001', () => ret],\n  ['11011001', () => reti],\n  ['11001011', () => read_prefix],\n  ['11001101', () => call_a16], // call a16\n  // BC, DE, HL, AF\n  ['11DD0001', ({ D }) => pop(r16s_3[D])], // pop D\n  ['11DD0101', ({ D }) => push(r16s_3[D])], // push D\n  ['11ooo110', ({ o }) => alu_binary_imm(binary_ops[o])], // (binary_op) a, d8\n  ['11nnn111', ({ n }) => rst_nn(n << 3)], // rst nn\n  ['11100000', () => ldh_a8_a], // ldh (a8), a\n  ['11110000', () => ldh_a_a8], // ldh a, (a8)\n  ['11100010', () => ld_c_a], // ld (c), a\n  ['11110010', () => ld_a_c], // ld a, (c)\n  ['11101000', () => add16_sp_n], // add sp, r8\n  ['11111000', () => ld16_hl_spr8], // ld hl, sp + r8\n  ['11101001', () => jp_hl], // jp hl\n  ['11111001', () => ld16_sp_hl], // ld sp, hl\n  ['11101010', () => ld_a16_a], // ld (a16), a\n  ['11111010', () => ld_a_a16], // ld a, (a16)\n  ['11110011', () => di],\n  ['11111011', () => ei],\n]);\n","import { Memory } from '../memory/types';\nimport { FLAG, REGISTER } from './constants';\nimport { CPULog } from './log';\nimport { main_opcodes } from './ops/opcode';\n\nexport class CPU {\n  registers: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  clocks: number = 0;\n  memory: Memory;\n  onTick: (clocks: number) => void;\n  isRunning = false;\n  isStopped = false;\n  isBlocked = false;\n  isInterruptsEnabled = false;\n  isInterruptsEnabledNext = false;\n\n  isTrapped = false;\n  isTrapResolved = false;\n\n  isDebugging = false;\n  debugLogs: CPULog[] = [];\n  opSizes: Uint8Array = new Uint8Array(0x10000);\n  isBreakpointsEnabled = false;\n  breakpoints: number[] = [];\n  readBreakpoints: number[] = [];\n  writeBreakpoints: number[] = [];\n\n  constructor(memory: Memory) {\n    this.memory = memory;\n    this.reset([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n    this.onTick = () => {};\n  }\n\n  reset(registers: number[]): void {\n    this.registers = registers.slice();\n    this.clocks = 0;\n    this.isStopped = false;\n    this.isBlocked = false;\n    this.isInterruptsEnabled = false;\n    this.isInterruptsEnabledNext = false;\n    this.isDebugging = false;\n    this.debugLogs = [];\n    this.opSizes.fill(0);\n  }\n\n  resume(): void {\n    this.isStopped = false;\n    this.isRunning = true;\n  }\n\n  serialize(): any {\n    const output: any = {};\n    output.registers = [...this.registers];\n    output.clocks = this.clocks;\n    output.isRunning = this.isRunning;\n    output.isInterruptsEnabled = this.isInterruptsEnabled;\n    output.isInterruptsEnabledNext = this.isInterruptsEnabledNext;\n    return output;\n  }\n\n  deserialize(data: any): void {\n    this.registers = [...data.registers];\n    this.clocks = data.clocks;\n    this.isRunning = data.isRunning;\n    this.isInterruptsEnabled = data.isInterruptsEnabled;\n    this.isInterruptsEnabledNext = data.isInterruptsEnabledNext;\n  }\n\n  getDebugFlags(): string {\n    let output = [];\n    output.push(this.getFlag(FLAG.Z) ? 'Z' : '-');\n    output.push(this.getFlag(FLAG.N) ? 'N' : '-');\n    output.push(this.getFlag(FLAG.H) ? 'H' : '-');\n    output.push(this.getFlag(FLAG.C) ? 'C' : '-');\n    return output.join('');\n  }\n\n  readHL(): number {\n    return (this.registers[REGISTER.H] << 8) | this.registers[REGISTER.L];\n  }\n\n  writeHL(value: number): void {\n    this.registers[REGISTER.H] = (value >>> 8) & 0xff;\n    this.registers[REGISTER.L] = value & 0xff;\n  }\n\n  getFlag(flag: number): boolean {\n    return (this.registers[REGISTER.F] & (1 << flag)) !== 0;\n  }\n\n  aluSetFlags(z: boolean, n: boolean, h: boolean, c: boolean): void {\n    let flags = 0;\n    if (z) flags |= 1 << FLAG.Z;\n    if (n) flags |= 1 << FLAG.N;\n    if (h) flags |= 1 << FLAG.H;\n    if (c) flags |= 1 << FLAG.C;\n    this.registers[REGISTER.F] = flags;\n  }\n\n  skip(bytes: number): void {\n    const pc = this.registers[REGISTER.PC];\n    this.opSizes[pc] = bytes;\n    this.registers[REGISTER.PC] = (pc + bytes) & 0xffff;\n  }\n\n  jump(addr: number): void {\n    this.registers[REGISTER.PC] = addr & 0xffff;\n  }\n\n  tick(clocks: number): void {\n    this.clocks += clocks;\n    this.onTick(clocks);\n  }\n\n  log(\n    type: CPULog['type'],\n    data: string,\n    address?: number,\n    comment?: string\n  ): void {\n    this.debugLogs.push({ type, data, address, comment });\n    if (this.debugLogs.length > 1000) {\n      this.debugLogs.shift();\n    }\n  }\n\n  trap(): void {\n    this.isTrapped = true;\n  }\n\n  enterInterrupt(): void {\n    // Reset IME Flag\n    this.isInterruptsEnabled = false;\n    this.isInterruptsEnabledNext = false;\n    // Push PC\n    const value = this.registers[REGISTER.PC];\n    const sp = this.registers[REGISTER.SP];\n    this.memory.write(sp - 1, (value >>> 8) & 0xff);\n    this.memory.write(sp - 2, value & 0xff);\n    this.registers[REGISTER.SP] = (this.registers[REGISTER.SP] - 2) & 0xffff;\n    this.tick(5);\n  }\n\n  getDebugState(): string {\n    return [\n      `PC: ${this.registers[REGISTER.PC]\n        .toString(16)\n        .padStart(4, '0')} SP: ${this.registers[REGISTER.SP]\n        .toString(16)\n        .padStart(4, '0')}`,\n      `A: ${this.registers[REGISTER.A].toString(16).padStart(4, '0')} BC: ${(\n        (this.registers[REGISTER.B] << 8) |\n        this.registers[REGISTER.C]\n      )\n        .toString(16)\n        .padStart(4, '0')}`,\n      `DE: ${((this.registers[REGISTER.D] << 8) | this.registers[REGISTER.E])\n        .toString(16)\n        .padStart(4, '0')} HL: ${(\n        (this.registers[REGISTER.H] << 8) |\n        this.registers[REGISTER.L]\n      )\n        .toString(16)\n        .padStart(4, '0')}`,\n      `Z: ${this.getFlag(FLAG.Z)} N: ${this.getFlag(FLAG.N)} H: ${this.getFlag(\n        FLAG.H\n      )} C: ${this.getFlag(FLAG.C)}`,\n    ].join('\\n');\n  }\n\n  step(): void {\n    if (this.isBlocked) {\n      // Do nothing and pass the time\n      this.tick(1);\n      return;\n    }\n    this.isInterruptsEnabled = this.isInterruptsEnabledNext;\n    const pc = this.registers[REGISTER.PC];\n    if (\n      !this.isTrapResolved &&\n      this.isBreakpointsEnabled &&\n      this.breakpoints.includes(pc)\n    ) {\n      this.isTrapped = true;\n      this.isDebugging = true;\n      return;\n    }\n    this.isTrapResolved = false;\n    const opcode = this.memory.read(pc);\n    const op_exec = main_opcodes[opcode];\n    if (op_exec != null) {\n      op_exec(this, pc);\n    } else {\n      // Illegal instruction\n      // (We skip it through)\n      this.skip(1);\n      this.tick(1);\n    }\n  }\n\n  runUntilHalt(): void {\n    this.isRunning = true;\n    while (this.isRunning) {\n      this.step();\n    }\n  }\n}\n","import { Memory } from '../memory/types';\n\nconst EMPTY_PORT: Memory = {\n  read: () => 0xff,\n  write: () => {},\n};\n\nexport class IOBus implements Memory {\n  ports: Memory[];\n  names: (string | null)[];\n  offsets: number[];\n\n  constructor() {\n    this.ports = [];\n    this.names = [];\n    this.offsets = [];\n    this.reset();\n  }\n\n  reset(): void {\n    this.ports = Array.from({ length: 256 }, () => EMPTY_PORT);\n    this.names = Array.from({ length: 256 }, () => null);\n    this.offsets = Array.from({ length: 256 }, () => 0);\n  }\n\n  register(pos: number, name: string, port: Memory): void {\n    this.ports[pos] = port;\n    this.names[pos] = name;\n    this.offsets[pos] = 0;\n  }\n\n  registerMemory(pos: number, size: number, name: string, mem: Memory): void {\n    for (let i = 0; i < size; i += 1) {\n      this.ports[pos + i] = mem;\n      this.names[pos + i] = name;\n      this.offsets[pos + i] = pos;\n    }\n  }\n\n  read(pos: number): number {\n    const port = this.ports[pos];\n    if (port == null) return 0xff;\n    const offset = this.offsets[pos];\n    return port.read(pos - offset);\n  }\n\n  write(pos: number, value: number): void {\n    const port = this.ports[pos];\n    if (port == null) return;\n    const offset = this.offsets[pos];\n    port.write(pos - offset, value);\n  }\n}\n","import { Memory } from '../memory/types';\n\nconst EMPTY_PORT: Memory = {\n  read: () => 0xff,\n  write: () => {},\n};\n\nexport class MemoryBus implements Memory {\n  // There are 256 ports here, for each 256 bytes. In other words, the port\n  // number is determined shifting 8 bits right.\n  ports: Memory[];\n  offsets: number[];\n\n  constructor() {\n    this.ports = [];\n    this.offsets = [];\n    this.reset();\n  }\n\n  reset(): void {\n    this.ports = Array.from({ length: 256 }, () => EMPTY_PORT);\n    this.offsets = Array.from({ length: 256 }, () => 0);\n  }\n\n  register(from: number, to: number, port: Memory, offset?: number): void {\n    for (let i = from; i <= to; i += 1) {\n      this.ports[i] = port;\n      this.offsets[i] = offset ?? (from << 8);\n    }\n  }\n\n  read(addr: number): number {\n    const id = addr >>> 8;\n    const port = this.ports[id];\n    if (port == null) return 0xff;\n    return port.read(addr - this.offsets[id]);\n  }\n\n  write(addr: number, value: number): void {\n    const id = addr >>> 8;\n    const port = this.ports[id];\n    if (port == null) return;\n    port.write(addr - this.offsets[id], value);\n  }\n}\n","import { CPU } from '../cpu/cpu';\nimport { IOBus } from '../io/ioBus';\nimport { Interrupter } from './interrupter';\nimport { MemoryBus } from './memoryBus';\nimport { SystemType, SYSTEM_BOOT_REGISTERS } from './systemType';\n\nexport class BaseSystem {\n  cpu: CPU;\n  interrupter: Interrupter;\n  memoryBus: MemoryBus;\n  ioBus: IOBus;\n  type: SystemType;\n\n  constructor() {\n    this.memoryBus = new MemoryBus();\n    this.cpu = new CPU(this.memoryBus);\n    this.interrupter = new Interrupter(this.cpu);\n    this.ioBus = new IOBus();\n    this.type = SystemType.DMG;\n\n    this.reset();\n  }\n\n  serialize(): any {\n    return {\n      cpu: this.cpu.serialize(),\n      interrupter: this.interrupter.serialize(),\n    };\n  }\n\n  deserialize(data: any): void {\n    this.cpu.deserialize(data.cpu);\n    this.interrupter.deserialize(data.interrupter);\n  }\n\n  reset(type?: SystemType): void {\n    if (type != null) {\n      this.type = type;\n    }\n    this.cpu.reset(SYSTEM_BOOT_REGISTERS[this.type]);\n    this.memoryBus.reset();\n    this.ioBus.reset();\n    this.interrupter.reset();\n\n    this.memoryBus.register(0xff, 0xff, this.ioBus);\n    this.interrupter.register(this);\n  }\n}\n","import { BaseSystem } from './baseSystem';\n\nexport class DMA {\n  src: number = 0;\n  pos: number = -1;\n  system: BaseSystem | null = null;\n\n  serialize(): any {\n    return { src: this.src, pos: this.pos };\n  }\n\n  deserialize(data: any): void {\n    this.src = data.src;\n    this.pos = data.pos;\n  }\n\n  reset(): void {\n    this.src = 0;\n    this.pos = -1;\n  }\n\n  register(system: BaseSystem): void {\n    const { ioBus } = system;\n    ioBus.register(0x46, 'DMA', {\n      read: () => 0xff,\n      write: (_, value) => {\n        // Perform DMA operation\n        const source = value << 8;\n        this.src = source;\n        this.pos = 0;\n        // TODO: Lock memory\n      },\n    });\n    this.system = system;\n  }\n\n  advanceClock(): void {\n    if (this.system == null) return;\n    if (this.pos >= 0) {\n      const memory = this.system.memoryBus;\n      const value = memory.read(this.src + this.pos);\n      memory.write(0xfe00 + this.pos, value);\n      this.pos += 1;\n      if (this.pos >= 160) {\n        this.pos = -1;\n        // TODO: Unlock memory\n      }\n    }\n  }\n}\n","import { BaseSystem } from \"./baseSystem\";\nimport { INTERRUPT_TYPE } from \"./interrupter\";\n\nexport const BUTTON = {\n  RIGHT: 0,\n  LEFT: 1,\n  UP: 2,\n  DOWN: 3,\n  A: 4,\n  B: 5,\n  SELECT: 6,\n  START: 7,\n};\n\nexport class GamepadController {\n  selectedNibbleHigh: boolean = false;\n  buttons!: boolean[];\n  system: BaseSystem | null = null;\n  constructor() {\n    this.reset();\n  }\n  reset() {\n    this.selectedNibbleHigh = false;\n    this.buttons = [false, false, false, false, false, false, false, false];\n  }\n  register(system: BaseSystem): void {\n    this.system = system;\n    const { ioBus } = system;\n    ioBus.register(0x00, 'JOYP', {\n      read: () => {\n        let output = 0;\n        const offset = this.selectedNibbleHigh ? 4 : 0;\n        if (!this.buttons[offset + 0]) output |= 0x1;\n        if (!this.buttons[offset + 1]) output |= 0x2;\n        if (!this.buttons[offset + 2]) output |= 0x4;\n        if (!this.buttons[offset + 3]) output |= 0x8;\n        return output;\n      },\n      write: (_, value) => {\n        if ((value & 0x20) === 0) {\n          this.selectedNibbleHigh = true;\n        } else if ((value & 0x10) === 0) {\n          this.selectedNibbleHigh = false;\n        }\n      },\n    });\n  }\n  set(index: number, value: boolean): void {\n    // TODO: Button Interrupts\n    if (this.system != null) {\n      this.system.interrupter.queueInterrupt(INTERRUPT_TYPE.PIN_TRIGGERED);\n    }\n    this.buttons[index] = value;\n  }\n}\n","import { BaseEmulator } from './baseEmulator';\nimport { BaseSystem } from './baseSystem';\nimport { SystemType } from './systemType';\n\nconst SERIALIZE_FIELDS: (keyof HDMA)[] = [\n  'src',\n  'dest',\n  'useHBlank',\n  'isRunning',\n  'length',\n  'pos',\n];\n\nexport class HDMA {\n  src: number = 0;\n  dest: number = 0; \n  useHBlank: boolean = false;\n  isRunning: boolean = false;\n  length: number = 0;\n  pos: number = 0;\n  remainingInCycle: number = 0;\n  system: BaseSystem | null = null;\n  emulator: BaseEmulator | null = null;\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  reset(): void {\n    this.src = 0;\n    this.dest = 0;\n    this.useHBlank = false;\n    this.isRunning = false;\n    this.length = 0;\n    this.pos = 0;\n  }\n\n  register(system: BaseSystem, emulator: BaseEmulator): void {\n    this.system = system;\n    this.emulator = emulator;\n    if (system.type !== SystemType.CGB) return;\n    const { ioBus } = system;\n    ioBus.register(0x51, 'HDMA1', {\n      read: () => (this.src >>> 8) & 0xff,\n      write: (_, value) => {\n        this.src = (this.src & 0xff) | (value << 8);\n      },\n    });\n    ioBus.register(0x52, 'HDMA2', {\n      read: () => this.src & 0xff,\n      write: (_, value) => {\n        this.src = (this.src & 0xff00) | value;\n      },\n    });\n    ioBus.register(0x53, 'HDMA3', {\n      read: () => (this.dest >>> 8) & 0xff,\n      write: (_, value) => {\n        this.dest = (this.dest & 0xff) | (value << 8);\n      },\n    });\n    ioBus.register(0x54, 'HDMA4', {\n      read: () => this.dest & 0xff,\n      write: (_, value) => {\n        this.dest = (this.dest & 0xff00) | value;\n      },\n    });\n    ioBus.register(0x55, 'HDMA5', {\n      read: () => {\n        const remaining = this.length - this.pos;\n        if (remaining === 0) return 0xff;\n        let output = (Math.floor(remaining / 0x10)) & 0x7f;\n        if (!this.isRunning) output |= 0x80;\n        return output;\n      },\n      write: (_, value) => {\n        if (!this.isRunning) {\n          this.isRunning = true;\n          this.useHBlank = (value & 0x80) !== 0;\n          this.pos = 0;\n          this.length = ((value & 0x7f) + 1) * 0x10;\n          if (!this.useHBlank) {\n            // Hang the CPU for the necessary time\n            const isDoubleSpeed = (this.system!.memoryBus.read(0xff4d) & 0x80) !== 0;\n            if (isDoubleSpeed) {\n              this.system!.cpu.tick(this.length);\n            } else {\n              this.system!.cpu.tick(this.length / 2);\n            }\n          } else {\n            if (this.emulator!.ppu.mode === 0) {\n              // Enter HBlank immediately\n              this.remainingInCycle = 0x10;\n              this.system!.cpu.isBlocked = true;\n            } else {\n              this.remainingInCycle = 0;\n            }\n          }\n        } else {\n          this.isRunning = false;\n          this.system!.cpu.isBlocked = false;\n        }\n      },\n    });\n  }\n\n  enterHBlank(): void {\n    if (!this.isRunning || !this.useHBlank) return;\n    this.remainingInCycle = 0x10;\n    this.system!.cpu.isBlocked = true;\n  }\n\n  advanceClock(): void {\n    if (!this.isRunning) return;\n    // FIXME: Stall the CPU when we're copying HDMA data in general-purpose mode\n    if (this.useHBlank) {\n      const mode = this.emulator!.ppu.mode;\n      if (mode !== 0 || this.remainingInCycle <= 0) {\n        this.system!.cpu.isBlocked = false;\n        return;\n      }\n    }\n    const memory = this.system!.cpu.memory;\n    const { src, dest, length } = this;\n    const realSrc = src & 0xfff0;\n    const realDest = (dest & 0x1ff0) + 0x8000;\n    // Copy 2 bytes in one M-clock\n    for (let i = 0; i < 2; i += 1) {\n      const pos = this.pos;\n      const value = memory.read(realSrc + pos);\n      memory.write(realDest + pos, value);\n      this.pos += 1;\n      this.remainingInCycle -= 1;\n      if (this.pos === length) {\n        this.system!.cpu.isBlocked = false;\n        this.isRunning = false;\n        this.pos = 0;\n        this.length = 0;\n        break;\n      }\n    }\n  }\n}\n","import { BaseSystem } from './baseSystem';\nimport { SystemType } from './systemType';\n\nexport class SpeedController {\n  system: BaseSystem | null;\n  isDoubleSpeed: boolean;\n  shouldChangeSpeed: boolean;\n\n  constructor() {\n    this.system = null;\n    this.isDoubleSpeed = false;\n    this.shouldChangeSpeed = false;\n  }\n\n  serialize(): any {\n    return {\n      isDoubleSpeed: this.isDoubleSpeed,\n      shouldChangeSpeed: this.shouldChangeSpeed,\n    };\n  }\n\n  deserialize(data: any): void {\n    this.isDoubleSpeed = data.isDoubleSpeed;\n    this.shouldChangeSpeed = data.shouldChangeSpeed;\n  }\n\n  register(system: BaseSystem): void {\n    this.system = system;\n    if (system.type !== SystemType.CGB) return;\n    const { ioBus } = system;\n    ioBus.register(0x4d, 'KEY1', {\n      read: () => {\n        let result = 0;\n        if (this.isDoubleSpeed) result |= 0x80;\n        if (this.shouldChangeSpeed) result |= 0x01;\n        return result;\n      },\n      write: (_, value) => {\n        this.shouldChangeSpeed = (value & 0x1) !== 0;\n      },\n    });\n  }\n\n  reset(): void {\n    this.isDoubleSpeed = false;\n    this.shouldChangeSpeed = false;\n  }\n\n  advanceClock(): void {\n    if (this.system == null) return;\n    if (this.shouldChangeSpeed && !this.system.cpu.isRunning) {\n      // Switch the current speed of the system\n      this.isDoubleSpeed = !this.isDoubleSpeed;\n      this.shouldChangeSpeed = false;\n      this.system.cpu.tick(2050);\n      this.system.cpu.isRunning = true;\n    }\n  }\n}\n","import { BaseSystem } from \"./baseSystem\";\nimport { Interrupter, INTERRUPT_TYPE } from \"./interrupter\";\n\nconst DIV_TICK_RATE = 256;\nconst TIMA_TICK_RATES = [1024, 16, 64, 256];\nconst TIMA_TICK_BITS = [512, 8, 32, 128];\n\nconst SERIALIZE_FIELDS: (keyof SystemTimer)[] = [\n  'clocks',\n  'tima',\n  'tma',\n  'tac',\n  'timaDelayed',\n];\n\nexport class SystemTimer {\n  interrupter: Interrupter;\n  clocks: number = 0;\n  tima: number = 0;\n  tma: number = 0;\n  tac: number = 0;\n  // https://gbdev.io/pandocs/Timer_Obscure_Behaviour.html#timer-overflow-behaviour\n  timaDelayed: boolean = false;\n\n  constructor(interrupter: Interrupter) {\n    this.interrupter = interrupter;\n    this.reset();\n  }\n\n  reset() {\n    this.clocks = 0xA7 * DIV_TICK_RATE;\n    this.tima = 0;\n    this.tma = 0;\n    this.tac = 0;\n    this.timaDelayed = false;\n  }\n\n  register(system: BaseSystem): void {\n    const { ioBus } = system;\n    ioBus.register(0x04, 'DIV', {\n      read: () => (this.clocks / DIV_TICK_RATE) & 0xff,\n      write: () => {\n        this.clocks = 0;\n        // Update the clock immediately\n        if (this.tac & 0x4) {\n          const oldBit = this.clocks & TIMA_TICK_BITS[this.tac & 0x3];\n          if (oldBit) {\n            this.tima += 1;\n            this._postUpdateTIMA();\n          }\n        }\n      },\n    });\n    ioBus.register(0x05, 'TIMA', {\n      read: () => this.tima & 0xff,\n      write: (_, value) => this.tima = value,\n    });\n    ioBus.register(0x06, 'TMA', {\n      read: () => this.tma,\n      write: (_, value) => this.tma = value,\n    });\n    ioBus.register(0x07, 'TAC', {\n      read: () => this.tac,\n      write: (_, value) => {\n        const oldTAC = this.tac;\n        this.tac = value;\n        // Update the clock immediately\n        // DMG bug - TAC increments even if enabled flag becomes false\n        if (oldTAC & 0x4) {\n          const oldBit = this.clocks & TIMA_TICK_BITS[oldTAC & 0x3];\n          const newBit = this.clocks & TIMA_TICK_BITS[value & 0x3];\n          if (!newBit && oldBit) {\n            this.tima += 1;\n            this._postUpdateTIMA();\n          }\n        }\n      },\n    });\n  }\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  getDebugState(): string {\n    const div = (this.clocks / DIV_TICK_RATE) & 0xff;\n    return [\n      `DIV: ${div.toString(16).padStart(2, '0')} TIMA: ${(this.tima & 0xff).toString(16).padStart(2, '0')} TMA: ${this.tma.toString(16).padStart(2, '0')} TAC: ${this.tac.toString(16).padStart(2, '0')}`,\n    ].join('\\n');\n  }\n\n  getNextWakeupClockAdvance(): number {\n    if (this.tac & 0x4) {\n      // Basically, we have to find nearest clock that triggers the timer\n      // overflow interrupt.\n      // This is the point where the TIMA becomes 0x100. We simply add the clock,\n      // and round down to nearest bit\n      const tickRate = TIMA_TICK_RATES[this.tac & 0x3];\n      const curTime = this.clocks - (this.clocks % tickRate);\n      const triggersNeeded = 0x100 - this.tima;\n      return ((curTime + triggersNeeded * tickRate) - this.clocks) / 4 + 1;\n\n    }\n    return 0x7fffffff;\n  }\n\n  _postUpdateTIMA(): void {\n    if (this.tima > 0xff) {\n      this.timaDelayed = true;\n      this.tima = 0x100;\n    }\n  }\n\n  advanceClock(): void {\n    if (this.timaDelayed) {\n      this.timaDelayed = false;\n      if (this.tima > 0xff) {\n        this.tima = this.tma & 0xff;\n        // Generate interrupt\n        this.interrupter.queueInterrupt(INTERRUPT_TYPE.TIMER_OVERFLOW);\n      }\n    }\n    if (this.tac & 0x4) {\n      // Tick the clock according to the clock\n      // Note that this needs to be in sync with \"clocks\" variable\n      // (https://gbdev.io/pandocs/Timer_Obscure_Behaviour.html)\n      // Since we don't get to emulate every cycle (this is doable though),\n      // we simply derive the increment count from the number of triggers\n      const nBits = TIMA_TICK_BITS[this.tac & 0x3];\n      const oldBit = (this.clocks & nBits) !== 0;\n      const newBit = ((this.clocks + 4) & nBits) !== 0;\n      if (oldBit && !newBit) {\n        this.tima += 1;\n        this._postUpdateTIMA();\n      }\n    }\n    this.clocks += 4;\n  }\n}\n","import { BaseSystem } from './baseSystem';\n\nconst SERIALIZE_FIELDS: (keyof SerialController)[] = [\n  'data',\n  'inProgress',\n  'isFast',\n  'isExternal',\n];\n\nexport class SerialController {\n  data: number = 0;\n  inProgress: boolean = false;\n  isFast: boolean = false;\n  isExternal: boolean = false;\n  system: BaseSystem | null = null;\n\n  serialize(): any {\n    const output: any = {};\n    SERIALIZE_FIELDS.forEach((key) => output[key] = this[key]);\n    return output;\n  }\n\n  deserialize(data: any): void {\n    SERIALIZE_FIELDS.forEach((key) => (this[key] as any) = data[key]);\n  }\n\n  reset(): void {\n    this.data = 0;\n    this.inProgress = false;\n    this.isFast = false;\n    this.isExternal = false;\n  }\n\n  register(system: BaseSystem): void {\n    this.system = system;\n    const { ioBus } = system;\n    ioBus.register(0x01, 'SB', {\n      read: () => this.data,\n      write: (_, value) => {\n        this.data = value;\n      },\n    });\n    ioBus.register(0x02, 'SC', {\n      read: () => {\n        return 0;\n      },\n      write: (_, value) => {\n      },\n    });\n  }\n}\n","import { APU } from '../apu/apu';\nimport { Cartridge } from '../cartridge/cartridge';\nimport { PPU } from '../ppu/ppu';\nimport { RAM } from '../memory/ram';\nimport { WRAM } from '../memory/wram';\nimport { BaseSystem } from './baseSystem';\nimport { DMA } from './dma';\nimport { GamepadController } from './gamepad';\nimport { HDMA } from './hdma';\nimport { SpeedController } from './speedController';\nimport { SystemType } from './systemType';\nimport { SystemTimer } from './timer';\nimport { SerialController } from './serial';\n\nexport class BaseEmulator {\n  system: BaseSystem;\n  ppu: PPU;\n  apu: APU;\n  timer: SystemTimer;\n  gamepad: GamepadController;\n  wram: WRAM;\n  hram: RAM;\n  dma: DMA;\n  hdma: HDMA;\n  speed: SpeedController;\n  serial: SerialController;\n  cartridge: Cartridge | null;\n\n  constructor() {\n    this.system = new BaseSystem();\n    this.ppu = new PPU(this.system.interrupter);\n    this.apu = new APU();\n    this.timer = new SystemTimer(this.system.interrupter);\n    this.gamepad = new GamepadController();\n    this.wram = new WRAM();\n    this.hram = new RAM(0x80);\n    this.dma = new DMA();\n    this.hdma = new HDMA();\n    this.speed = new SpeedController();\n    this.serial = new SerialController();\n    this.cartridge = null;\n  }\n\n  serialize(): any {\n    return {\n      ...this.system.serialize(),\n      ppu: this.ppu.serialize(),\n      apu: this.apu.serialize(),\n      timer: this.timer.serialize(),\n      wram: this.wram.serialize(),\n      hram: this.hram.serialize(),\n      dma: this.dma.serialize(),\n      hdma: this.hdma.serialize(),\n      speed: this.speed.serialize(),\n      serial: this.serial.serialize(),\n      cartridge: this.cartridge!.mbc.serialize(),\n    };\n  }\n\n  deserialize(data: any): void {\n    this.system.deserialize(data);\n    this.ppu.deserialize(data.ppu);\n    this.apu.deserialize(data.apu);\n    this.timer.deserialize(data.timer);\n    this.wram.deserialize(data.wram);\n    this.hram.deserialize(data.hram);\n    this.dma.deserialize(data.dma);\n    this.hdma.deserialize(data.hdma);\n    this.speed.deserialize(data.speed);\n    this.serial.deserialize(data.serial);\n    this.cartridge!.mbc.deserialize(data.cartridge);\n  }\n\n  reset(type?: SystemType): void {\n    this.system.reset(type);\n    this.wram.reset();\n    this.hram.reset();\n    this.ppu.reset();\n    this.apu.reset();\n    this.timer.reset();\n    this.gamepad.reset();\n    this.dma.reset();\n    this.hdma.reset();\n    this.speed.reset();\n    this.serial.reset();\n    if (this.cartridge != null) {\n      this.cartridge.reset();\n    }\n\n    this.wram.register(this.system);\n    this.ppu.register(this.system, this);\n    this.apu.register(this.system);\n    this.timer.register(this.system);\n    this.gamepad.register(this.system);\n    this.system.ioBus.registerMemory(0x80, 0x7f, 'HRAM', this.hram);\n    this.dma.register(this.system);\n    this.hdma.register(this.system, this);\n    this.speed.register(this.system);\n    this.serial.register(this.system);\n    if (this.cartridge != null) {\n      this.cartridge.register(this.system);\n    }\n\n    this.system.cpu.onTick = this.advanceClocks.bind(this);\n\n    // Start the CPU\n    this.system.cpu.jump(0x100);\n    this.system.cpu.isRunning = true;\n  }\n\n  advanceClocks(ticks: number): void {\n    let clocks = this.system.cpu.clocks - ticks;\n    for (let i = 0; i < ticks; i += 1) {\n      // Triggered every machine cycles in double speed\n      this.timer.advanceClock();\n      this.dma.advanceClock();\n      this.speed.advanceClock();\n      // Triggered every twice machine cycles in double speed\n      if (!this.speed.isDoubleSpeed || clocks % 2 === 0) {\n        this.ppu.advanceClock();\n        this.apu.advanceClock();\n        this.hdma.advanceClock();\n      }\n      clocks += 1;\n    }\n  }\n}\n","import { REGISTER } from '../cpu/constants';\nimport { drawCanvas } from './canvas';\nimport { loadCartridge } from '../cartridge/cartridge';\nimport { readSaveStorage, writeSaveStorage } from '../storage/saveStorage';\nimport { getHex16 } from '../cpu/ops/utils';\nimport { BaseEmulator } from './baseEmulator';\nimport { getSystemType, SystemType } from './systemType';\n\nexport class Emulator {\n  emulator: BaseEmulator;\n  isRunning: boolean;\n  isStepping: boolean;\n\n  sramSaveTimer: number = 0;\n\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n\n  debugTextElem: HTMLDivElement | null = null;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.emulator = new BaseEmulator();\n    this.isRunning = false;\n    this.isStepping = false;\n    this.sramSaveTimer = 0;\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d')!;\n  }\n\n  async load(rom: Uint8Array) {\n    const cart = await loadCartridge(this.emulator.system.cpu, rom);\n    const saveData = await readSaveStorage(cart.info);\n    if (saveData != null) {\n      cart.mbc.loadRAM(saveData);\n    }\n    this.emulator.cartridge = cart;\n    this.reboot(getSystemType(cart.info));\n  }\n\n  loadSRAMFromFile(ram: Uint8Array): void {\n    const cart = this.emulator.cartridge;\n    if (cart == null) return;\n    cart.mbc.loadRAM(ram);\n  }\n\n  getSRAM(): Uint8Array | null {\n    const cart = this.emulator.cartridge;\n    if (cart == null) return null;\n    return cart.mbc.serializeRAM();\n  }\n\n  async saveSRAM(): Promise<void> {\n    const cart = this.emulator.cartridge;\n    if (cart == null) return;\n    const data = cart.mbc.serializeRAM();\n    if (data == null) return;\n    await writeSaveStorage(cart.info, data);\n  }\n\n  serialize(): any {\n    return this.emulator.serialize();\n  }\n\n  deserialize(data: any): void {\n    this.emulator.deserialize(data);\n  }\n\n  reboot(type?: SystemType) {\n    this.emulator.reset(type);\n    this.sramSaveTimer = 0;\n  }\n\n  start() {\n    this.isRunning = true;\n  }\n\n  stop() {\n    this.isRunning = false;\n  }\n\n  readStack(nBytes: number): string {\n    const buffer = [];\n    const sp = this.emulator.system.cpu.registers[REGISTER.SP];\n    for (let i = 0; i < nBytes; i += 1) {\n      buffer.push(this.emulator.system.cpu.memory.read(sp + i).toString(16).padStart(2, '00'));\n    }\n    return buffer.join(' ');\n  }\n\n  update() {\n    if (!this.isRunning) return;\n    if (this.emulator.cartridge == null) return;\n\n    const { ppu, timer, apu, cartridge, speed } = this.emulator;\n    const { cpu, interrupter } = this.emulator.system;\n\n    // Start LCD clock\n    if (this.isStepping) {\n      cpu.isDebugging = true;\n      cpu.debugLogs = [];\n    } else {\n      cpu.isDebugging = false;\n    }\n\n    // Run system until stopped\n    // 4.194304MHz -> Around 70224 clocks per each frame (17556 M-clocks)\n    let runClocks = this.emulator.ppu.getRemainingClockUntilVblank();\n    if (speed.isDoubleSpeed) runClocks *= 2;\n    let stopClock = cpu.clocks + runClocks;\n    if (this.isStepping) {\n      stopClock = cpu.clocks + 1;\n      this.isRunning = false;\n      cpu.isTrapResolved = true;\n      cpu.isTrapped = false;\n    }\n    while (cpu.clocks < stopClock && (cpu.isRunning || interrupter.acceptsInterrupt()) && !cpu.isTrapped) {\n      // Run CPU\n      let beforeClock = cpu.clocks;\n      interrupter.step();\n      let elapsedClocks = cpu.clocks - beforeClock;\n      if (elapsedClocks === 0) {\n        // CPU is halted; try to retrive next interesting clock\n        const skipClocks = Math.min(\n          ppu.getNextWakeupClockAdvance(),\n          timer.getNextWakeupClockAdvance(),\n          // stopClock - this.cpu.clocks,\n        );\n        if (skipClocks === 0) break;\n        elapsedClocks = skipClocks;\n        if (speed.isDoubleSpeed) elapsedClocks *= 2;\n        cpu.tick(elapsedClocks);\n      }\n    }\n    if (this.isStepping) {\n      for (const log of cpu.debugLogs) {\n        if (log.address != null) {\n          console.log('%c%s: %c%s; %c%s', 'color: #468cff', getHex16(log.address), 'color: inherit', log.data, 'color: gray', log.comment ?? '');\n        } else {\n          console.log(log.data, log.comment ?? '');\n        }\n      }\n      cpu.debugLogs = [];\n    }\n    if (this.debugTextElem != null) {\n      this.debugTextElem.innerText = [\n        '--------- CPU',\n        `CLK: ${cpu.clocks}`,\n        cpu.getDebugState(),\n        interrupter.getDebugState(),\n        '--------- PPU',\n        ppu.getDebugState(),\n        '--------- TIMER',\n        timer.getDebugState(),\n        '--------- CART',\n        `Cartridge: ${cartridge.info.title}`,\n        cartridge.mbc.getDebugState(),\n        '--------- APU',\n        apu.getDebugState(),\n        '--------- STACK',\n        `Stack: ${this.readStack(20)}`,\n      ].join('\\n');\n    }\n    // this.isRunning = false;\n\n    // Render the screen, sound, etc\n    drawCanvas(ppu, this.ctx);\n    if (!this.isStepping) {\n      apu.finalize();\n      // Save the RAM state if the SRAM has not been updated for 100 frames\n      // (debounce)\n      if (cartridge.mbc.ramUpdated) {\n        this.sramSaveTimer = 100;\n        cartridge.mbc.ramUpdated = false;\n      }\n      if (this.sramSaveTimer > 0) {\n        this.sramSaveTimer -= 1;\n        if (this.sramSaveTimer === 0) {\n          this.saveSRAM();\n        }\n      }\n    }\n  }\n}\n","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","export function downloadFile(name: string, data: any): void {\n  const blob = new Blob([data]);\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = name;\n  document.body.appendChild(a);\n  a.style.display = 'none';\n  a.click();\n  a.remove();\n}\n","import './index.css';\nimport { LCD_HEIGHT, LCD_WIDTH } from './ppu/ppu';\nimport { dumpVRAM } from './system/dumpVRAM';\nimport { Emulator } from './system/emulator';\nimport { BUTTON } from './system/gamepad';\nimport { downloadFile } from './utils/downloadFile';\n\nconst CONTROLS_MAP: Record<string, number | undefined> = {\n  z: BUTTON.B,\n  x: BUTTON.A,\n  Enter: BUTTON.START,\n  Backspace: BUTTON.SELECT,\n  ArrowUp: BUTTON.UP,\n  ArrowLeft: BUTTON.LEFT,\n  ArrowRight: BUTTON.RIGHT,\n  ArrowDown: BUTTON.DOWN,\n};\n\nlet storedState: any;\n\nfunction processFile(emulator: Emulator, file: File) {\n  if (file.name.endsWith('.state')) {\n    const reader = new FileReader();\n    reader.onload = async (e2) => {\n      const json = e2.target!.result as string;\n      const data = JSON.parse(json);\n      storedState = data;\n      emulator.deserialize(data);\n    };\n    reader.readAsText(file);\n  } else {\n    const reader = new FileReader();\n    reader.onload = async (e2) => {\n      const array_buffer = e2.target!.result as ArrayBuffer;\n      const buffer = new Uint8Array(array_buffer);\n      if (file.name.endsWith('.sav')) {\n        emulator.loadSRAMFromFile(buffer);\n        emulator.reboot();\n        emulator.start();\n      } else {\n        await emulator.load(buffer);\n        emulator.reboot();\n        emulator.start();\n      }\n    };\n    reader.readAsArrayBuffer(file);\n  }\n}\n\nconst ACTIONS = {\n  open: (emulator: Emulator) => {\n    const inputEl = document.createElement('input');\n    inputEl.type = 'file';\n    inputEl.accept = '.gb,.gbc,.sav,.state';\n    inputEl.click();\n    inputEl.addEventListener('change', () => {\n      const file = (inputEl.files ?? [])[0];\n      if (file != null) {\n        processFile(emulator, file);\n      }\n    });\n  },\n  play: (emulator: Emulator) => {\n    emulator.isRunning = !emulator.isRunning;\n    emulator.isStepping = false;\n    if (emulator.emulator.system.cpu.isTrapped) {\n      emulator.isRunning = true;\n      emulator.emulator.system.cpu.isTrapResolved = true;\n      emulator.emulator.system.cpu.isTrapped = false;\n    }\n  },\n  reset: (emulator: Emulator) => {\n    emulator.reboot();\n    emulator.start();\n  },\n  stepFrame: (emulator: Emulator) => {\n    emulator.isRunning = true;\n    emulator.isStepping = false;\n    // Run 1 frame\n    emulator.update();\n    emulator.isRunning = false;\n  },\n  stepClock: (emulator: Emulator) => {\n    emulator.isRunning = true;\n    emulator.isStepping = true;\n  },\n  loadState: (emulator: Emulator) => {\n    if (storedState != null) {\n      emulator.deserialize(storedState);\n    }\n  },\n  saveState: (emulator: Emulator) => {\n    const data = emulator.serialize();\n    storedState = data;\n  },\n  downloadState: (emulator: Emulator) => {\n    if (storedState != null) {\n      downloadFile(\n        emulator.emulator.cartridge!.info.title + '.state',\n        JSON.stringify(storedState)\n      );\n    }\n  },\n  downloadSave: (emulator: Emulator) => {\n    const data = emulator.getSRAM();\n    if (data != null) {\n      downloadFile(emulator.emulator.cartridge!.info.title + '.sav', data);\n    }\n  },\n  toggleDebugStats: (emulator: Emulator) => {\n    const debugStatsElem = document.querySelector(\n      '#debug-stats-txt'\n    ) as HTMLDivElement;\n    if (emulator.debugTextElem == null) {\n      emulator.debugTextElem = debugStatsElem;\n      debugStatsElem.style.display = 'block';\n    } else {\n      emulator.debugTextElem = null;\n      debugStatsElem.style.display = 'none';\n    }\n  },\n  dumpVRAM: (emulator: Emulator) => {\n    dumpVRAM(emulator.emulator.ppu);\n  },\n};\n\nconst FRAME_RATE = 1000 / 60;\n\nfunction start() {\n  let prevTime = performance.now();\n  const canvas = document.querySelector('#canvas') as HTMLCanvasElement;\n  canvas.width = LCD_WIDTH;\n  canvas.height = LCD_HEIGHT;\n  const emulator = new Emulator(canvas);\n  (window as any).emulator = emulator;\n\n  function update() {\n    if (document.hidden) {\n      requestAnimationFrame(update);\n      return;\n    }\n    const delta = performance.now() - prevTime;\n    const runFrames = Math.min(10, Math.floor(delta / FRAME_RATE));\n    for (let i = 0; i < runFrames; i += 1) {\n      emulator.update();\n      prevTime += FRAME_RATE;\n    }\n    if (runFrames === 10) {\n      // The computer can't keep up; just update the clock\n      prevTime = performance.now();\n    }\n    requestAnimationFrame(update);\n  }\n  requestAnimationFrame(update);\n\n  window.addEventListener('keydown', (e) => {\n    switch (e.key) {\n      case ' ': {\n        ACTIONS.play(emulator);\n        break;\n      }\n      case 'q': {\n        ACTIONS.stepFrame(emulator);\n        break;\n      }\n      case 'w': {\n        ACTIONS.stepClock(emulator);\n        break;\n      }\n      case 'e': {\n        ACTIONS.dumpVRAM(emulator);\n        break;\n      }\n      case 'o': {\n        emulator.emulator.system.cpu.isBreakpointsEnabled =\n          !emulator.emulator.system.cpu.isBreakpointsEnabled;\n        break;\n      }\n      case 'p': {\n        ACTIONS.toggleDebugStats(emulator);\n        break;\n      }\n      case '1': {\n        ACTIONS.saveState(emulator);\n        break;\n      }\n      case '2': {\n        ACTIONS.loadState(emulator);\n        break;\n      }\n    }\n    const mappedButton = CONTROLS_MAP[e.key];\n    if (mappedButton != null) {\n      e.preventDefault();\n      emulator.emulator.gamepad.set(mappedButton, true);\n    }\n  });\n  window.addEventListener('keyup', (e) => {\n    const mappedButton = CONTROLS_MAP[e.key];\n    if (mappedButton != null) {\n      e.preventDefault();\n      emulator.emulator.gamepad.set(mappedButton, false);\n    }\n  });\n\n  window.addEventListener('dragover', (e) => {\n    e.preventDefault();\n  });\n\n  window.addEventListener('drop', (e) => {\n    e.stopPropagation();\n    e.preventDefault();\n    const files = e.dataTransfer?.files ?? [];\n    if (files[0] != null) {\n      processFile(emulator, files[0]);\n    }\n  });\n\n  window.addEventListener('click', async () => {\n    emulator.emulator.apu.setup();\n  });\n\n  (\n    [\n      ['#open', 'open'],\n      ['#download-sav', 'downloadSave'],\n      ['#play', 'play'],\n      ['#reset', 'reset'],\n      ['#step-frame', 'stepFrame'],\n      ['#download-state', 'downloadState'],\n      ['#toggle-debug-stats', 'toggleDebugStats'],\n      ['#dump-vram', 'dumpVRAM'],\n    ] as const\n  ).forEach(([qsName, actionName]) => {\n    document.querySelector(qsName)?.addEventListener('click', () => {\n      ACTIONS[actionName](emulator);\n    });\n  });\n\n  document.querySelector('#open')?.addEventListener('click', () => {\n    ACTIONS.open(emulator);\n  });\n\n  /*\n  const romListEl = document.querySelector('#romlist') as HTMLUListElement;\n  [\n    ['tetris.gb', 'Tetris'],\n  ].forEach(([romPath, romName]) => {\n    const romEl = document.createElement('li');\n    const buttonEl = document.createElement('a');\n    buttonEl.href = '#';\n    buttonEl.addEventListener('click', async (e) => {\n      e.preventDefault();\n      const res = await fetch(`./${romPath}`);\n      const array_buffer = await res.arrayBuffer();\n      const rom = new Uint8Array(array_buffer);\n      await emulator.load(rom);\n      emulator.reboot();\n      emulator.start();\n    });\n    buttonEl.appendChild(document.createTextNode(romName));\n    romEl.appendChild(buttonEl);\n    romListEl.appendChild(romEl);\n  });\n\n  (async () => {\n    const res = await fetch('./pokemon_red.gb');\n    const array_buffer = await res.arrayBuffer();\n    const rom = new Uint8Array(array_buffer);\n    await emulator.load(rom);\n    emulator.reboot();\n    emulator.start();\n  })();\n  */\n}\n\nstart();\n"],"names":["module","exports","e","t","n","r","s","o","u","i","f","Error","code","l","call","length","_dereq_","global","scheduleDrain","draining","Mutation","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","len","immediate","task","push","this","self","window","INTERNAL","handlers","REJECTED","FULFILLED","PENDING","Promise","resolver","TypeError","state","outcome","safelyResolveThenable","QueueItem","promise","onFulfilled","onRejected","callFulfilled","otherCallFulfilled","callRejected","otherCallRejected","unwrap","func","value","returnValue","reject","resolve","getThen","obj","then","apply","arguments","thenable","onError","onSuccess","tryToUnwrap","result","tryCatch","status","out","reason","all","iterable","Object","prototype","toString","values","Array","resolved","allResolver","resolveFromAll","outValue","error","race","response","constructor","_typeof","Symbol","iterator","_classCallCheck","instance","Constructor","getIDB","indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","idb","isIndexedDBValid","open","isSafari","openDatabase","test","navigator","userAgent","platform","hasFetch","fetch","indexOf","IDBKeyRange","createBlob","parts","properties","Blob","name","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","append","getBlob","type","Promise$1","executeCallback","callback","executeTwoCallbacks","errorCallback","normalizeKey","key","console","warn","String","getCallback","DETECT_BLOB_SUPPORT_STORE","supportsBlobs","dbContexts","READ_ONLY","READ_WRITE","_binStringToArrayBuffer","bin","buf","ArrayBuffer","arr","Uint8Array","charCodeAt","_checkBlobSupportWithoutCaching","txn","transaction","blob","objectStore","put","onabort","preventDefault","stopPropagation","oncomplete","matchedChrome","match","matchedEdge","parseInt","_checkBlobSupport","_deferReadiness","dbInfo","dbContext","deferredOperation","deferredOperations","dbReady","_advanceReadiness","pop","_rejectReadiness","err","_getConnection","upgradeNeeded","createDbContext","db","close","dbArgs","version","openreq","onupgradeneeded","createObjectStore","storeName","oldVersion","ex","newVersion","onerror","onsuccess","onversionchange","target","_getOriginalConnection","_getUpgradedConnection","_isUpgradeNeeded","defaultVersion","isNewStore","objectStoreNames","contains","isDowngrade","isUpgrade","incVersion","_encodeBlob","reader","FileReader","onloadend","base64","btoa","__local_forage_encoded_blob","readAsBinaryString","_decodeBlob","encodedBlob","atob","_isEncodedBlob","_fullyReady","_initReady","_dbInfo","_tryReconnect","forages","forage","createTransaction","mode","retries","undefined","tx","_initStorage","options","ready","initPromises","ignoreErrors","j","slice","_defaultConfig","k","getItem","req","get","iterate","openCursor","iterationNumber","cursor","setItem","blobSupport","store","removeItem","clear","count","advanced","openKeyCursor","advance","keys","dropInstance","currentConfig","config","dbPromise","dropObjectPromise","deleteObjectStore","_forage2","dropDBPromise","deleteDatabase","onblocked","asyncStorage","_driver","_support","isWebSQLValid","BASE_CHARS","BLOB_TYPE_PREFIX","BLOB_TYPE_PREFIX_REGEX","SERIALIZED_MARKER","SERIALIZED_MARKER_LENGTH","TYPE_ARRAYBUFFER","TYPE_BLOB","TYPE_INT8ARRAY","TYPE_UINT8ARRAY","TYPE_UINT8CLAMPEDARRAY","TYPE_INT16ARRAY","TYPE_INT32ARRAY","TYPE_UINT16ARRAY","TYPE_UINT32ARRAY","TYPE_FLOAT32ARRAY","TYPE_FLOAT64ARRAY","TYPE_SERIALIZED_MARKER_LENGTH","toString$1","stringToBuffer","serializedString","encoded1","encoded2","encoded3","encoded4","bufferLength","p","buffer","bytes","bufferToString","base64String","substring","serialize","valueType","marker","fileReader","onload","str","readAsArrayBuffer","JSON","stringify","deserialize","parse","blobType","matcher","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","localforageSerializer","createDbTable","executeSql","_initStorage$1","dbInfoPromise","description","size","serializer","tryExecuteSql","sqlStatement","args","SYNTAX_ERR","results","rows","getItem$1","item","iterate$1","_setItem","retriesLeft","originalValue","sqlError","QUOTA_ERR","setItem$1","removeItem$1","clear$1","length$1","c","key$1","keys$1","getAllStoreNames","storeNames","dropInstance$1","operationInfo","dropTable","operations","webSQLStorage","isLocalStorageValid","localStorage","_getKeyPrefix","defaultConfig","keyPrefix","checkIfLocalStorageThrows","localStorageTestKey","_isLocalStorageUsable","_initStorage$2","clear$2","getItem$2","iterate$2","keyPrefixLength","key$2","keys$2","itemKey","length$2","removeItem$2","setItem$2","dropInstance$2","localStorageWrapper","sameValue","x","y","isNaN","includes","array","searchElement","isArray","arg","DefinedDrivers","DriverSupport","DefaultDrivers","INDEXEDDB","WEBSQL","LOCALSTORAGE","DefaultDriverOrder","OptionalDriverMethods","LibraryMethods","concat","DefaultConfig","driver","callWhenReady","localForageInstance","libraryMethod","_args","extend","_key","hasOwnProperty","LocalForage","driverTypeKey","driverName","defineDriver","_config","_driverSet","_initDriver","_ready","_wrapLibraryMethodsWithReady","setDriver","replace","driverObject","complianceError","driverMethods","driverMethodName","configureMissingMethods","methodNotImplementedFactory","methodName","_i","_len","optionalDriverMethod","setDriverSupport","support","info","getDriver","getDriverPromise","getSerializer","serializerPromise","drivers","supportedDrivers","_getSupportedDrivers","setDriverToConfig","extendSelfWithDriver","_extend","initDriver","currentDriverIndex","driverPromiseLoop","oldDriverSetDone","supports","libraryMethodsAndProperties","createInstance","localforage_js","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","a","definition","defineProperty","enumerable","g","globalThis","Function","prop","_arrayLikeToArray","arr2","_unsupportedIterableToArray","minLen","from","_slicedToArray","_s","_e","_x","_r","_arr","_n","_d","next","done","_regeneratorRuntime","Op","hasOwn","desc","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","configurable","writable","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","context","Context","makeInvokeMethod","fn","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","defineIteratorMethods","forEach","method","_invoke","AsyncIterator","PromiseImpl","invoke","record","__await","unwrapped","previousPromise","callInvokeWithMethodAndArg","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","async","iter","val","object","reverse","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","_toPropertyKey","input","hint","prim","toPrimitive","res","Number","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","serializeBytes","hexData","byte","join","deserializeBytes","pos","createAccessor","read","write","_","BankedRAM","isLocked","getOffset","fill","_getPrototypeOf","bind","_get","Reflect","property","receiver","base","getOwnPropertyDescriptor","_setPrototypeOf","_possibleConstructorReturn","ReferenceError","_createSuper","Derived","hasNativeReflectConstruct","construct","sham","Proxy","Boolean","valueOf","Super","NewTarget","RAM","LockableRAM","subClass","superClass","REGISTER","FLAG","getHex16","padStart","getHex8","SystemType","INTERRUPT_TYPE","INTERRUPT_NAMES","IE_ADDR","IF_ADDR","Interrupter","cpu","interruptsEnable","interruptsFlag","ie","if","system","ioBus","register","memory","ifReg","ieReg","isInterruptsEnabled","isRunning","interruptReg","interruptType","prevPc","registers","enterInterrupt","addr","jump","isDebugging","log","step","_defineProperty","SYSTEM_BOOT_REGISTERS","DMG","CGB","SGB","getBGTileDataAddress","lcd","id","lcdc","LCDC","BG_WINDOW_TILE_DATA_SELECT","getBGTileId","bgMapBase","BG_TILE_MAP_DISPLAY_SELECT","vram","getBGTileAttributes","getWindowTileId","WINDOW_TILE_MAP_DISPLAY_SELECT","getWindowTileAttributes","getBGPaletteColor","paletteId","colorId","bgPalette","getOBJPaletteColor","objPalette","ATTRIBUTE","PALETTE","X_FLIP","Y_FLIP","BG_WINDOW_OVER_OBJ","renderLine","line","LCD_HEIGHT","isCGB","lcdcPriority","BG_WINDOW_DISPLAY","drawY","scy","tileY","py","fbAddr","LCD_WIDTH","currentX","drawX","scx","tileX","px","tileId","tileAttributes","tilePalette","tileHFlip","tilePriority","vy","tileAddr","tileLine1","tileLine2","vx","color","framebuffer","lineData","bgp","renderLineBG","WINDOW_DISPLAY","wy","Math","max","wx","renderLineWindow","OBJ_DISPLAY","oam","spriteHeight","OBJ_SIZE","drawIds","spriteX","attributes","obp","obp1","obp0","flipX","flipY","objPriority","palette","tileBank","prevData","bgColor","renderLineSprite","ENABLED","VBLANK_LY","LINE_CLOCK_MODE_23","LINE_CLOCK_MODE_2","SERIALIZE_FIELDS","PPU","interrupter","emulator","stat","ly","lyc","lineClock","clocks","vramBank","bcps","ocps","setInterrupter","output","memoryBus","bits","queueInterrupt","hdma","enterHBlank","handleLineChange","handleMode3Enter","handleMode0Enter","dumpVRAM","dumpEl","getElementById","body","canvas","width","height","bitmap","floor","dx","ax","ay","ctx","getContext","imgData","ImageData","putImageData","dumpEl3","canvas2","bitmap2","colorId2","drawTilemap","ctx2","imgData2","dumpEl2","style","fontFamily","oams","spriteY","innerText","MBCType","createCartridgeType","mbcType","hasRAM","hasBattery","hasTimer","hasRumble","hasSensor","CARTRIDGE_TYPES","ROM","MBC1","MBC2","MMM01","MBC3","MBC5","MBC6","MBC7","POCKET_CAMERA","BANDAI_TAMA5","HUC3","HUC1","RAM_BANKS","readCartridgeInfo","titleBytes","fromCharCode","title","cgbFlag","supportsCGB","requiresCGB","supportsSGB","cartridgeType","romBanks","romSize","ramBanks","ramSize","crypto","subtle","digest","hash","hashBuf","sha1Sum","map","v","rom","ram","bank","ramEnabled","ramUpdated","bankingMode","highBank","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","_objectSpread2","source","getOwnPropertyDescriptors","defineProperties","RTC","selectedRegister","latchedData","prevClocks","seconds","minutes","hours","days","halted","offset","oldSeconds","oldMinutes","oldHours","oldDays","view","DataView","byteOffset","dateBefore","getUint32","Date","now","loadRTC","rtc","date","setUint32","saveRTC","diff","addSeconds","newSeconds","min","newMinutes","newHours","newDays","_updateRTC","hasRTC","romBank","ramBank","load","saveData","set","save","initialTime","latchedTime","Cartridge","mbc","loadCartridge","readSaveStorage","cartInfo","localforage","writeSaveStorage","EnvelopePSGModule","initialVolume","currentVolume","increasing","pace","clock","remaining","LengthPSGModule","enabled","initialLength","currentLength","NoisePSG","phaseClock","clockShift","clockDivider","lfsr","lfsr7Bit","envelope","trigger","phaseWidth","hz","getDebugState","remainingClocks","phaseRemaining","consumedClocks","getNextClocks","setBit","signal","_read","_write","OUTPUT_LEVELS","PCMPSG","waveTable","dacEnabled","phase","wavelength","outputLevel","getHz","readAddr","readNibble","SweepPSGModule","initialPace","slope","nextWavelength","DUTY_CYCLE_TABLE","SquarePSG","hasSweep","dutyCycle","sweep","SAMPLE_RATE","SAMPLE_SIZE","ceil","SAMPLE_WRITE_SIZE","APU","audioContext","audioWorkletNode","bufferPos","psgs","nr50","nr51","nr52","AudioContext","sampleRate","audioWorklet","addModule","AudioWorkletNode","numberOfOutputs","outputChannelCount","biquadFilter","BiquadFilterNode","Q","frequency","connect","destination","psg","registerMemory","futurePos","getOutput","port","writeSize","WRAM","_toConsumableArray","generateLUTRules","patterns","pattern","letters","split","visit","index","prevVar","vars","letter","currentVars","currentPrevVar","prevLetter","current","generateLUTSingle","createUnaryOp","opName","createUnaryOpWithParam","param","createBinaryOp","alu_add","b","aluSetFlags","alu_adc","carry","getFlag","alu_sub","alu_sbc","alu_and","alu_or","binary_ops","alu_inc","alu_dec","alu_swap","alu_rlc","useZero","oldBit","alu_rl","alu_rrc","alu_rr","alu_sla","alu_sra","alu_srl","unary_ops","alu_unary","op","pc","tick","skip","getDebugFlags","conds","jp_a16","nn1","nn2","nn","jp_hl","readHL","jr_r8","call_a16","sp","spNext","ret","value1","value2","reti","isInterruptsEnabledNext","ld_a_a16","isTrapResolved","isBreakpointsEnabled","readBreakpoints","isTrapped","ld_a16_a","writeBreakpoints","ld_a_c","ld_c_a","ldh_a8_a","ldh_a_a8","ld16_a16_sp","ld16_sp_hl","ld16_hl_spr8","n1","n2","writeHL","nop","add16_sp_n","daa","correction","cpl","ccf","scf","halt","isStopped","di","ei","r8_simple","register_id","r8_a","r8s","r16_af","postCallback","r16_bc","r16_de","r16_sp","r16_hl","r16_hl_inc","r16_hl_dec","r16s_1","r16s_2","r16s_3","prefix_opcodes","bit","alu_unary_read","read_prefix","main_opcodes","cond","extraMsg","R","r1","r2","ld_r_d8","D","rst_nn","CPU","onTick","isBlocked","debugLogs","opSizes","breakpoints","flag","z","h","flags","address","comment","shift","opcode","op_exec","EMPTY_PORT","IOBus","ports","names","offsets","mem","MemoryBus","to","BaseSystem","DMA","src","BUTTON","GamepadController","selectedNibbleHigh","buttons","HDMA","dest","useHBlank","remainingInCycle","ppu","realSrc","realDest","SpeedController","isDoubleSpeed","shouldChangeSpeed","TIMA_TICK_RATES","TIMA_TICK_BITS","SystemTimer","tima","tma","tac","timaDelayed","_postUpdateTIMA","oldTAC","div","tickRate","nBits","newBit","SerialController","inProgress","isFast","isExternal","BaseEmulator","apu","timer","gamepad","wram","hram","dma","speed","serial","cartridge","advanceClocks","ticks","advanceClock","Emulator","isStepping","sramSaveTimer","debugTextElem","cart","loadRAM","reboot","serializeRAM","nBytes","runClocks","getRemainingClockUntilVblank","stopClock","acceptsInterrupt","beforeClock","elapsedClocks","skipClocks","getNextWakeupClockAdvance","allowArrayLike","it","F","normalCompletion","didErr","_e2","readStack","createImageData","drawCanvas","finalize","saveSRAM","downloadFile","url","URL","createObjectURL","href","download","display","click","remove","storedState","CONTROLS_MAP","Enter","Backspace","ArrowUp","ArrowLeft","ArrowRight","ArrowDown","processFile","file","endsWith","e2","json","readAsText","array_buffer","loadSRAMFromFile","start","ACTIONS","inputEl","accept","addEventListener","files","play","stepFrame","update","stepClock","loadState","saveState","downloadState","downloadSave","getSRAM","toggleDebugStats","debugStatsElem","querySelector","FRAME_RATE","prevTime","performance","requestAnimationFrame","hidden","delta","runFrames","mappedButton","dataTransfer","setup","qsName","actionName"],"sourceRoot":""}